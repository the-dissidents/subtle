var ea=Object.defineProperty;var ta=(e,t,n)=>t in e?ea(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var te=(e,t,n)=>(ta(e,typeof t!="symbol"?t+"":t,n),n),Oi=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var a=(e,t,n)=>(Oi(e,t,"read from private field"),n?n.call(e):t.get(e)),A=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},W=(e,t,n,s)=>(Oi(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n);var Tn=(e,t,n,s)=>({set _(i){W(e,t,i,n)},get _(){return a(e,t,s)}}),V=(e,t,n)=>(Oi(e,t,"access private method"),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();function Ot(){}function na(e,t){for(const n in t)e[n]=t[n];return e}function ir(e){return e()}function yl(){return Object.create(null)}function ct(e){e.forEach(ir)}function qs(e){return typeof e=="function"}function At(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function sa(e){return Object.keys(e).length===0}function Fi(e,t,n,s){if(e){const i=lr(e,t,n,s);return e[0](i)}}function lr(e,t,n,s){return e[1]&&s?na(n.ctx.slice(),e[1](s(t))):n.ctx}function Ii(e,t,n,s){if(e[2]&&s){const i=e[2](s(n));if(t.dirty===void 0)return i;if(typeof i=="object"){const l=[],r=Math.max(t.dirty.length,i.length);for(let h=0;h<r;h+=1)l[h]=t.dirty[h]|i[h];return l}return t.dirty|i}return t.dirty}function zi(e,t,n,s,i,l){if(i){const r=lr(t,n,s,l);e.p(r,i)}}function Ui(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let s=0;s<n;s++)t[s]=-1;return t}return-1}function Cn(e){return e??""}function rr(e){return e&&qs(e.destroy)?e.destroy:Ot}const ia=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function o(e,t){e.appendChild(t)}function B(e,t,n){e.insertBefore(t,n||null)}function G(e){e.parentNode&&e.parentNode.removeChild(e)}function ar(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function c(e){return document.createElement(e)}function Ne(e){return document.createTextNode(e)}function b(){return Ne(" ")}function ws(){return Ne("")}function P(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function m(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function xs(e){let t;return{p(...n){t=n,t.forEach(s=>e.push(s))},r(){t.forEach(n=>e.splice(e.indexOf(n),1))}}}function it(e){return e===""?null:+e}function la(e){return Array.from(e.childNodes)}function Pt(e,t){t=""+t,e.data!==t&&(e.data=t)}function H(e,t){e.value=t??""}function qt(e,t,n,s){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,s?"important":"")}function Vn(e,t,n){e.classList.toggle(t,!!n)}function ra(e,t,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:s})}let Ss;function ys(e){Ss=e}function aa(){if(!Ss)throw new Error("Function called outside component initialization");return Ss}function ds(){const e=aa();return(t,n,{cancelable:s=!1}={})=>{const i=e.$$.callbacks[t];if(i){const l=ra(t,n,{cancelable:s});return i.slice().forEach(r=>{r.call(e,l)}),!l.defaultPrevented}return!0}}const Gn=[],he=[];let Kn=[];const Hi=[],oa=Promise.resolve();let qi=!1;function ua(){qi||(qi=!0,oa.then($s))}function Vi(e){Kn.push(e)}function ut(e){Hi.push(e)}const Ri=new Set;let jn=0;function $s(){if(jn!==0)return;const e=Ss;do{try{for(;jn<Gn.length;){const t=Gn[jn];jn++,ys(t),da(t.$$)}}catch(t){throw Gn.length=0,jn=0,t}for(ys(null),Gn.length=0,jn=0;he.length;)he.pop()();for(let t=0;t<Kn.length;t+=1){const n=Kn[t];Ri.has(n)||(Ri.add(n),n())}Kn.length=0}while(Gn.length);for(;Hi.length;)Hi.pop()();qi=!1,Ri.clear(),ys(e)}function da(e){if(e.fragment!==null){e.update(),ct(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Vi)}}function ha(e){const t=[],n=[];Kn.forEach(s=>e.indexOf(s)===-1?t.push(s):n.push(s)),n.forEach(s=>s()),Kn=t}const js=new Set;let On;function Ci(){On={r:0,c:[],p:On}}function Mi(){On.r||ct(On.c),On=On.p}function ve(e,t){e&&e.i&&(js.delete(e),e.i(t))}function Pe(e,t,n,s){if(e&&e.o){if(js.has(e))return;js.add(e),On.c.push(()=>{js.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}else s&&s()}function tn(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function or(e,t){e.d(1),t.delete(e.key)}function ca(e,t){Pe(e,1,1,()=>{t.delete(e.key)})}function rl(e,t,n,s,i,l,r,h,u,d,f,g){let p=e.length,w=l.length,C=p;const v={};for(;C--;)v[e[C].key]=C;const M=[],_=new Map,y=new Map,k=[];for(C=w;C--;){const F=g(i,l,C),R=n(F);let N=r.get(R);N?s&&k.push(()=>N.p(F,t)):(N=d(R,F),N.c()),_.set(R,M[C]=N),R in v&&y.set(R,Math.abs(C-v[R]))}const L=new Set,J=new Set;function U(F){ve(F,1),F.m(h,f),r.set(F.key,F),f=F.first,w--}for(;p&&w;){const F=M[w-1],R=e[p-1],N=F.key,Q=R.key;F===R?(f=F.first,p--,w--):_.has(Q)?!r.has(N)||L.has(N)?U(F):J.has(Q)?p--:y.get(N)>y.get(Q)?(J.add(N),U(F)):(L.add(Q),p--):(u(R,r),p--)}for(;p--;){const F=e[p];_.has(F.key)||u(F,r)}for(;w;)U(M[w-1]);return ct(k),M}function dt(e,t,n){const s=e.$$.props[t];s!==void 0&&(e.$$.bound[s]=n,n(e.$$.ctx[s]))}function Qe(e){e&&e.c()}function Be(e,t,n){const{fragment:s,after_update:i}=e.$$;s&&s.m(t,n),Vi(()=>{const l=e.$$.on_mount.map(ir).filter(qs);e.$$.on_destroy?e.$$.on_destroy.push(...l):ct(l),e.$$.on_mount=[]}),i.forEach(Vi)}function Ke(e,t){const n=e.$$;n.fragment!==null&&(ha(n.after_update),ct(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function fa(e,t){e.$$.dirty[0]===-1&&(Gn.push(e),ua(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function nn(e,t,n,s,i,l,r=null,h=[-1]){const u=Ss;ys(e);const d=e.$$={fragment:null,ctx:[],props:l,update:Ot,not_equal:i,bound:yl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:yl(),dirty:h,skip_bound:!1,root:t.target||u.$$.root};r&&r(d.root);let f=!1;if(d.ctx=n?n(e,t.props||{},(g,p,...w)=>{const C=w.length?w[0]:p;return d.ctx&&i(d.ctx[g],d.ctx[g]=C)&&(!d.skip_bound&&d.bound[g]&&d.bound[g](C),f&&fa(e,g)),p}):[],d.update(),f=!0,ct(d.before_update),d.fragment=s?s(d.ctx):!1,t.target){if(t.hydrate){const g=la(t.target);d.fragment&&d.fragment.l(g),g.forEach(G)}else d.fragment&&d.fragment.c();t.intro&&ve(e.$$.fragment),Be(e,t.target,t.anchor),$s()}ys(u)}class sn{constructor(){te(this,"$$");te(this,"$$set")}$destroy(){Ke(this,1),this.$destroy=Ot}$on(t,n){if(!qs(n))return Ot;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(n),()=>{const i=s.indexOf(n);i!==-1&&s.splice(i,1)}}$set(t){this.$$set&&!sa(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const ma="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ma);const pa=e=>({}),bl=e=>({});function ga(e){let t,n,s,i,l,r,h,u,d,f,g,p,w;const C=e[10].header,v=Fi(C,e,e[9],bl),M=e[10].default,_=Fi(M,e,e[9],null);return{c(){t=c("dialog"),n=c("header"),v&&v.c(),s=b(),i=c("hr"),l=b(),r=c("div"),_&&_.c(),h=b(),u=c("footer"),d=c("button"),d.textContent="done",m(i,"class","svelte-139kryi"),m(n,"class","svelte-139kryi"),m(r,"class","svelte-139kryi"),m(d,"class","submit svelte-139kryi"),d.autofocus=!0,m(u,"class","svelte-139kryi"),m(t,"class",f=Cn(e[2]?"modal":"")+" svelte-139kryi"),qt(t,"top",e[5]+"px"),qt(t,"left",e[4]+"px")},m(y,k){B(y,t,k),o(t,n),v&&v.m(n,null),o(n,s),o(n,i),o(t,l),o(t,r),_&&_.m(r,null),o(t,h),o(t,u),o(u,d),e[13](t),g=!0,d.focus(),p||(w=[P(n,"mousedown",e[11]),P(d,"click",e[12]),P(t,"close",e[14])],p=!0)},p(y,[k]){v&&v.p&&(!g||k&512)&&zi(v,C,y,y[9],g?Ii(C,y[9],k,pa):Ui(y[9]),bl),_&&_.p&&(!g||k&512)&&zi(_,M,y,y[9],g?Ii(M,y[9],k,null):Ui(y[9]),null),(!g||k&4&&f!==(f=Cn(y[2]?"modal":"")+" svelte-139kryi"))&&m(t,"class",f),(!g||k&32)&&qt(t,"top",y[5]+"px"),(!g||k&16)&&qt(t,"left",y[4]+"px")},i(y){g||(ve(v,y),ve(_,y),g=!0)},o(y){Pe(v,y),Pe(_,y),g=!1},d(y){y&&G(t),v&&v.d(y),_&&_.d(y),e[13](null),p=!1,ct(w)}}}function _a(e,t,n){let{$$slots:s={},$$scope:i}=t,{show:l=!1}=t,{modal:r=!0}=t,{centerWhenOpen:h=!0}=t,{frontend:u}=t,d;const f=ds(),g=()=>f("submit");let p,w,C,v,M,_;y();function y(){n(4,M=window.innerWidth/2),n(5,_=window.innerHeight/2)}function k(R){p=R.clientX,w=R.clientY,C=M,v=_;let N=x=>{n(4,M=C+x.clientX-p),n(5,_=v+x.clientY-w)},Q=()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",Q)};document.addEventListener("mousemove",N),document.addEventListener("mouseup",Q)}const L=R=>k(R),J=()=>{n(0,l=!1),d.close(),g()};function U(R){he[R?"unshift":"push"](()=>{d=R,n(3,d)})}const F=()=>{r&&n(1,u.states.modalOpenCounter--,u),n(0,l=!1)};return e.$$set=R=>{"show"in R&&n(0,l=R.show),"modal"in R&&n(2,r=R.modal),"centerWhenOpen"in R&&n(8,h=R.centerWhenOpen),"frontend"in R&&n(1,u=R.frontend),"$$scope"in R&&n(9,i=R.$$scope)},e.$$.update=()=>{e.$$.dirty&271&&d&&l&&!d.open&&(h&&y(),r?(n(1,u.states.modalOpenCounter++,u),d.showModal()):d.show())},[l,u,r,d,M,_,g,k,h,i,s,L,J,U,F]}class Ti extends sn{constructor(t){super(),nn(this,t,_a,ga,At,{show:0,modal:2,centerWhenOpen:8,frontend:1})}}function ya(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function ji(e,t=!1){const n=ya(),s=`_${n}`;return Object.defineProperty(window,s,{value:i=>(t&&Reflect.deleteProperty(window,s),e==null?void 0:e(i)),writable:!1,configurable:!0}),n}async function ba(e,t={}){return new Promise((n,s)=>{const i=ji(r=>{n(r),Reflect.deleteProperty(window,`_${l}`)},!0),l=ji(r=>{s(r),Reflect.deleteProperty(window,`_${i}`)},!0);window.__TAURI_IPC__({cmd:e,callback:i,error:l,...t})})}function wa(e,t="asset"){return window.__TAURI__.convertFileSrc(e,t)}async function X(e){return ba("tauri",e)}async function Sa(e){return X({__tauriModule:"Clipboard",message:{cmd:"writeText",data:e}})}async function va(){return X({__tauriModule:"Clipboard",message:{cmd:"readText",data:null}})}async function Ai(e={}){return typeof e=="object"&&Object.freeze(e),X({__tauriModule:"Dialog",message:{cmd:"openDialog",options:e}})}async function wl(e={}){return typeof e=="object"&&Object.freeze(e),X({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:e}})}async function ur(e,t){return X({__tauriModule:"Event",message:{cmd:"unlisten",event:e,eventId:t}})}async function ka(e,t,n){await X({__tauriModule:"Event",message:{cmd:"emit",event:e,windowLabel:t,payload:n}})}async function dr(e,t,n){return X({__tauriModule:"Event",message:{cmd:"listen",event:e,windowLabel:t,handler:ji(n)}}).then(s=>async()=>ur(e,s))}async function Ca(e,t,n){return dr(e,t,s=>{n(s),ur(e,s.id).catch(()=>{})})}var Wt;(function(e){e.WINDOW_RESIZED="tauri://resize",e.WINDOW_MOVED="tauri://move",e.WINDOW_CLOSE_REQUESTED="tauri://close-requested",e.WINDOW_CREATED="tauri://window-created",e.WINDOW_DESTROYED="tauri://destroyed",e.WINDOW_FOCUS="tauri://focus",e.WINDOW_BLUR="tauri://blur",e.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",e.WINDOW_THEME_CHANGED="tauri://theme-changed",e.WINDOW_FILE_DROP="tauri://file-drop",e.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",e.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",e.MENU="tauri://menu",e.CHECK_UPDATE="tauri://update",e.UPDATE_AVAILABLE="tauri://update-available",e.INSTALL_UPDATE="tauri://update-install",e.STATUS_UPDATE="tauri://update-status",e.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Wt||(Wt={}));var Sl;(function(e){e[e.Audio=1]="Audio",e[e.Cache=2]="Cache",e[e.Config=3]="Config",e[e.Data=4]="Data",e[e.LocalData=5]="LocalData",e[e.Desktop=6]="Desktop",e[e.Document=7]="Document",e[e.Download=8]="Download",e[e.Executable=9]="Executable",e[e.Font=10]="Font",e[e.Home=11]="Home",e[e.Picture=12]="Picture",e[e.Public=13]="Public",e[e.Runtime=14]="Runtime",e[e.Template=15]="Template",e[e.Video=16]="Video",e[e.Resource=17]="Resource",e[e.App=18]="App",e[e.Log=19]="Log",e[e.Temp=20]="Temp",e[e.AppConfig=21]="AppConfig",e[e.AppData=22]="AppData",e[e.AppLocalData=23]="AppLocalData",e[e.AppCache=24]="AppCache",e[e.AppLog=25]="AppLog"})(Sl||(Sl={}));async function vl(e,t={}){return X({__tauriModule:"Fs",message:{cmd:"readTextFile",path:e,options:t}})}async function Ma(e,t,n){typeof n=="object"&&Object.freeze(n),typeof e=="object"&&Object.freeze(e);const s={path:"",contents:""};let i=n;return typeof e=="string"?s.path=e:(s.path=e.path,s.contents=e.contents),typeof t=="string"?s.contents=t??"":i=t,X({__tauriModule:"Fs",message:{cmd:"writeFile",path:s.path,contents:Array.from(new TextEncoder().encode(s.contents)),options:i}})}var kl;(function(e){e[e.JSON=1]="JSON",e[e.Text=2]="Text",e[e.Binary=3]="Binary"})(kl||(kl={}));function al(){return navigator.appVersion.includes("Win")}const Ta=al()?"\\":"/";al();class Ea{constructor(t,n){this.type="Logical",this.width=t,this.height=n}}class Gi{constructor(t,n){this.type="Physical",this.width=t,this.height=n}toLogical(t){return new Ea(this.width/t,this.height/t)}}class Pa{constructor(t,n){this.type="Logical",this.x=t,this.y=n}}class Bi{constructor(t,n){this.type="Physical",this.x=t,this.y=n}toLogical(t){return new Pa(this.x/t,this.y/t)}}var Ki;(function(e){e[e.Critical=1]="Critical",e[e.Informational=2]="Informational"})(Ki||(Ki={}));function Cl(){return window.__TAURI_METADATA__.__windows.map(e=>new vs(e.label,{skip:!0}))}const Ml=["tauri://created","tauri://error"];class Oa{constructor(t){this.label=t,this.listeners=Object.create(null)}async listen(t,n){return this._handleTauriEvent(t,n)?Promise.resolve(()=>{const s=this.listeners[t];s.splice(s.indexOf(n),1)}):dr(t,this.label,n)}async once(t,n){return this._handleTauriEvent(t,n)?Promise.resolve(()=>{const s=this.listeners[t];s.splice(s.indexOf(n),1)}):Ca(t,this.label,n)}async emit(t,n){if(Ml.includes(t)){for(const s of this.listeners[t]||[])s({event:t,id:-1,windowLabel:this.label,payload:n});return Promise.resolve()}return ka(t,this.label,n)}_handleTauriEvent(t,n){return Ml.includes(t)?(t in this.listeners?this.listeners[t].push(n):this.listeners[t]=[n],!0):!1}}class Ra extends Oa{async scaleFactor(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"scaleFactor"}}}})}async innerPosition(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerPosition"}}}}).then(({x:t,y:n})=>new Bi(t,n))}async outerPosition(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerPosition"}}}}).then(({x:t,y:n})=>new Bi(t,n))}async innerSize(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerSize"}}}}).then(({width:t,height:n})=>new Gi(t,n))}async outerSize(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerSize"}}}}).then(({width:t,height:n})=>new Gi(t,n))}async isFullscreen(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isFullscreen"}}}})}async isMinimized(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMinimized"}}}})}async isMaximized(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMaximized"}}}})}async isFocused(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isFocused"}}}})}async isDecorated(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isDecorated"}}}})}async isResizable(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isResizable"}}}})}async isMaximizable(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMaximizable"}}}})}async isMinimizable(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMinimizable"}}}})}async isClosable(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isClosable"}}}})}async isVisible(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isVisible"}}}})}async title(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"title"}}}})}async theme(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"theme"}}}})}async center(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"center"}}}})}async requestUserAttention(t){let n=null;return t&&(t===Ki.Critical?n={type:"Critical"}:n={type:"Informational"}),X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"requestUserAttention",payload:n}}}})}async setResizable(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setResizable",payload:t}}}})}async setMaximizable(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMaximizable",payload:t}}}})}async setMinimizable(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMinimizable",payload:t}}}})}async setClosable(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setClosable",payload:t}}}})}async setTitle(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setTitle",payload:t}}}})}async maximize(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"maximize"}}}})}async unmaximize(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unmaximize"}}}})}async toggleMaximize(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"toggleMaximize"}}}})}async minimize(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"minimize"}}}})}async unminimize(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unminimize"}}}})}async show(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"show"}}}})}async hide(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"hide"}}}})}async close(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"close"}}}})}async setDecorations(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setDecorations",payload:t}}}})}async setAlwaysOnTop(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setAlwaysOnTop",payload:t}}}})}async setContentProtected(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setContentProtected",payload:t}}}})}async setSize(t){if(!t||t.type!=="Logical"&&t.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSize",payload:{type:t.type,data:{width:t.width,height:t.height}}}}}})}async setMinSize(t){if(t&&t.type!=="Logical"&&t.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMinSize",payload:t?{type:t.type,data:{width:t.width,height:t.height}}:null}}}})}async setMaxSize(t){if(t&&t.type!=="Logical"&&t.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMaxSize",payload:t?{type:t.type,data:{width:t.width,height:t.height}}:null}}}})}async setPosition(t){if(!t||t.type!=="Logical"&&t.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setPosition",payload:{type:t.type,data:{x:t.x,y:t.y}}}}}})}async setFullscreen(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFullscreen",payload:t}}}})}async setFocus(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFocus"}}}})}async setIcon(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIcon",payload:{icon:typeof t=="string"?t:Array.from(t)}}}}})}async setSkipTaskbar(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSkipTaskbar",payload:t}}}})}async setCursorGrab(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorGrab",payload:t}}}})}async setCursorVisible(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorVisible",payload:t}}}})}async setCursorIcon(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorIcon",payload:t}}}})}async setCursorPosition(t){if(!t||t.type!=="Logical"&&t.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorPosition",payload:{type:t.type,data:{x:t.x,y:t.y}}}}}})}async setIgnoreCursorEvents(t){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIgnoreCursorEvents",payload:t}}}})}async startDragging(){return X({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"startDragging"}}}})}async onResized(t){return this.listen(Wt.WINDOW_RESIZED,n=>{n.payload=Da(n.payload),t(n)})}async onMoved(t){return this.listen(Wt.WINDOW_MOVED,n=>{n.payload=La(n.payload),t(n)})}async onCloseRequested(t){return this.listen(Wt.WINDOW_CLOSE_REQUESTED,n=>{const s=new Aa(n);Promise.resolve(t(s)).then(()=>{if(!s.isPreventDefault())return this.close()})})}async onFocusChanged(t){const n=await this.listen(Wt.WINDOW_FOCUS,i=>{t({...i,payload:!0})}),s=await this.listen(Wt.WINDOW_BLUR,i=>{t({...i,payload:!1})});return()=>{n(),s()}}async onScaleChanged(t){return this.listen(Wt.WINDOW_SCALE_FACTOR_CHANGED,t)}async onMenuClicked(t){return this.listen(Wt.MENU,t)}async onFileDropEvent(t){const n=await this.listen(Wt.WINDOW_FILE_DROP,l=>{t({...l,payload:{type:"drop",paths:l.payload}})}),s=await this.listen(Wt.WINDOW_FILE_DROP_HOVER,l=>{t({...l,payload:{type:"hover",paths:l.payload}})}),i=await this.listen(Wt.WINDOW_FILE_DROP_CANCELLED,l=>{t({...l,payload:{type:"cancel"}})});return()=>{n(),s(),i()}}async onThemeChanged(t){return this.listen(Wt.WINDOW_THEME_CHANGED,t)}}class Aa{constructor(t){this._preventDefault=!1,this.event=t.event,this.windowLabel=t.windowLabel,this.id=t.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}class vs extends Ra{constructor(t,n={}){super(t),n!=null&&n.skip||X({__tauriModule:"Window",message:{cmd:"createWebview",data:{options:{label:t,...n}}}}).then(async()=>this.emit("tauri://created")).catch(async s=>this.emit("tauri://error",s))}static getByLabel(t){return Cl().some(n=>n.label===t)?new vs(t,{skip:!0}):null}static async getFocusedWindow(){for(const t of Cl())if(await t.isFocused())return t;return null}}"__TAURI_METADATA__"in window?new vs(window.__TAURI_METADATA__.__currentWindow.label,{skip:!0}):(console.warn(`Could not find "window.__TAURI_METADATA__". The "appWindow" value will reference the "main" window label.
Note that this is not an issue if running this frontend on a browser instead of a Tauri window.`),new vs("main",{skip:!0}));function La(e){return new Bi(e.x,e.y)}function Da(e){return new Gi(e.width,e.height)}al();async function Wa(){return X({__tauriModule:"Os",message:{cmd:"osType"}})}function ze(e){if(!e)throw Error("assertion failed")}const Vt={OSType:await Wa(),pathSeparator:Ta,ctrlKey:()=>Vt.OSType=="Darwin"?"Meta":"Control",getFilename(e){return e.split(Vt.pathSeparator).at(-1)},escapeRegexp(e){return e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")},splitPrintingWords(e){return e.split(/(\n)/u).flatMap(t=>t.split(new RegExp("(?<=[^\\u4E00-\\u9FFF])(?=[\\u4E00-\\u9FFF])|(?<= )|(?<=[\\u4E00-\\u9FFF])(?=[\\u0000-\\u00FF\\u4E00-\\u9FFF])","u")))},timeout(e,t){return Promise.race([t,new Promise((n,s)=>setTimeout(()=>s("timeout"),e))])}},Tl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function bs(e){return e=Math.round(e),e<0?0:e>255?255:e}function hr(e){return e<0?0:e>1?1:e}function Na(e){return e[e.length-1]==="%"?bs(Number(e.slice(0,-1))/100*255):bs(Number(e))}function Xi(e){return e[e.length-1]!=="%"?null:hr(Number(e.slice(0,-1))/100)}function Fa(e){return Xi(e)??hr(Number(e))}function Li(e,t,n){return n<0?n+=1:n>1&&(n-=1),n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}function El(e){return e<48?NaN:e<=57?e-48:e<97?NaN:e<=102?e-87:NaN}const Ia=new Set([" ","	",`
`,"\r",",","/"]);function za(e){return e.endsWith("deg")?Number(e.slice(0,-3)):e.endsWith("grad")?Number(e.slice(0,-4))*360/400:e.endsWith("rad")?Number(e.slice(0,-3))*360/(2*Math.PI):e.endsWith("turn")?Number(e.slice(0,-4))*360:Number(e)}function Ua(e){const t=e.trim().toLowerCase();if(t in Tl)return Tl[t].slice();if(t[0]==="#"){const i=t.length===4||t.length===5,l=t.length===7||t.length===9;if(!i&&!l)return null;const r=i?1:2,h=[0,0,0,255],u=t.length===5||t.length===9?4:3;for(let d=0;d<u;d++){const f=El(t.charCodeAt(d*r+1));if(h[d]=16*f+(i?f:El(t.charCodeAt(d*r+2))),Number.isNaN(h[d]))return null}return h[3]/=255,h}const n=t.indexOf("(");let s=t.indexOf(")");if(s===-1&&(s=t.length),n!==-1&&(s+1===t.length||s===t.length)){const i=t.substr(0,n),l=[];let r="";for(let C=n+1;C<s;C++)Ia.has(t[C])?r.length!==0&&(l.push(r),r=""):r+=t[C];r.length!==0&&l.push(r);const h=l.length===4?Fa(l.pop()):1;if(l.length!==3)return null;let u,d,f,g,p,w;switch(i){case"rgba":case"rgb":return w=[...l.map(Na),h],w.some(Number.isNaN)?null:w;case"hsla":case"hsl":return u=(za(l[0])%360+360)%360/360,Number.isNaN(u)||(d=Xi(l[1]),Number.isNaN(d)||d===null)||(f=Xi(l[2]),Number.isNaN(f)||f===null)?null:(p=f<=.5?f*(d+1):f+d-f*d,g=f*2-p,[bs(Li(g,p,u+1/3)*255),bs(Li(g,p,u)*255),bs(Li(g,p,u-1/3)*255),h]);default:return null}}return null}var _t=(e=>(e[e.BottomLeft=1]="BottomLeft",e[e.BottomCenter=2]="BottomCenter",e[e.BottomRight=3]="BottomRight",e[e.CenterLeft=4]="CenterLeft",e[e.Center=5]="Center",e[e.CenterRight=6]="CenterRight",e[e.TopLeft=7]="TopLeft",e[e.TopCenter=8]="TopCenter",e[e.TopRight=9]="TopRight",e))(_t||{}),ol=(e=>(e[e.KeepAll=0]="KeepAll",e[e.KeepDifferent=1]="KeepDifferent",e[e.UseLocalByName=2]="UseLocalByName",e[e.Overwrite=3]="Overwrite",e[e.UseOverrideForAll=4]="UseOverrideForAll",e))(ol||{}),ul=(e=>(e[e.SortedBefore=0]="SortedBefore",e[e.SortedAfter=1]="SortedAfter",e[e.Before=2]="Before",e[e.After=3]="After",e[e.Overwrite=4]="Overwrite",e[e.Custom=5]="Custom",e))(ul||{}),Cs;const En=class En{constructor(t){te(this,"font","");te(this,"size",72);te(this,"color","white");te(this,"outlineColor","black");te(this,"outline",1);te(this,"shadow",0);te(this,"styles",{bold:!1,italic:!1,underline:!1,strikethrough:!1});te(this,"margin",{top:10,bottom:10,left:10,right:10});te(this,"alignment",2);te(this,"uniqueID");this.name=t,this.uniqueID=a(En,Cs),Tn(En,Cs)._++}clone(){return En.deserialize(this.toSerializable())}equals(t){return JSON.stringify(this.toSerializable())==JSON.stringify(t.toSerializable())}toSerializable(){return{name:this.name,color:this.color,outlineColor:this.outlineColor,outline:this.outline,shadow:this.shadow,styles:this.styles,font:this.font,size:this.size,margin:this.margin,alignment:this.alignment}}static deserialize(t){let n=new En(t.name);return t.font!==void 0&&(n.font=t.font),t.size!==void 0&&(n.size=t.size),t.color!==void 0&&(n.color=t.color),t.shadow!==void 0&&(n.shadow=t.shadow),t.outline!==void 0&&(n.outline=t.outline),t.styles!==void 0&&(n.styles=t.styles),t.outlineColor!==void 0&&(n.outlineColor=t.outlineColor),t.margin!==void 0&&(n.margin=t.margin),t.alignment!==void 0&&(n.alignment=t.alignment),n}};Cs=new WeakMap,A(En,Cs,0);let vn=En;var Ms;const Bn=class Bn{constructor(t,n,...s){te(this,"texts",[]);te(this,"gui");te(this,"uniqueID");this.start=t,this.end=n,this.texts=s,this.uniqueID=a(Bn,Ms),Tn(Bn,Ms)._++}toSerializable(){return{start:this.start,end:this.end,texts:this.texts.map(t=>[t.style.name,t.text])}}static deserialize(t,n){return new Bn(t.start,t.end,...t.texts.map(s=>({style:n.styles.find(i=>i.name==s[0])??n.defaultStyle,text:s[1]})))}};Ms=new WeakMap,A(Bn,Ms,0);let Ft=Bn;class kn{constructor(t){te(this,"defaultStyle");te(this,"styles",[]);te(this,"entries",[]);te(this,"title","");te(this,"language","");te(this,"width",1920);te(this,"height",1080);t?(this.defaultStyle=t.defaultStyle.clone(),this.styles=t.styles.map(n=>n.clone())):this.defaultStyle=new vn("default")}merge(t,n){let s=new Map,i=u=>{if(s.has(u))return s.get(u);let d=this.styles.findIndex(g=>g.name==u.name),f=u.name==this.defaultStyle.name;if(d<0&&!f)return this.styles.push(u),s.set(u,u),u;switch(n.style??1){case 1:if(u.equals(f?this.defaultStyle:this.styles[d]))return f?s.set(u,this.defaultStyle):s.set(u,this.styles[d]),s.get(u);case 0:let g=u.clone();return g.name=ks.getUniqueStyleName(this,u.name),this.styles.push(g),s.set(u,g),g;case 2:return f?s.set(u,this.defaultStyle):s.set(u,this.styles[d]),s.get(u);case 3:return this.styles.splice(d,1,u),s.set(u,u),u;case 4:return s.set(u,n.overrideStyle??this.defaultStyle),s.get(u);default:ze(!1)}};if(n.importAllStyles)for(let u of t.styles)i(u);let l=n.position??3;l==4&&(this.entries=[]);let r,h=n.customPosition??0;switch(l){case 0:r=u=>{let d=this.entries.findIndex(f=>f.start>=u.start);this.entries.splice(d,0,u)};break;case 1:r=u=>{let d=this.entries.findLastIndex(f=>f.start<=u.start);this.entries.splice(d+1,0,u)};break;case 2:case 5:r=u=>{this.entries.splice(h,0,u),h++};break;case 3:case 4:r=u=>{this.entries.push(u)};break;default:ze(!1)}for(let u of t.entries){r(u);for(let d of u.texts)d.style=i(d.style)}}shiftTimes(t){let n=t.modifySince??!1,s=t.offset??0,i=t.scale??1;if(s==0&&i==1)return!1;let l=t.selection??this.entries,r=new Set(l),h=Math.min(...l.map(u=>u.start));for(let u of this.entries)(r.has(u)||u.start>=h&&n)&&(u.start=Math.max(0,u.start*i+s),u.end=Math.max(0,u.end*i+s));return!0}toSerializable(){return{width:this.width,height:this.height,title:this.title,language:this.language,defaultStyle:this.defaultStyle.toSerializable(),styles:this.styles.map(t=>t.toSerializable()),entries:this.entries.map(t=>t.toSerializable())}}static deserialize(t){let n=new kn;return n.width=t.width??1920,n.height=t.height??1080,n.title=t.title??"",n.language=t.language??"",n.defaultStyle=vn.deserialize(t.defaultStyle),n.styles=t.styles.map(s=>vn.deserialize(s)),n.entries=t.entries.map(s=>Ft.deserialize(s,n)).filter(s=>s.texts.length>0),n}}function Vs(e){let t=Ua(e);return t?"&H"+((1-t[3])*255).toString(16).toUpperCase().padStart(2,"0")+t[2].toString(16).toUpperCase().padStart(2,"0")+t[1].toString(16).toUpperCase().padStart(2,"0")+t[0].toString(16).toUpperCase().padStart(2,"0"):"&H00FFFFFF"}const cn={JSON(e){return JSON.stringify(e.toSerializable())},SRT(e){let t="",n=1;for(let s of e.entries)t+=`${n}
${lt.formatTimestamp(s.start,3,",")} --> ${lt.formatTimestamp(s.end,3,",")}
${s.texts.map(i=>i.text).join(`
`)}

`,n+=1;return t},ASS(e){return cn.ASSHeader(e)+cn.ASSFragment(e)},ASSHeader(e){let t=`[Script Info]
ScriptType: v4.00+
YCbCr Matrix: None
PlayResX: ${e.width}
PlayResY: ${e.height}
LayoutResX: ${e.width}
LayoutResY: ${e.height}

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
`;for(let n of[e.defaultStyle,...e.styles])t+=`Style: ${n.name},${n.font==""?"Arial":""},${n.size},${Vs(n.color)},${Vs(n.color)},${Vs(n.outlineColor)},${Vs(n.outlineColor)},${n.styles.bold?"-1":"0"},${n.styles.italic?"-1":"0"},${n.styles.underline?"-1":"0"},${n.styles.strikethrough?"-1":"0"},100,100,0,0,1,1,0,${n.alignment},${n.margin.left},${n.margin.right},${Math.max(n.margin.top,n.margin.bottom)},1
`;return t+=`
[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
`,t},ASSFragment(e){let t="";for(let n of e.entries){let s=lt.formatTimestamp(n.start,2),i=lt.formatTimestamp(n.end,2);for(let l of n.texts)t+=`Dialogue: 0,${s},${i},${l.style.name},,0,0,0,,${l.text.replaceAll(`
`,"\\N")}
`}return t},plaintext(e){return e.entries.map(t=>t.texts.map(n=>n.text).join(`
`)).join(`
`)}},Di={JSON(e){try{return kn.deserialize(JSON.parse(e))}catch{return null}},SRT(e){const t=/\n(\d+:\d+:\d+[,.]\d+)\s-->\s(\d+:\d+:\d+[,.]\d+)\n((.+\n)+)$/gm;let n=[...e.matchAll(t)];if(n.length==0)return null;let s=new kn;for(let i of n){let l=lt.parseTimestamp(i[1]),r=lt.parseTimestamp(i[2]);l===null||r===null||s.entries.push(new Ft(l,r,{style:s.defaultStyle,text:i[3].trimEnd()}))}return s},ASSFragment(e){const t=/^Dialogue: \d+,([\d:.]+),([\d:.]+),(.+),,\d+,\d+,\d+,,(.+)$/gm;let n=[...e.matchAll(t)];if(n.length==0)return null;let s=new kn,i=new Map;for(let l of n){let r=lt.parseTimestamp(l[1]),h=lt.parseTimestamp(l[2]);if(!(r===null||h===null)){if(!i.has(l[3])){let u=new vn(l[3]);i.set(l[3],u),s.styles.push(u)}s.entries.push(new Ft(r,h,{style:i.get(l[3]),text:l[4].replaceAll("\\N",`
`).trimEnd()}))}}return s}},ks={alignTimes:(e,t)=>{for(let n=0;n<e.entries.length-1;n++){let s=e.entries[n].start,i=e.entries[n].end;for(let l=n+1;l<e.entries.length;l++){let r=e.entries[l].start,h=e.entries[l].end;Math.abs(r-s)<=t&&(e.entries[l].start=s),Math.abs(h-i)<=t&&(e.entries[l].end=i)}}},replaceStyle:(e,t,n)=>{let s=!1;for(let i of e)for(let l of i.texts)l.style==t&&(l.style=n,s=!0);return s},makeTestSubtitles:()=>{let e=new kn;for(let t=0;t<75;t++)e.entries.push(new Ft(t*5,t*5+5,{style:e.defaultStyle,text:`test line ${t}`}));return e},getUniqueStyleName:(e,t)=>{let n=1,s=t;for(;e.styles.find(i=>i.name==s)||s==e.defaultStyle.name;)s=t+`_${n}`,n++;return s}},lt={parseTimestamp:e=>{let n=/(\d+):(\d+):(\d+)[,.](\d+)/.exec(e);if(!n)return null;let s=parseInt(n[1]),i=parseInt(n[2]),l=parseFloat(n[3]+"."+n[4]),r=s*3600+i*60+l;return isNaN(r)?null:r},formatTimestamp:(e,t=3,n=".")=>{let s=Math.floor(e/3600).toString().padStart(2,"0"),i=Math.floor(e%3600/60).toString().padStart(2,"0"),l=Math.floor(e%60).toString().padStart(2,"0"),r=(e%1).toFixed(t).slice(2);return`${s}:${i}:${l}${n}${r}`},getTextLength:e=>[...e.matchAll(/[\w\u4E00-\u9FFF]/g)].length,normalizeNewlines:e=>e.replaceAll(`\r
`,`
`).replaceAll("\r",`
`)};var Ha=Object.defineProperty,Tt=(e,t)=>{for(var n in t)Ha(e,n,{get:t[n],enumerable:!0})},qa={};Tt(qa,{convertFileSrc:()=>ja,invoke:()=>dl,transformCallback:()=>In});function Va(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function In(e,t=!1){let n=Va(),s=`_${n}`;return Object.defineProperty(window,s,{value:i=>(t&&Reflect.deleteProperty(window,s),e==null?void 0:e(i)),writable:!1,configurable:!0}),n}async function dl(e,t={}){return new Promise((n,s)=>{let i=In(r=>{n(r),Reflect.deleteProperty(window,`_${l}`)},!0),l=In(r=>{s(r),Reflect.deleteProperty(window,`_${i}`)},!0);window.__TAURI_IPC__({cmd:e,callback:i,error:l,...t})})}function ja(e,t="asset"){return window.__TAURI__.convertFileSrc(e,t)}async function S(e){return dl("tauri",e)}var Ga={};Tt(Ga,{TauriEvent:()=>pr,emit:()=>cl,listen:()=>Ei,once:()=>gr});async function cr(e,t){return S({__tauriModule:"Event",message:{cmd:"unlisten",event:e,eventId:t}})}async function fr(e,t,n){await S({__tauriModule:"Event",message:{cmd:"emit",event:e,windowLabel:t,payload:n}})}async function hl(e,t,n){return S({__tauriModule:"Event",message:{cmd:"listen",event:e,windowLabel:t,handler:In(n)}}).then(s=>async()=>cr(e,s))}async function mr(e,t,n){return hl(e,t,s=>{n(s),cr(e,s.id).catch(()=>{})})}var pr=(e=>(e.WINDOW_RESIZED="tauri://resize",e.WINDOW_MOVED="tauri://move",e.WINDOW_CLOSE_REQUESTED="tauri://close-requested",e.WINDOW_CREATED="tauri://window-created",e.WINDOW_DESTROYED="tauri://destroyed",e.WINDOW_FOCUS="tauri://focus",e.WINDOW_BLUR="tauri://blur",e.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",e.WINDOW_THEME_CHANGED="tauri://theme-changed",e.WINDOW_FILE_DROP="tauri://file-drop",e.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",e.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",e.MENU="tauri://menu",e.CHECK_UPDATE="tauri://update",e.UPDATE_AVAILABLE="tauri://update-available",e.INSTALL_UPDATE="tauri://update-install",e.STATUS_UPDATE="tauri://update-status",e.DOWNLOAD_PROGRESS="tauri://update-download-progress",e))(pr||{});async function Ei(e,t){return hl(e,null,t)}async function gr(e,t){return mr(e,null,t)}async function cl(e,t){return fr(e,void 0,t)}var Ba={};Tt(Ba,{checkUpdate:()=>Xa,installUpdate:()=>Ka,onUpdaterEvent:()=>fl});async function fl(e){return Ei("tauri://update-status",t=>{e(t==null?void 0:t.payload)})}async function Ka(){let e;function t(){e&&e(),e=void 0}return new Promise((n,s)=>{function i(l){if(l.error){t(),s(l.error);return}l.status==="DONE"&&(t(),n())}fl(i).then(l=>{e=l}).catch(l=>{throw t(),l}),cl("tauri://update-install").catch(l=>{throw t(),l})})}async function Xa(){let e;function t(){e&&e(),e=void 0}return new Promise((n,s)=>{function i(r){t(),n({manifest:r,shouldUpdate:!0})}function l(r){if(r.error){t(),s(r.error);return}r.status==="UPTODATE"&&(t(),n({shouldUpdate:!1}))}gr("tauri://update-available",r=>{i(r==null?void 0:r.payload)}).catch(r=>{throw t(),r}),fl(l).then(r=>{e=r}).catch(r=>{throw t(),r}),cl("tauri://update").catch(r=>{throw t(),r})})}var Ya={};Tt(Ya,{CloseRequestedEvent:()=>vr,LogicalPosition:()=>yr,LogicalSize:()=>_r,PhysicalPosition:()=>ti,PhysicalSize:()=>ei,UserAttentionType:()=>br,WebviewWindow:()=>us,WebviewWindowHandle:()=>wr,WindowManager:()=>Sr,appWindow:()=>Ji,availableMonitors:()=>xa,currentMonitor:()=>Za,getAll:()=>Yi,getCurrent:()=>Ja,primaryMonitor:()=>Qa});var _r=class{constructor(e,t){this.type="Logical",this.width=e,this.height=t}},ei=class{constructor(e,t){this.type="Physical",this.width=e,this.height=t}toLogical(e){return new _r(this.width/e,this.height/e)}},yr=class{constructor(e,t){this.type="Logical",this.x=e,this.y=t}},ti=class{constructor(e,t){this.type="Physical",this.x=e,this.y=t}toLogical(e){return new yr(this.x/e,this.y/e)}},br=(e=>(e[e.Critical=1]="Critical",e[e.Informational=2]="Informational",e))(br||{});function Ja(){return new us(window.__TAURI_METADATA__.__currentWindow.label,{skip:!0})}function Yi(){return window.__TAURI_METADATA__.__windows.map(e=>new us(e.label,{skip:!0}))}var Pl=["tauri://created","tauri://error"],wr=class{constructor(e){this.label=e,this.listeners=Object.create(null)}async listen(e,t){return this._handleTauriEvent(e,t)?Promise.resolve(()=>{let n=this.listeners[e];n.splice(n.indexOf(t),1)}):hl(e,this.label,t)}async once(e,t){return this._handleTauriEvent(e,t)?Promise.resolve(()=>{let n=this.listeners[e];n.splice(n.indexOf(t),1)}):mr(e,this.label,t)}async emit(e,t){if(Pl.includes(e)){for(let n of this.listeners[e]||[])n({event:e,id:-1,windowLabel:this.label,payload:t});return Promise.resolve()}return fr(e,this.label,t)}_handleTauriEvent(e,t){return Pl.includes(e)?(e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t],!0):!1}},Sr=class extends wr{async scaleFactor(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"scaleFactor"}}}})}async innerPosition(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerPosition"}}}}).then(({x:e,y:t})=>new ti(e,t))}async outerPosition(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerPosition"}}}}).then(({x:e,y:t})=>new ti(e,t))}async innerSize(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerSize"}}}}).then(({width:e,height:t})=>new ei(e,t))}async outerSize(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerSize"}}}}).then(({width:e,height:t})=>new ei(e,t))}async isFullscreen(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isFullscreen"}}}})}async isMinimized(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMinimized"}}}})}async isMaximized(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMaximized"}}}})}async isFocused(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isFocused"}}}})}async isDecorated(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isDecorated"}}}})}async isResizable(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isResizable"}}}})}async isMaximizable(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMaximizable"}}}})}async isMinimizable(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMinimizable"}}}})}async isClosable(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isClosable"}}}})}async isVisible(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isVisible"}}}})}async title(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"title"}}}})}async theme(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"theme"}}}})}async center(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"center"}}}})}async requestUserAttention(e){let t=null;return e&&(e===1?t={type:"Critical"}:t={type:"Informational"}),S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"requestUserAttention",payload:t}}}})}async setResizable(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setResizable",payload:e}}}})}async setMaximizable(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMaximizable",payload:e}}}})}async setMinimizable(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMinimizable",payload:e}}}})}async setClosable(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setClosable",payload:e}}}})}async setTitle(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setTitle",payload:e}}}})}async maximize(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"maximize"}}}})}async unmaximize(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unmaximize"}}}})}async toggleMaximize(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"toggleMaximize"}}}})}async minimize(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"minimize"}}}})}async unminimize(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unminimize"}}}})}async show(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"show"}}}})}async hide(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"hide"}}}})}async close(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"close"}}}})}async setDecorations(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setDecorations",payload:e}}}})}async setAlwaysOnTop(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setAlwaysOnTop",payload:e}}}})}async setContentProtected(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setContentProtected",payload:e}}}})}async setSize(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSize",payload:{type:e.type,data:{width:e.width,height:e.height}}}}}})}async setMinSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMinSize",payload:e?{type:e.type,data:{width:e.width,height:e.height}}:null}}}})}async setMaxSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMaxSize",payload:e?{type:e.type,data:{width:e.width,height:e.height}}:null}}}})}async setPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setPosition",payload:{type:e.type,data:{x:e.x,y:e.y}}}}}})}async setFullscreen(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFullscreen",payload:e}}}})}async setFocus(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFocus"}}}})}async setIcon(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIcon",payload:{icon:typeof e=="string"?e:Array.from(e)}}}}})}async setSkipTaskbar(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSkipTaskbar",payload:e}}}})}async setCursorGrab(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorGrab",payload:e}}}})}async setCursorVisible(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorVisible",payload:e}}}})}async setCursorIcon(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorIcon",payload:e}}}})}async setCursorPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorPosition",payload:{type:e.type,data:{x:e.x,y:e.y}}}}}})}async setIgnoreCursorEvents(e){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIgnoreCursorEvents",payload:e}}}})}async startDragging(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"startDragging"}}}})}async onResized(e){return this.listen("tauri://resize",t=>{t.payload=Cr(t.payload),e(t)})}async onMoved(e){return this.listen("tauri://move",t=>{t.payload=kr(t.payload),e(t)})}async onCloseRequested(e){return this.listen("tauri://close-requested",t=>{let n=new vr(t);Promise.resolve(e(n)).then(()=>{if(!n.isPreventDefault())return this.close()})})}async onFocusChanged(e){let t=await this.listen("tauri://focus",s=>{e({...s,payload:!0})}),n=await this.listen("tauri://blur",s=>{e({...s,payload:!1})});return()=>{t(),n()}}async onScaleChanged(e){return this.listen("tauri://scale-change",e)}async onMenuClicked(e){return this.listen("tauri://menu",e)}async onFileDropEvent(e){let t=await this.listen("tauri://file-drop",i=>{e({...i,payload:{type:"drop",paths:i.payload}})}),n=await this.listen("tauri://file-drop-hover",i=>{e({...i,payload:{type:"hover",paths:i.payload}})}),s=await this.listen("tauri://file-drop-cancelled",i=>{e({...i,payload:{type:"cancel"}})});return()=>{t(),n(),s()}}async onThemeChanged(e){return this.listen("tauri://theme-changed",e)}},vr=class{constructor(e){this._preventDefault=!1,this.event=e.event,this.windowLabel=e.windowLabel,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}},us=class extends Sr{constructor(e,t={}){super(e),t!=null&&t.skip||S({__tauriModule:"Window",message:{cmd:"createWebview",data:{options:{label:e,...t}}}}).then(async()=>this.emit("tauri://created")).catch(async n=>this.emit("tauri://error",n))}static getByLabel(e){return Yi().some(t=>t.label===e)?new us(e,{skip:!0}):null}static async getFocusedWindow(){for(let e of Yi())if(await e.isFocused())return e;return null}},Ji;"__TAURI_METADATA__"in window?Ji=new us(window.__TAURI_METADATA__.__currentWindow.label,{skip:!0}):(console.warn(`Could not find "window.__TAURI_METADATA__". The "appWindow" value will reference the "main" window label.
Note that this is not an issue if running this frontend on a browser instead of a Tauri window.`),Ji=new us("main",{skip:!0}));function ml(e){return e===null?null:{name:e.name,scaleFactor:e.scaleFactor,position:kr(e.position),size:Cr(e.size)}}function kr(e){return new ti(e.x,e.y)}function Cr(e){return new ei(e.width,e.height)}async function Za(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{cmd:{type:"currentMonitor"}}}}).then(ml)}async function Qa(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{cmd:{type:"primaryMonitor"}}}}).then(ml)}async function xa(){return S({__tauriModule:"Window",message:{cmd:"manage",data:{cmd:{type:"availableMonitors"}}}}).then(e=>e.map(ml))}var $a={};Tt($a,{isPermissionGranted:()=>eo,requestPermission:()=>to,sendNotification:()=>no});async function eo(){return window.Notification.permission!=="default"?Promise.resolve(window.Notification.permission==="granted"):S({__tauriModule:"Notification",message:{cmd:"isNotificationPermissionGranted"}})}async function to(){return window.Notification.requestPermission()}function no(e){typeof e=="string"?new window.Notification(e):new window.Notification(e.title,e)}function pl(){return navigator.appVersion.includes("Win")}var so={};Tt(so,{EOL:()=>io,arch:()=>oo,locale:()=>ho,platform:()=>lo,tempdir:()=>uo,type:()=>ao,version:()=>ro});var io=pl()?`\r
`:`
`;async function lo(){return S({__tauriModule:"Os",message:{cmd:"platform"}})}async function ro(){return S({__tauriModule:"Os",message:{cmd:"version"}})}async function ao(){return S({__tauriModule:"Os",message:{cmd:"osType"}})}async function oo(){return S({__tauriModule:"Os",message:{cmd:"arch"}})}async function uo(){return S({__tauriModule:"Os",message:{cmd:"tempdir"}})}async function ho(){return S({__tauriModule:"Os",message:{cmd:"locale"}})}var co={};Tt(co,{BaseDirectory:()=>ni,Dir:()=>ni,copyFile:()=>bo,createDir:()=>_o,exists:()=>vo,readBinaryFile:()=>mo,readDir:()=>go,readTextFile:()=>fo,removeDir:()=>yo,removeFile:()=>wo,renameFile:()=>So,writeBinaryFile:()=>po,writeFile:()=>Ol,writeTextFile:()=>Ol});var ni=(e=>(e[e.Audio=1]="Audio",e[e.Cache=2]="Cache",e[e.Config=3]="Config",e[e.Data=4]="Data",e[e.LocalData=5]="LocalData",e[e.Desktop=6]="Desktop",e[e.Document=7]="Document",e[e.Download=8]="Download",e[e.Executable=9]="Executable",e[e.Font=10]="Font",e[e.Home=11]="Home",e[e.Picture=12]="Picture",e[e.Public=13]="Public",e[e.Runtime=14]="Runtime",e[e.Template=15]="Template",e[e.Video=16]="Video",e[e.Resource=17]="Resource",e[e.App=18]="App",e[e.Log=19]="Log",e[e.Temp=20]="Temp",e[e.AppConfig=21]="AppConfig",e[e.AppData=22]="AppData",e[e.AppLocalData=23]="AppLocalData",e[e.AppCache=24]="AppCache",e[e.AppLog=25]="AppLog",e))(ni||{});async function fo(e,t={}){return S({__tauriModule:"Fs",message:{cmd:"readTextFile",path:e,options:t}})}async function mo(e,t={}){let n=await S({__tauriModule:"Fs",message:{cmd:"readFile",path:e,options:t}});return Uint8Array.from(n)}async function Ol(e,t,n){typeof n=="object"&&Object.freeze(n),typeof e=="object"&&Object.freeze(e);let s={path:"",contents:""},i=n;return typeof e=="string"?s.path=e:(s.path=e.path,s.contents=e.contents),typeof t=="string"?s.contents=t??"":i=t,S({__tauriModule:"Fs",message:{cmd:"writeFile",path:s.path,contents:Array.from(new TextEncoder().encode(s.contents)),options:i}})}async function po(e,t,n){typeof n=="object"&&Object.freeze(n),typeof e=="object"&&Object.freeze(e);let s={path:"",contents:[]},i=n;return typeof e=="string"?s.path=e:(s.path=e.path,s.contents=e.contents),t&&"dir"in t?i=t:typeof e=="string"&&(s.contents=t??[]),S({__tauriModule:"Fs",message:{cmd:"writeFile",path:s.path,contents:Array.from(s.contents instanceof ArrayBuffer?new Uint8Array(s.contents):s.contents),options:i}})}async function go(e,t={}){return S({__tauriModule:"Fs",message:{cmd:"readDir",path:e,options:t}})}async function _o(e,t={}){return S({__tauriModule:"Fs",message:{cmd:"createDir",path:e,options:t}})}async function yo(e,t={}){return S({__tauriModule:"Fs",message:{cmd:"removeDir",path:e,options:t}})}async function bo(e,t,n={}){return S({__tauriModule:"Fs",message:{cmd:"copyFile",source:e,destination:t,options:n}})}async function wo(e,t={}){return S({__tauriModule:"Fs",message:{cmd:"removeFile",path:e,options:t}})}async function So(e,t,n={}){return S({__tauriModule:"Fs",message:{cmd:"renameFile",oldPath:e,newPath:t,options:n}})}async function vo(e,t={}){return S({__tauriModule:"Fs",message:{cmd:"exists",path:e,options:t}})}var ko={};Tt(ko,{BaseDirectory:()=>ni,appCacheDir:()=>Eo,appConfigDir:()=>Mr,appDataDir:()=>Mo,appDir:()=>Co,appLocalDataDir:()=>To,appLogDir:()=>Tr,audioDir:()=>Po,basename:()=>eu,cacheDir:()=>Oo,configDir:()=>Ro,dataDir:()=>Ao,delimiter:()=>Yo,desktopDir:()=>Lo,dirname:()=>xo,documentDir:()=>Do,downloadDir:()=>Wo,executableDir:()=>No,extname:()=>$o,fontDir:()=>Fo,homeDir:()=>Io,isAbsolute:()=>tu,join:()=>Qo,localDataDir:()=>zo,logDir:()=>Ko,normalize:()=>Zo,pictureDir:()=>Uo,publicDir:()=>Ho,resolve:()=>Jo,resolveResource:()=>Vo,resourceDir:()=>qo,runtimeDir:()=>jo,sep:()=>Xo,templateDir:()=>Go,videoDir:()=>Bo});async function Co(){return Mr()}async function Mr(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:21}})}async function Mo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:22}})}async function To(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:23}})}async function Eo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:24}})}async function Po(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:1}})}async function Oo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:2}})}async function Ro(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:3}})}async function Ao(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:4}})}async function Lo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:6}})}async function Do(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:7}})}async function Wo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:8}})}async function No(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:9}})}async function Fo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:10}})}async function Io(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:11}})}async function zo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:5}})}async function Uo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:12}})}async function Ho(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:13}})}async function qo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:17}})}async function Vo(e){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:e,directory:17}})}async function jo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:14}})}async function Go(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:15}})}async function Bo(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:16}})}async function Ko(){return Tr()}async function Tr(){return S({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:25}})}var Xo=pl()?"\\":"/",Yo=pl()?";":":";async function Jo(...e){return S({__tauriModule:"Path",message:{cmd:"resolve",paths:e}})}async function Zo(e){return S({__tauriModule:"Path",message:{cmd:"normalize",path:e}})}async function Qo(...e){return S({__tauriModule:"Path",message:{cmd:"join",paths:e}})}async function xo(e){return S({__tauriModule:"Path",message:{cmd:"dirname",path:e}})}async function $o(e){return S({__tauriModule:"Path",message:{cmd:"extname",path:e}})}async function eu(e,t){return S({__tauriModule:"Path",message:{cmd:"basename",path:e,ext:t}})}async function tu(e){return S({__tauriModule:"Path",message:{cmd:"isAbsolute",path:e}})}var nu={};Tt(nu,{exit:()=>su,relaunch:()=>iu});async function su(e=0){return S({__tauriModule:"Process",message:{cmd:"exit",exitCode:e}})}async function iu(){return S({__tauriModule:"Process",message:{cmd:"relaunch"}})}var lu={};Tt(lu,{Child:()=>Er,Command:()=>Pr,EventEmitter:()=>Gs,open:()=>au});async function ru(e,t,n=[],s){return typeof n=="object"&&Object.freeze(n),S({__tauriModule:"Shell",message:{cmd:"execute",program:t,args:n,options:s,onEventFn:In(e)}})}var Gs=class{constructor(){this.eventListeners=Object.create(null)}addListener(e,t){return this.on(e,t)}removeListener(e,t){return this.off(e,t)}on(e,t){return e in this.eventListeners?this.eventListeners[e].push(t):this.eventListeners[e]=[t],this}once(e,t){let n=(...s)=>{this.removeListener(e,n),t(...s)};return this.addListener(e,n)}off(e,t){return e in this.eventListeners&&(this.eventListeners[e]=this.eventListeners[e].filter(n=>n!==t)),this}removeAllListeners(e){return e?delete this.eventListeners[e]:this.eventListeners=Object.create(null),this}emit(e,...t){if(e in this.eventListeners){let n=this.eventListeners[e];for(let s of n)s(...t);return!0}return!1}listenerCount(e){return e in this.eventListeners?this.eventListeners[e].length:0}prependListener(e,t){return e in this.eventListeners?this.eventListeners[e].unshift(t):this.eventListeners[e]=[t],this}prependOnceListener(e,t){let n=(...s)=>{this.removeListener(e,n),t(...s)};return this.prependListener(e,n)}},Er=class{constructor(e){this.pid=e}async write(e){return S({__tauriModule:"Shell",message:{cmd:"stdinWrite",pid:this.pid,buffer:typeof e=="string"?e:Array.from(e)}})}async kill(){return S({__tauriModule:"Shell",message:{cmd:"killChild",pid:this.pid}})}},Pr=class extends Gs{constructor(e,t=[],n){super(),this.stdout=new Gs,this.stderr=new Gs,this.program=e,this.args=typeof t=="string"?[t]:t,this.options=n??{}}static sidecar(e,t=[],n){let s=new Pr(e,t,n);return s.options.sidecar=!0,s}async spawn(){return ru(e=>{switch(e.event){case"Error":this.emit("error",e.payload);break;case"Terminated":this.emit("close",e.payload);break;case"Stdout":this.stdout.emit("data",e.payload);break;case"Stderr":this.stderr.emit("data",e.payload);break}},this.program,this.args,this.options).then(e=>new Er(e))}async execute(){return new Promise((e,t)=>{this.on("error",t);let n=[],s=[];this.stdout.on("data",i=>{n.push(i)}),this.stderr.on("data",i=>{s.push(i)}),this.on("close",i=>{e({code:i.code,signal:i.signal,stdout:n.join(`
`),stderr:s.join(`
`)})}),this.spawn().catch(t)})}};async function au(e,t){return S({__tauriModule:"Shell",message:{cmd:"open",path:e,with:t}})}var ou={};Tt(ou,{getName:()=>du,getTauriVersion:()=>hu,getVersion:()=>uu,hide:()=>fu,show:()=>cu});async function uu(){return S({__tauriModule:"App",message:{cmd:"getAppVersion"}})}async function du(){return S({__tauriModule:"App",message:{cmd:"getAppName"}})}async function hu(){return S({__tauriModule:"App",message:{cmd:"getTauriVersion"}})}async function cu(){return S({__tauriModule:"App",message:{cmd:"show"}})}async function fu(){return S({__tauriModule:"App",message:{cmd:"hide"}})}var mu={};Tt(mu,{getMatches:()=>pu});async function pu(){return S({__tauriModule:"Cli",message:{cmd:"cliMatches"}})}var gu={};Tt(gu,{readText:()=>yu,writeText:()=>_u});async function _u(e){return S({__tauriModule:"Clipboard",message:{cmd:"writeText",data:e}})}async function yu(){return S({__tauriModule:"Clipboard",message:{cmd:"readText",data:null}})}var bu={};Tt(bu,{ask:()=>ku,confirm:()=>Cu,message:()=>vu,open:()=>wu,save:()=>Su});async function wu(e={}){return typeof e=="object"&&Object.freeze(e),S({__tauriModule:"Dialog",message:{cmd:"openDialog",options:e}})}async function Su(e={}){return typeof e=="object"&&Object.freeze(e),S({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:e}})}async function vu(e,t){var s,i;let n=typeof t=="string"?{title:t}:t;return S({__tauriModule:"Dialog",message:{cmd:"messageDialog",message:e.toString(),title:(s=n==null?void 0:n.title)==null?void 0:s.toString(),type:n==null?void 0:n.type,buttonLabel:(i=n==null?void 0:n.okLabel)==null?void 0:i.toString()}})}async function ku(e,t){var s,i,l;let n=typeof t=="string"?{title:t}:t;return S({__tauriModule:"Dialog",message:{cmd:"askDialog",message:e.toString(),title:(s=n==null?void 0:n.title)==null?void 0:s.toString(),type:n==null?void 0:n.type,buttonLabels:[((i=n==null?void 0:n.okLabel)==null?void 0:i.toString())??"Yes",((l=n==null?void 0:n.cancelLabel)==null?void 0:l.toString())??"No"]}})}async function Cu(e,t){var s,i,l;let n=typeof t=="string"?{title:t}:t;return S({__tauriModule:"Dialog",message:{cmd:"confirmDialog",message:e.toString(),title:(s=n==null?void 0:n.title)==null?void 0:s.toString(),type:n==null?void 0:n.type,buttonLabels:[((i=n==null?void 0:n.okLabel)==null?void 0:i.toString())??"Ok",((l=n==null?void 0:n.cancelLabel)==null?void 0:l.toString())??"Cancel"]}})}var Mu={};Tt(Mu,{isRegistered:()=>Pu,register:()=>Tu,registerAll:()=>Eu,unregister:()=>Ou,unregisterAll:()=>Ru});async function Tu(e,t){return S({__tauriModule:"GlobalShortcut",message:{cmd:"register",shortcut:e,handler:In(t)}})}async function Eu(e,t){return S({__tauriModule:"GlobalShortcut",message:{cmd:"registerAll",shortcuts:e,handler:In(t)}})}async function Pu(e){return S({__tauriModule:"GlobalShortcut",message:{cmd:"isRegistered",shortcut:e}})}async function Ou(e){return S({__tauriModule:"GlobalShortcut",message:{cmd:"unregister",shortcut:e}})}async function Ru(){return S({__tauriModule:"GlobalShortcut",message:{cmd:"unregisterAll"}})}var Au={};Tt(Au,{Body:()=>ps,Client:()=>Ar,Response:()=>Rr,ResponseType:()=>Or,fetch:()=>Du,getClient:()=>Lr});var Or=(e=>(e[e.JSON=1]="JSON",e[e.Text=2]="Text",e[e.Binary=3]="Binary",e))(Or||{});async function Lu(e){let t={},n=async(s,i)=>{if(i!==null){let l;typeof i=="string"?l=i:i instanceof Uint8Array||Array.isArray(i)?l=Array.from(i):i instanceof File?l={file:Array.from(new Uint8Array(await i.arrayBuffer())),mime:i.type,fileName:i.name}:typeof i.file=="string"?l={file:i.file,mime:i.mime,fileName:i.fileName}:l={file:Array.from(i.file),mime:i.mime,fileName:i.fileName},t[String(s)]=l}};if(e instanceof FormData)for(let[s,i]of e)await n(s,i);else for(let[s,i]of Object.entries(e))await n(s,i);return t}var ps=class{constructor(e,t){this.type=e,this.payload=t}static form(e){return new ps("Form",e)}static json(e){return new ps("Json",e)}static text(e){return new ps("Text",e)}static bytes(e){return new ps("Bytes",Array.from(e instanceof ArrayBuffer?new Uint8Array(e):e))}},Rr=class{constructor(e){this.url=e.url,this.status=e.status,this.ok=this.status>=200&&this.status<300,this.headers=e.headers,this.rawHeaders=e.rawHeaders,this.data=e.data}},Ar=class{constructor(e){this.id=e}async drop(){return S({__tauriModule:"Http",message:{cmd:"dropClient",client:this.id}})}async request(e){var n;let t=!e.responseType||e.responseType===1;return t&&(e.responseType=2),((n=e.body)==null?void 0:n.type)==="Form"&&(e.body.payload=await Lu(e.body.payload)),S({__tauriModule:"Http",message:{cmd:"httpRequest",client:this.id,options:e}}).then(s=>{let i=new Rr(s);if(t){try{i.data=JSON.parse(i.data)}catch(l){if(i.ok&&i.data==="")i.data={};else if(i.ok)throw Error(`Failed to parse response \`${i.data}\` as JSON: ${l};
              try setting the \`responseType\` option to \`ResponseType.Text\` or \`ResponseType.Binary\` if the API does not return a JSON response.`)}return i}return i})}async get(e,t){return this.request({method:"GET",url:e,...t})}async post(e,t,n){return this.request({method:"POST",url:e,body:t,...n})}async put(e,t,n){return this.request({method:"PUT",url:e,body:t,...n})}async patch(e,t){return this.request({method:"PATCH",url:e,...t})}async delete(e,t){return this.request({method:"DELETE",url:e,...t})}};async function Lr(e){return S({__tauriModule:"Http",message:{cmd:"createClient",options:e}}).then(t=>new Ar(t))}var Wi=null;async function Du(e,t){return Wi===null&&(Wi=await Lr()),Wi.request({url:e,method:(t==null?void 0:t.method)??"GET",...t})}var Wu=dl,Nu="plugin:context_menu|show_context_menu";async function Dr(e,t){let n=[],s=[...e.map(i=>({...i}))];for(let i=0;i<s.length;i++){let l=s[i].event;if(typeof l=="function"){let r=`${t}_context_menu_item_${i}`;n.push(await Ei(r,h=>{let u={...h,payload:e[i].payload};l(u)})),s[i].event=r,s[i].payload=void 0}if(e[i].subitems){let r=await Dr(e[i].subitems,`${t}_${i}`);n.push(...r.unlisteners),s[i].subitems=r.processed}}return{unlisteners:n,processed:s}}async function gl(e){let{unlisteners:t,processed:n}=await Dr(e.items,"root"),s=await Ei("menu-did-close",()=>{t.forEach(i=>i()),t.length=0,s()});Wu(Nu,{...e,items:n})}function Fu(e,t,n){return{x:t-e.actualBoundingBoxLeft,y:n-e.fontBoundingBoxDescent-e.fontBoundingBoxAscent,w:e.width,h:e.fontBoundingBoxDescent+e.fontBoundingBoxAscent,diffy:e.fontBoundingBoxAscent}}function Iu(e,t){let n=e.x+e.w>t.x&&t.x+t.w>e.x,s=e.y+e.h>t.y&&t.y+t.h>e.y;return n&&s}function Rl(e){return e==_t.BottomLeft||e==_t.CenterLeft||e==_t.TopLeft}function Al(e){return e==_t.BottomCenter||e==_t.Center||e==_t.TopCenter}function Ll(e){return e==_t.BottomRight||e==_t.CenterRight||e==_t.TopRight}function Dl(e){return e==_t.TopLeft||e==_t.TopCenter||e==_t.TopRight}function Wl(e){return e==_t.CenterLeft||e==_t.Center||e==_t.CenterRight}function zu(e){return e==_t.BottomLeft||e==_t.BottomCenter||e==_t.BottomRight}var mn,Je,Qt,pn,Rn,gn,An,xt,rn,Ut,Ts,Zi,ii,Wr,li,Nr,ri,Fr;class Uu{constructor(t,n,s){A(this,Ts);A(this,ii);A(this,li);A(this,ri);A(this,mn,void 0);A(this,Je,void 0);A(this,Qt,void 0);A(this,pn,!0);A(this,Rn,[]);A(this,gn,[]);A(this,An,0);A(this,xt,0);A(this,rn,0);A(this,Ut,1);this.width=t,this.height=n,W(this,Qt,s),W(this,mn,new OffscreenCanvas(t,n)),this.changeResolution();let i=a(this,mn).getContext("2d");if(!i)throw new Error("SubtitleRenderer: cannot create context for OffscreenCanvas");W(this,Je,i),this.updateTimes()}get currentTime(){return a(this,An)}changeSubtitles(t){W(this,Qt,t),this.changeResolution(),this.updateTimes()}changeResolution(t=this.width,n=this.height){a(this,mn).width=t,a(this,mn).height=n,this.width=t,this.height=n;let s=a(this,Qt).width/a(this,Qt).height;t/n<s?([Tn(this,xt)._,Tn(this,rn)._]=[0,(n-t/s)/2],W(this,Ut,t/a(this,Qt).width)):([Tn(this,xt)._,Tn(this,rn)._]=[(t-n*s)/2,0],W(this,Ut,n/a(this,Qt).height)),this.requireRerender()}requireRerender(){W(this,pn,!0)}updateTimes(){W(this,gn,a(this,Qt).entries.map((t,n)=>({oldIndex:n,newIndex:-1,entry:t})).toSorted((t,n)=>t.entry.start-n.entry.start));for(let t=0;t<a(this,gn).length;t++)a(this,gn)[t].newIndex=t;V(this,Ts,Zi).call(this),W(this,pn,!0)}setTime(t){t!=this.currentTime&&(W(this,An,t),V(this,Ts,Zi).call(this),W(this,pn,!0))}getCanvas(){return a(this,pn)&&(V(this,ri,Fr).call(this),W(this,pn,!1)),a(this,mn)}}mn=new WeakMap,Je=new WeakMap,Qt=new WeakMap,pn=new WeakMap,Rn=new WeakMap,gn=new WeakMap,An=new WeakMap,xt=new WeakMap,rn=new WeakMap,Ut=new WeakMap,Ts=new WeakSet,Zi=function(){W(this,Rn,[]);for(let t=0;t<a(this,gn).length;t++){let n=a(this,gn)[t];if(n.entry.start>a(this,An))break;n.entry.end>a(this,An)&&a(this,Rn).push(n)}a(this,Rn).sort((t,n)=>t.oldIndex-n.oldIndex)},ii=new WeakSet,Wr=function(t){let n=0,s=0,i=1;return Rl(t.alignment)&&(n=t.margin.left*a(this,Ut)+a(this,xt)),Al(t.alignment)&&(n=this.width/2),Ll(t.alignment)&&(n=this.width-(t.margin.right*a(this,Ut)+a(this,xt))),Dl(t.alignment)&&(s=t.margin.top*a(this,Ut)+a(this,rn)),Wl(t.alignment)&&(s=this.height/2),zu(t.alignment)&&(s=this.height-(t.margin.bottom*a(this,Ut)+a(this,rn)),i=-1),[n,s,i]},li=new WeakSet,Nr=function(t,n){let s=Vt.splitPrintingWords(t),i=[],l="";for(let r of s){if(r==`
`){i.push(l),l="";continue}a(this,Je).measureText(l+r).width<n?l+=r:(i.push(l),l=r)}return i.push(l),i},ri=new WeakSet,Fr=function(){let t=[];a(this,Je).clearRect(0,0,this.width,this.height),a(this,Je).strokeStyle="white",a(this,Je).beginPath(),a(this,Je).rect(a(this,xt),a(this,rn),this.width-2*a(this,xt),this.height-2*a(this,rn)),a(this,Je).stroke();for(let n of a(this,Rn))for(let s of n.entry.texts){Rl(s.style.alignment)&&(a(this,Je).textAlign="left"),Al(s.style.alignment)&&(a(this,Je).textAlign="center"),Ll(s.style.alignment)&&(a(this,Je).textAlign="right");let i=s.style.size,l=s.style.font,r=s.style.color,h=s.style.outlineColor,u=s.style.outline;isNaN(i)&&(i=48),isNaN(u)&&(u=0),l==""&&(l="sans-serif"),r==""&&(r="white"),h==""&&(h="black"),a(this,Je).font=`${s.style.styles.bold?"bold ":""}${s.style.styles.italic?"italic ":""}${i*a(this,Ut)*3/4}px "${l}", sans-serif`,a(this,Je).fillStyle=r;let d=this.width-a(this,xt)*2-(s.style.margin.left+s.style.margin.right)*a(this,Ut),f=V(this,li,Nr).call(this,s.text,d),[g,p,w]=V(this,ii,Wr).call(this,s.style);w<0&&f.reverse();for(let C of f){let v=a(this,Je).measureText(C),[M,_]=[g,p],y=Fu(v,M,_),k=0;for(Dl(s.style.alignment)&&(k=y.h),Wl(s.style.alignment)&&(k=y.h*.5),y.y+=k;;){let L=t.find(J=>Iu(J,y));if(!L)break;w>0?y.y=Math.max(y.y+1,L.y+L.h):y.y=Math.min(y.y-1,L.y-L.h)}t.push(y),a(this,Je).beginPath(),a(this,Je).rect(y.x,y.y,y.w,y.h),a(this,Je).strokeStyle="white",a(this,Je).lineWidth=1,a(this,Je).stroke(),u>0&&(a(this,Je).strokeStyle=h,a(this,Je).lineWidth=u*a(this,Ut)*3/4,a(this,Je).strokeText(C,M,y.y+y.diffy)),a(this,Je).fillText(C,M,y.y+y.diffy)}}};var ot,Ln,_n,Ht,yn,Es,Dn,Wn,Xn,Ps,Qi;class Hu{constructor(t){A(this,Ps);A(this,ot,void 0);A(this,Ln,void 0);A(this,_n,!1);A(this,Ht,!1);A(this,yn,0);A(this,Es,!1);A(this,Dn,1920);A(this,Wn,1080);A(this,Xn,void 0);te(this,"onPositionChange",()=>{});te(this,"onPlayStateChange",()=>{});W(this,ot,document.createElement("video")),W(this,Ln,t)}get duration(){return a(this,ot).duration}get width(){return a(this,ot).videoWidth}get height(){return a(this,ot).videoHeight}get ratio(){return this.width/this.height}get currentPosition(){return a(this,yn)}get isLoaded(){return a(this,_n)}get isPlaying(){return a(this,Ht)}get subRenderer(){return a(this,Xn)}setDisplaySize(t,n){var i;let s=window.devicePixelRatio;W(this,Dn,Math.floor(t*s)),W(this,Wn,Math.floor(n*s)),(i=this.subRenderer)==null||i.changeResolution(a(this,Dn),a(this,Wn)),this.requestRender()}setSubtitles(t){var n;this.subRenderer?(n=a(this,Xn))==null||n.changeSubtitles(t):W(this,Xn,new Uu(a(this,Dn),a(this,Wn),t)),this.requestRender()}async load(t){return new Promise((n,s)=>{let i=()=>{a(this,ot).removeEventListener("loadeddata",i),W(this,Ht,!1),W(this,_n,!0),this.onPlayStateChange(),this.setPosition(0),n()},l=r=>{a(this,ot).removeEventListener("error",l),s("error loading video: "+r.message)};a(this,ot).addEventListener("loadeddata",i),a(this,ot).addEventListener("error",l),a(this,ot).src=t,a(this,ot).load()})}async setPosition(t){return t<0&&(t=0),t>this.duration&&(t=this.duration),new Promise(n=>{var i;let s=()=>{a(this,ot).removeEventListener("seeked",s),W(this,yn,t),this.onPositionChange(),this.requestRender(),n()};if((i=this.subRenderer)==null||i.setTime(t),!a(this,_n)){W(this,yn,t),this.requestRender(),n();return}W(this,Ht,!1),a(this,ot).addEventListener("seeked",s),a(this,ot).currentTime=t})}requestRender(){a(this,Es)||(a(this,Ht)?a(this,ot).requestVideoFrameCallback((t,n)=>V(this,Ps,Qi).call(this,n)):requestAnimationFrame(t=>V(this,Ps,Qi).call(this)))}play(t=!0){return new Promise((n,s)=>{a(this,ot).readyState<2?s("not ready"):!t&&a(this,Ht)?(a(this,ot).pause(),W(this,Ht,!1),this.onPlayStateChange(),n()):t&&!a(this,Ht)?a(this,ot).play().then(i=>{W(this,Ht,!0),this.onPlayStateChange(),this.requestRender(),n()}):n()})}}ot=new WeakMap,Ln=new WeakMap,_n=new WeakMap,Ht=new WeakMap,yn=new WeakMap,Es=new WeakMap,Dn=new WeakMap,Wn=new WeakMap,Xn=new WeakMap,Ps=new WeakSet,Qi=function(t){var i;W(this,Es,!1);let n=a(this,Dn),s=a(this,Wn);if(a(this,Ln).clearRect(0,0,n,s),a(this,_n)){let l,r,h=this.ratio;n/s<h?[l,r]=[n,n/h]:[l,r]=[s*h,s];let u=(n-l)/2,d=(s-r)/2;a(this,Ln).drawImage(a(this,ot),u,d,l,r),W(this,yn,a(this,ot).currentTime),(i=this.subRenderer)==null||i.setTime(a(this,yn)),this.onPositionChange()}this.subRenderer&&a(this,Ln).drawImage(this.subRenderer.getCanvas(),0,0),a(this,_n)&&a(this,Ht)&&this.requestRender()};var Ze,Yn,an,bn,Jn,ai,Os,on,Zn,$t;const Pn=class Pn{constructor(){A(this,Ze,void 0);A(this,Yn,void 0);A(this,an,void 0);A(this,bn,void 0);A(this,Jn,0);A(this,ai,0);A(this,Os,0);A(this,on,0);A(this,Zn,!1);A(this,$t,!1);te(this,"data",new Float32Array);te(this,"detail",new Float32Array);W(this,Ze,new Audio),W(this,Yn,new AudioContext);let t=a(this,Yn).createMediaElementSource(a(this,Ze));W(this,an,a(this,Yn).createAnalyser()),a(this,an).fftSize=2048,a(this,an).smoothingTimeConstant=0,W(this,bn,new Float32Array(a(this,an).fftSize)),t.connect(a(this,an))}get duration(){return a(this,Ze).duration}get isSampling(){return a(this,$t)}get sampleStart(){return a(this,ai)}get sampleEnd(){return a(this,Os)}get sampleProgress(){return a(this,on)}static create(t){return new Promise((n,s)=>{let i=new Pn,l=()=>{console.log("audio: loadeddata"),a(i,Ze).removeEventListener("loadeddata",l),W(i,Jn,Math.round(a(i,Ze).duration*this.RESOLUTION)),i.data=new Float32Array(a(i,Jn)),i.detail=new Float32Array(a(i,Jn)),n(i)},r=h=>{a(i,Ze).removeEventListener("error",r),s("error loading video: "+h.message)};a(i,Ze).addEventListener("loadeddata",l),a(i,Ze).addEventListener("error",r),a(i,Ze).src=t,a(i,Ze).volume=1,a(i,Ze).load()})}tryCancelSampling(){ze(a(this,$t)),W(this,Zn,!0)}extendSampling(t){ze(a(this,$t)),t>a(this,Ze).duration&&(t=a(this,Ze).duration),ze(a(this,on)<t),ze(this.sampleEnd<=t),W(this,Os,t)}startSampling(t,n,s){return ze(!a(this,$t)),n>a(this,Ze).duration&&(n=a(this,Ze).duration),ze(n>t),W(this,$t,!0),W(this,Zn,!1),a(this,Ze).playbackRate=s,a(this,Ze).currentTime=t,console.log("starting sampling: ",t,n,"at",s),new Promise(i=>{let l=a(this,Ze).currentTime,r=Math.ceil(t*Pn.RESOLUTION),h=()=>{W(this,on,a(this,Ze).currentTime);let u=Math.floor(a(this,on)*Pn.RESOLUTION);if(a(this,Zn)&&this.sampleProgress-t>.01){console.log("sucessfully cancelled"),W(this,$t,!1),a(this,Ze).pause(),i();return}if(u>=n*Pn.RESOLUTION){console.log("sampling done"),W(this,$t,!1),a(this,Ze).pause(),i();return}if(a(this,on)-l>0){a(this,an).getFloatTimeDomainData(a(this,bn));let d=0;for(let g=0;g<a(this,bn).length;g++)d+=Math.pow(a(this,bn)[g],2);d*=8/a(this,bn).length;let f=u-r+1;for(let g=r;g<u;g++)if(this.detail[g]==0)this.data[g]=d,this.detail[g]=f;else{let p=f/(f+this.detail[g]);this.data[g]=this.data[g]*p+d*(1-p),this.detail[g]=this.detail[g]*p+f*(1-p)}l=a(this,on),r=u}requestAnimationFrame(h)};a(this,Ze).play().then(()=>requestAnimationFrame(h))})}};Ze=new WeakMap,Yn=new WeakMap,an=new WeakMap,bn=new WeakMap,Jn=new WeakMap,ai=new WeakMap,Os=new WeakMap,on=new WeakMap,Zn=new WeakMap,$t=new WeakMap,te(Pn,"RESOLUTION",60);let Nt=Pn;const Nl=15,Zt=30,qu="hsl(0deg 0% 20%)",Vu="white",ju="hsl(0deg 0% 60%)",Gu="hsl(0deg 0% 30%)",Bu="white",Ku=5,Xu=.1,Yu=100,Fl=40,Ju=1,Zu="hsl(0deg 0% 60%)",Qu="hsl(0deg 0% 40% / 60%)",xu="hsl(0deg 0% 80%)",$u="goldenrod",ed=4,td="pink",nd="hsl(0deg 0% 80% / 40%)",sd="hsl(0deg 0% 70%)",id=3,fs=10,Il=10,ld="hsl(0deg 0% 80%)",rd=3;function ad(e){const t=[.001,.01,.1,1,10,60,600,3600];for(let n=0;n<t.length-3;n++)if(e*t[n]>2)return[t[n],t[n+1]/t[n],t[n+2]/t[n]];return[60,600,3600]}let gs=-1;function od(e,t,n){const s="",i=(h,u,d)=>{let f=0;for(;f<=h;){let g=Math.floor((f+h)/2);const p=d(g);if(p===u)return g;p<u?f=g+1:h=g-1}return h},l=e.measureText(t).width;if(gs<0&&(gs=e.measureText(s).width),l<=n||l<=gs)return t;const r=i(t.length,n-gs,h=>e.measureText(t.substring(0,h)).width);return t.substring(0,r)+s}var De,z,Qn,xn,wn,$e,$,ae,un,gt,Et,$n,Rs,Yt,We,en,es,Bs,ts,Ks,As,xi,ns,Xs,oi,Ir,ui,zr,di,Ur,ss,Ys,hi,Hr,ci,qr,fi,Vr,mi,jr,is,Js,Nn,_s,ls,Zs,pi,Gr,gi,Br,_i,Kr,yi,Xr,bi,Yr;class ud{constructor(t,n){A(this,es);A(this,ts);A(this,As);A(this,ns);A(this,oi);A(this,ui);A(this,di);A(this,ss);A(this,hi);A(this,ci);A(this,fi);A(this,mi);A(this,is);A(this,Nn);A(this,ls);A(this,pi);A(this,gi);A(this,_i);A(this,yi);A(this,bi);A(this,De,void 0);A(this,z,void 0);A(this,Qn,!1);A(this,xn,!1);A(this,wn,!1);A(this,$e,null);A(this,$,1);A(this,ae,0);A(this,un,0);A(this,gt,100);A(this,Et,100);A(this,$n,0);A(this,Rs,new Map);A(this,Yt,null);A(this,We,new Set);A(this,en,null);te(this,"onPositionChange",t=>{});W(this,z,t),W(this,De,n),this.setViewScale(10),this.requestRender(),t.canvas.oncontextmenu=s=>s.preventDefault(),t.canvas.onmousemove=s=>V(this,hi,Hr).call(this,s),t.canvas.onmousedown=s=>V(this,ci,qr).call(this,s),t.canvas.ondblclick=()=>V(this,fi,Vr).call(this),t.canvas.onwheel=s=>V(this,mi,jr).call(this,s),n.onSelectionChanged.bind(s=>{s!=Se.Timeline&&(W(this,We,new Set(a(this,De).getSelection())),a(this,De).current.entry&&V(this,di,Ur).call(this,a(this,De).current.entry),this.requestRender())}),n.onSubtitlesChanged.bind(s=>{(s==Ge.Styles||s==Ge.Both)&&V(this,es,Bs).call(this)}),n.onSubtitleObjectReload.bind(()=>{V(this,es,Bs).call(this)})}get viewScale(){return a(this,$)}get viewOffset(){return a(this,ae)}get cursorPos(){return a(this,un)}setDisplaySize(t,n,s,i){W(this,gt,s),W(this,Et,i),V(this,es,Bs).call(this),this.setViewScale(a(this,$)),this.requestRender()}async load(t){W(this,$e,await Nt.create(t)),W(this,$,Math.max(a(this,gt)/a(this,$e).duration,10)),W(this,ae,0),W(this,un,0),this.requestRender()}setViewOffset(t){t<0&&(t=0),t=Math.min(t,V(this,Nn,_s).call(this)-a(this,gt)/a(this,$)),W(this,ae,t),V(this,ls,Zs).call(this),this.requestRender(),W(this,wn,!0)}setCursorPos(t,n=!1){t<0&&(t=0),t=Math.min(t,V(this,Nn,_s).call(this)),W(this,un,t),V(this,ss,Ys).call(this,t),this.requestRender(),this.onPositionChange(n)}setViewScale(t){ze(t>0),t=Math.max(t,a(this,gt)/V(this,Nn,_s).call(this)),t=Math.min(t,500),t!=a(this,$)&&(W(this,$,t),V(this,ls,Zs).call(this),this.requestRender(),W(this,wn,!0))}requestRender(){a(this,xn)||(W(this,xn,!0),requestAnimationFrame(()=>V(this,bi,Yr).call(this)))}}De=new WeakMap,z=new WeakMap,Qn=new WeakMap,xn=new WeakMap,wn=new WeakMap,$e=new WeakMap,$=new WeakMap,ae=new WeakMap,un=new WeakMap,gt=new WeakMap,Et=new WeakMap,$n=new WeakMap,Rs=new WeakMap,Yt=new WeakMap,We=new WeakMap,en=new WeakMap,es=new WeakSet,Bs=function(){const t=a(this,De).subs;W(this,$n,(a(this,Et)-Zt-Fl*2)/(t.styles.length+1)),W(this,Rs,new Map([[t.defaultStyle,0],...t.styles.map((n,s)=>[n,s+1])]))},ts=new WeakSet,Ks=function(){const t=a(this,ae)+a(this,gt)/a(this,$);return a(this,De).subs.entries.filter(n=>n.end>a(this,ae)&&n.start<t)},As=new WeakSet,xi=function(t){const n=(t.end-t.start)*a(this,$),s=(t.start-a(this,ae))*a(this,$);return t.texts.map(i=>{let l=a(this,Rs).get(i.style)??0,r=a(this,$n)*l+Zt+Fl;return{x:s,y:r,w:n,h:a(this,$n),channel:i}})},ns=new WeakSet,Xs=function(t,n,s=0,i=0){let l=[];const r=t/a(this,$)+a(this,ae),h=t+s/a(this,$)+a(this,ae);for(let u of a(this,De).subs.entries)u.end<r||u.start>h||V(this,As,xi).call(this,u).some(d=>d.x<=t+s&&d.x+d.w>=t&&d.y<=n+i&&d.y+d.h>=n)&&l.push(u);return l},oi=new WeakSet,Ir=function(t,n){let s=t.end-t.start,i=u=>{let d=Math.abs(n-u);d<l&&(r=u,h=u,l=d),d=Math.abs(n+s-u),d<l&&(r=u,h=u-s,l=d)},l=Il/a(this,$),r=null,h=n;i(a(this,un));for(let u of V(this,ts,Ks).call(this))a(this,We).has(u)||(i(u.start),i(u.end));return W(this,en,r!==null?(r-a(this,ae))*a(this,$):null),h},ui=new WeakSet,zr=function(t,n,s){let i=s?u=>u<t.end:u=>u>t.start,l=u=>{if(!i(u))return;let d=Math.abs(n-u);d<r&&(h=u,r=d)},r=Il/a(this,$),h=null;l(a(this,un));for(let u of V(this,ts,Ks).call(this))u!=t&&(l(u.start),l(u.end));return W(this,en,h!==null?(h-a(this,ae))*a(this,$):null),h??n},di=new WeakSet,Ur=function(t){const n=(t.end-t.start)*a(this,$),s=(t.start-a(this,ae))*a(this,$),i=s,l=s+n-a(this,gt);i>=0&&l<=0||(Math.abs(i)<Math.abs(l)?this.setViewOffset(a(this,ae)+i/a(this,$)):this.setViewOffset(a(this,ae)+l/a(this,$)))},ss=new WeakSet,Ys=function(t){let n=Yu/a(this,$),s=a(this,ae)+n,i=a(this,ae)+a(this,gt)/a(this,$)-n;t<s&&this.setViewOffset(a(this,ae)+t-s),t>i&&this.setViewOffset(a(this,ae)+t-i)},hi=new WeakSet,Hr=function(t){const n=window.devicePixelRatio;if(a(this,z).canvas.style.cursor="default",t.offsetY*n<Zt){a(this,z).canvas.style.cursor="col-resize";return}const s=V(this,ns,Xs).call(this,t.offsetX*n,t.offsetY*n);if(s.length!=0)if((a(this,We).size>1||(Vt.ctrlKey()=="Meta"?t.metaKey:t.ctrlKey))&&s.some(i=>a(this,We).has(i)))a(this,z).canvas.style.cursor="move";else{let i=s.find(h=>a(this,We).has(h))??s[0];const l=(i.end-i.start)*a(this,$),r=(i.start-a(this,ae))*a(this,$);t.offsetX*n-r<fs?a(this,z).canvas.style.cursor="e-resize":r+l-t.offsetX*n<fs&&(a(this,z).canvas.style.cursor="w-resize")}},ci=new WeakSet,qr=function(t){t.preventDefault();let n=h=>{},s=h=>{};const i=window.devicePixelRatio,l=a(this,ae)+t.offsetX/a(this,$)*i;if(t.button==1){const h=a(this,$);n=u=>{this.setViewScale(h/Math.pow(1.03,t.clientX-u.clientX)),this.setViewOffset(l-t.offsetX/a(this,$)*i)}}else if(t.offsetY*i<Zt)n=h=>this.setCursorPos(a(this,ae)+h.offsetX/a(this,$)*i),n(t);else{let h=V(this,ns,Xs).call(this,t.offsetX*i,t.offsetY*i);if(h.length==0){(Vt.ctrlKey()=="Meta"?!t.metaKey:!t.ctrlKey)&&(a(this,De).clearSelection(Se.Timeline),a(this,We).clear(),this.requestRender()),W(this,Yt,null);const u=[...a(this,We)];let d=[];n=f=>{let g=(l-a(this,ae))*a(this,$),p=f.offsetX*i,w=t.offsetY*i,C=f.offsetY*i,v={x:Math.min(g,p),y:Math.min(w,C),w:Math.abs(g-p),h:Math.abs(w-C)};W(this,Yt,v);let M=V(this,ns,Xs).call(this,v.x,v.y,v.w,v.h);M.length!=d.length&&(W(this,We,new Set([...u,...M])),d=M,V(this,is,Js).call(this)),V(this,ss,Ys).call(this,p/a(this,$)+a(this,ae)),this.requestRender()},s=()=>{W(this,Yt,null),this.requestRender()}}else if(t.button==2)h.some(u=>a(this,We).has(u))||(a(this,De).clearSelection(Se.Timeline),a(this,De).selectEntry(h[0],!1,!1,Se.Action)),s=()=>a(this,De).uiHelper.contextMenu();else{let u=()=>{};if(Vt.ctrlKey()=="Meta"?t.metaKey:t.ctrlKey)a(this,We).has(h[0])?u=()=>{console.log("afterup"),a(this,We).delete(h[0]),V(this,is,Js).call(this),this.requestRender()}:(a(this,We).add(h[0]),V(this,is,Js).call(this),this.requestRender());else{if(a(this,We).size>1)u=()=>{console.log("afterup"),a(this,We).clear(),a(this,We).add(h[0]),a(this,De).selectEntry(h[0],!1,!1,Se.Timeline)};else{let C=[...a(this,We)][0],v=(h.indexOf(C)+1)%h.length;a(this,We).clear(),a(this,We).add(h[v]),a(this,De).selectEntry(h[v],!1,!1,Se.Timeline)}this.requestRender()}const d=[...a(this,We)],f=Math.min(...d.map(C=>C.start)),g=Math.max(...d.map(C=>C.end)),p=l-f,w=g-l;if(console.log(p*a(this,$),w*a(this,$)),a(this,We).size>1||p*a(this,$)>fs&&w*a(this,$)>fs){const C=h.find(_=>a(this,We).has(_)),v=new Map(d.map(_=>[_,_.start]));let M=!1;n=_=>{const y=_.offsetX/a(this,$)*i+a(this,ae);let k=y-l;!_.altKey&&C&&(k=V(this,oi,Ir).call(this,C,v.get(C)+k)-v.get(C)),M=y!=l;for(let L of d){const J=L.end-L.start;L.start=v.get(L)+k,L.end=L.start+J}this.requestRender()},s=()=>{W(this,en,null),this.requestRender(),M?a(this,De).markChanged(Ge.Times,Se.Timeline):u()}}else{const C=p*a(this,$)<=fs,v=d[0],M=C?v.start:v.end;let _=!1;n=y=>{const k=y.offsetX/a(this,$)*i+a(this,ae);let L=M+k-l;y.altKey||(L=V(this,ui,zr).call(this,v,L,C)),C?v.start=Math.min(v.end,L):v.end=Math.max(v.start,L),_=L!=M,V(this,ss,Ys).call(this,L),this.requestRender()},s=()=>{W(this,en,null),this.requestRender(),_?a(this,De).markChanged(Ge.Times,Se.Timeline):u()}}}}let r=h=>{s(h),window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)};window.addEventListener("mousemove",n),window.addEventListener("mouseup",r)},fi=new WeakSet,Vr=function(){if(a(this,We).size==1){let t=[...a(this,We)][0];a(this,De).current.entry==t&&a(this,De).focusOnCurrentEntry()}},mi=new WeakSet,jr=function(t){if(t.deltaX!=0)this.setViewOffset(a(this,ae)+10*t.deltaX/a(this,$));else if(t.deltaY%1!=0){const n=window.devicePixelRatio,s=a(this,ae)+t.offsetX/a(this,$)*n;this.setViewScale(a(this,$)/Math.pow(1.03,t.deltaY)),this.setViewOffset(s-t.offsetX/a(this,$)*n)}},is=new WeakSet,Js=function(){if(a(this,De).current.entry=null,a(this,De).selection.submitted=new Set(a(this,We)),a(this,We).size==1){let t=[...a(this,We).values()];a(this,De).selection.currentGroup=t,a(this,De).selection.currentStart=t[0],a(this,De).current.entry=t[0]}else a(this,De).selection.currentGroup=[],a(this,De).selection.currentStart=null;a(this,De).onSelectionChanged.dispatch(Se.Timeline)},Nn=new WeakSet,_s=function(){return a(this,$e)?a(this,$e).duration:Math.max(...a(this,De).subs.entries.map(t=>t.end))+20},ls=new WeakSet,Zs=function(){if(!a(this,$e))return;let t=a(this,ae),n=a(this,ae)+a(this,gt)/a(this,$);const s=Math.min(Ku,(n-t)*Xu);if(a(this,$e).isSampling&&(a(this,$e).sampleProgress+s<a(this,ae)||a(this,$e).sampleProgress>n+s?a(this,$e).tryCancelSampling():a(this,$e).sampleEnd<n+s&&a(this,$e).extendSampling(n+s)),a(this,$e).isSampling)return;const i=Math.floor(a(this,ae)*Nt.RESOLUTION),l=Math.ceil(n*Nt.RESOLUTION),r=a(this,$e).detail.subarray(i,l),h=r.findIndex(f=>f==0),u=r.findIndex(f=>f>5);if(a(this,De).playback.isPlaying){if(h<0){u<0&&W(this,wn,!1);return}t=(h+i)/Nt.RESOLUTION}else if(W(this,wn,!1),h>=0)t=(h+i)/Nt.RESOLUTION;else if(u>=0)t=(u+i)/Nt.RESOLUTION;else return;if(n+=s,t<0&&(t=0),n>a(this,$e).duration&&(n=a(this,$e).duration),n<=t)return;W(this,Qn,!0),a(this,$e).startSampling(t,n,Math.min(25,(n-a(this,ae))/8)).then(()=>{W(this,Qn,!1),this.requestRender()}),this.requestRender()},pi=new WeakSet,Gr=function(){if(!a(this,$e))return;a(this,wn)&&V(this,ls,Zs).call(this);let t=Math.floor(a(this,ae)*Nt.RESOLUTION),n=Math.ceil((a(this,ae)+a(this,gt)/a(this,$))*Nt.RESOLUTION);t<0&&(t=0),n>=a(this,$e).data.length&&(n=a(this,$e).data.length-1);const s=1/Nt.RESOLUTION*a(this,$),i=Math.max(1,Math.ceil(1/s)),l=Math.max(1,i*s);for(let r=t;r<n;r+=i){const h=a(this,$e).detail[r];if(h==0)continue;let u=a(this,$e).data[r]*a(this,Et),d=(r-a(this,ae)*Nt.RESOLUTION)*s;a(this,z).fillStyle="rgb(100 255 255)",a(this,z).fillRect(d,(a(this,Et)-u)/2,l,Math.max(u,1)),a(this,z).fillStyle="rgb(100% 10% 10% / 30%)";let f=h/Nt.RESOLUTION*200;a(this,z).fillRect(d,a(this,Et)-f,l,f)}},gi=new WeakSet,Br=function(){let t=(d,f)=>{a(this,z).beginPath(),a(this,z).moveTo(d,0),a(this,z).lineTo(d,f),a(this,z).stroke()};const[n,s,i]=ad(a(this,$)),l=Math.floor(a(this,ae)/n/i)*n*i,r=a(this,ae)+a(this,gt)/a(this,$),h=Math.ceil((r-l)/n);a(this,z).fillStyle=qu,a(this,z).fillRect(0,0,a(this,gt),Zt),a(this,z).fillStyle=Bu,a(this,z).font="20px sans-serif",a(this,z).textBaseline="bottom",a(this,z).lineWidth=1;for(let d=0;d<h;d++){let f=l+d*n,g=Math.round((f-a(this,ae))*a(this,$)),p=5;d%i==0?(p=Zt,a(this,z).strokeStyle=ju,t(g,a(this,Et))):d%s==0?(p=Zt*.5,a(this,z).strokeStyle=Gu,t(g,a(this,Et))):p=Zt*.2,a(this,z).strokeStyle=Vu,t(g,p)}for(let d=l;d<r;d+=i*n){const f=Math.round((d-a(this,ae))*a(this,$));a(this,z).fillText(lt.formatTimestamp(d,2),f+5,Zt)}const u=V(this,Nn,_s).call(this);Math.abs(a(this,gt)-a(this,$)*u)<.001||(a(this,z).fillStyle="rgb(255 255 255 / 40%)",a(this,z).fillRect(a(this,gt)*(a(this,ae)/u),a(this,Et)-Nl,a(this,gt)*(a(this,gt)/a(this,$)/u),Nl))},_i=new WeakSet,Kr=function(){gs=-1,a(this,z).textBaseline="top";for(let t of V(this,ts,Ks).call(this))V(this,As,xi).call(this,t).forEach(n=>{a(this,z).fillStyle=Qu,a(this,We).has(t)?(a(this,z).strokeStyle=$u,a(this,z).lineWidth=ed):(a(this,z).strokeStyle=Zu,a(this,z).lineWidth=Ju),a(this,z).beginPath(),a(this,z).roundRect(n.x,n.y,n.w,n.h,4),a(this,z).fill(),a(this,z).stroke(),n.w>50&&(a(this,z).fillStyle=xu,a(this,z).fillText(od(a(this,z),n.channel.text,n.w-8),n.x+4,n.y+4))})},yi=new WeakSet,Xr=function(){let t=(a(this,un)-a(this,ae))*a(this,$);a(this,Yt)&&(a(this,z).fillStyle=nd,a(this,z).strokeStyle=sd,a(this,z).lineWidth=id,a(this,z).beginPath(),a(this,z).roundRect(a(this,Yt).x,a(this,Yt).y,a(this,Yt).w,a(this,Yt).h,2),a(this,z).fill(),a(this,z).stroke()),a(this,en)&&(a(this,z).strokeStyle=ld,a(this,z).lineWidth=rd,a(this,z).beginPath(),a(this,z).moveTo(a(this,en),Zt),a(this,z).lineTo(a(this,en),a(this,Et)),a(this,z).stroke()),a(this,z).fillStyle=td,a(this,z).beginPath(),a(this,z).moveTo(t+8,0),a(this,z).lineTo(t-8,0),a(this,z).lineTo(t-2,10),a(this,z).lineTo(t-2,a(this,Et)),a(this,z).lineTo(t+2,a(this,Et)),a(this,z).lineTo(t+2,10),a(this,z).lineTo(t+8,0),a(this,z).fill()},bi=new WeakSet,Yr=function(){W(this,xn,!1);const t=Date.now();a(this,z).fillStyle="black",a(this,z).fillRect(0,0,a(this,gt),a(this,Et)),V(this,gi,Br).call(this),V(this,pi,Gr).call(this),V(this,_i,Kr).call(this),V(this,yi,Xr).call(this),a(this,z).font="15px sans-serif",a(this,z).textBaseline="top",a(this,z).fillStyle="white",a(this,z).fillText(`offset=${a(this,ae).toFixed(2)}`,10,30),a(this,z).fillText(`scale=${a(this,$).toFixed(2)}`,10,50),a(this,z).fillText(`render time=${(Date.now()-t).toFixed(1)}`,100,30),a(this,Qn)&&this.requestRender()};var Ls,Fn,dn,Ds,wi,Jr;class dd{constructor(t){A(this,wi);A(this,Ls,!1);A(this,Fn,!1);A(this,dn,0);A(this,Ds,0);te(this,"video",null);te(this,"timeline",null);te(this,"onRefreshPlaybackControl",()=>{});this.frontend=t,t.onSubtitlesChanged.bind((n,s)=>{var i;(i=this.video)!=null&&i.subRenderer&&(n&&this.video.subRenderer.updateTimes(),this.video.subRenderer.requireRerender())}),t.onSubtitleObjectReload.bind(()=>{var n;(n=this.video)==null||n.setSubtitles(t.subs)})}get position(){return a(this,dn)}get duration(){return a(this,Ds)}get isLoaded(){return a(this,Ls)}get isPlaying(){return a(this,Fn)}createVideo(t,n){return ze(this.video==null),this.video=new Hu(t),this.video.setSubtitles(n),this.video.onPositionChange=()=>{ze(this.video!=null),a(this,Fn)&&V(this,wi,Jr).call(this,this.video.currentPosition),this.onRefreshPlaybackControl()},this.video.onPlayStateChange=()=>{ze(this.video!=null),W(this,Fn,this.video.isPlaying),this.onRefreshPlaybackControl()},this.video}createTimeline(t,n){return ze(this.timeline==null),this.timeline=new ud(t,n),this.timeline.onPositionChange=s=>{ze(this.timeline!=null),!s&&(W(this,dn,this.timeline.cursorPos),this.video&&this.video.setPosition(a(this,dn)),this.onRefreshPlaybackControl())},this.timeline}async load(t){ze(this.video!==null),ze(this.timeline!==null),await Promise.allSettled([this.video.load(t),this.timeline.load(t)]),W(this,Ls,!0),W(this,Ds,this.video.duration),this.onRefreshPlaybackControl()}async setPosition(t){var n,s;this.video?(ze(this.timeline!==null),await this.video.setPosition(t),W(this,dn,t),(s=this.timeline)==null||s.setCursorPos(t,!0)):(W(this,dn,t),(n=this.timeline)==null||n.setCursorPos(t,!0))}async play(t=!0){ze(this.video!==null),await this.video.play(t)}async toggle(){await this.play(!a(this,Fn))}}Ls=new WeakMap,Fn=new WeakMap,dn=new WeakMap,Ds=new WeakMap,wi=new WeakSet,Jr=function(t){var n;W(this,dn,t),(n=this.timeline)==null||n.setCursorPos(t,!0),this.onRefreshPlaybackControl()};var Ws,$i,Ns,el,Fs,tl,Si,Zr,Is,nl,zs,sl,vi,Qr,ki,xr;class hd{constructor(t){A(this,Ws);A(this,Ns);A(this,Fs);A(this,Si);A(this,Is);A(this,zs);A(this,vi);A(this,ki);this.frontend=t}processGlobalKeydown(t){var r,h;let n=t.getModifierState(Vt.ctrlKey()),s=this.frontend.states.modalOpenCounter>0||((r=document.activeElement)==null?void 0:r.localName)=="input",i=!this.frontend.states.isEditing&&!s,l=(!this.frontend.states.isEditing||t.altKey)&&!s;if(t.key=="Enter"&&n&&(t.preventDefault(),this.frontend.insertEntryAfter(this.frontend.current.entry??void 0)),t.key=="Enter"&&i&&(t.preventDefault(),this.frontend.states.virtualEntryHighlighted?this.frontend.startEditingNewVirtualEntry():this.frontend.focusOnCurrentEntry()),t.key=="a"&&n&&i&&(V(this,Ns,el).call(this),t.preventDefault()),(t.key=="Delete"||t.key=="Backspace"&&n)&&i&&(this.frontend.deleteSelection(),t.preventDefault()),t.key=="c"&&n&&i&&(this.frontend.copySelection(),t.preventDefault()),t.key=="v"&&n&&i&&(this.frontend.paste(),t.preventDefault()),t.key=="x"&&n&&i&&(this.frontend.copySelection(),this.frontend.deleteSelection(),t.preventDefault()),t.key=="z"&&n&&i&&(t.preventDefault(),t.shiftKey?this.frontend.redo():this.frontend.undo()),t.key=="ArrowUp"&&n&&i&&(t.preventDefault(),V(this,Is,nl).call(this,this.frontend.getSelection(),-1)),t.key=="ArrowDown"&&n&&i&&(t.preventDefault(),V(this,Is,nl).call(this,this.frontend.getSelection(),1)),t.key=="s"&&n&&(t.preventDefault(),this.frontend.askSaveFile()),t.key=="f"&&n&&!s&&(t.preventDefault(),(h=this.frontend.dialogs.search)==null||h.$set({show:!0})),t.key=="ArrowUp"&&l&&!n&&(t.preventDefault(),this.frontend.offsetFocus(-1,t.shiftKey,n)),t.key=="ArrowDown"&&l&&!n&&(t.preventDefault(),this.frontend.offsetFocus(1,t.shiftKey,n)),t.code=="Space"&&l&&(this.frontend.playback.toggle(),t.preventDefault()),t.key=="ArrowLeft"&&l&&(this.frontend.playback.setPosition(this.frontend.playback.position-1),t.preventDefault()),t.key=="ArrowRight"&&l&&(this.frontend.playback.setPosition(this.frontend.playback.position+1),t.preventDefault()),t.key=="Enter"&&!t.shiftKey&&this.frontend.states.isEditing){t.preventDefault();let u=this.frontend.current.entry;if(!u)return;this.frontend.subs.entries.indexOf(u)+1==this.frontend.subs.entries.length?this.frontend.startEditingNewVirtualEntry():this.frontend.offsetFocus(1)}}contextMenu(){let t=this.frontend.getSelection();if(t.length==0)return;let n=this.frontend.isSelectionDisjunct(),s=[this.frontend.subs.defaultStyle,...this.frontend.subs.styles];gl({items:[{label:"copy",subitems:[{label:"JSON (internal)",shortcut:"cmd_or_ctrl+c",event:()=>this.frontend.copySelection()},{label:"SRT",event:()=>this.frontend.copySelection(cn.SRT)},{label:"ASS fragment",event:()=>this.frontend.copySelection(cn.ASSFragment)},{label:"plain text",event:()=>this.frontend.copySelection(cn.plaintext)}]},{label:"cut",shortcut:"cmd_or_ctrl+x",event:()=>{this.frontend.copySelection(),this.frontend.deleteSelection()}},{label:"paste",shortcut:"cmd_or_ctrl+v",event:()=>this.frontend.paste()},{is_separator:!0},{label:"delete",shortcut:"cmd_or_ctrl+backspace",event:()=>this.frontend.deleteSelection()},{is_separator:!0},{label:"select all",shortcut:"cmd_or_ctrl+a",event:()=>V(this,Ns,el).call(this)},{label:"select all by channel",subitems:s.map(i=>({label:i.name,event:()=>{this.frontend.selection.currentGroup=[],this.frontend.selection.currentStart=null,this.frontend.selection.submitted=new Set(this.frontend.subs.entries.filter(l=>l.texts.some(r=>r.style==i))),this.frontend.onSelectionChanged.dispatch(Se.Action)}}))},{is_separator:!0},{label:"insert before",event:()=>this.frontend.insertEntryBefore(t[0])},{label:"insert after",shortcut:"cmd_or_ctrl+enter",event:()=>this.frontend.insertEntryAfter(t[0])},{is_separator:!0},{label:"transform times...",event:()=>{if(!this.frontend.modalDialogs.timeTrans)return;let i=this.frontend.modalDialogs.timeTrans.$on("submit",l=>{this.frontend.subs.shiftTimes(l.detail)&&this.frontend.markChanged(Ge.Times,Se.Action),i()});this.frontend.modalDialogs.timeTrans.$set({show:!0})}},{label:"combine simultaneous",disabled:t.length<=1,event:()=>V(this,vi,Qr).call(this,t)},{label:"split simultaneous",event:()=>V(this,ki,xr).call(this,t)},{label:"combine entries",disabled:n||t.length<=1,subitems:[{label:"connect all",event:()=>V(this,zs,sl).call(this,t,!0)},{label:"keep first only",event:()=>V(this,zs,sl).call(this,t,!1)}]},{label:"sort by time",disabled:n||t.length<=1,event:()=>V(this,Fs,tl).call(this,t,!1)},{label:"sort by first style",disabled:n||t.length<=1,event:()=>V(this,Fs,tl).call(this,t,!0)},{label:"sort channels",event:()=>V(this,Si,Zr).call(this,t)},{is_separator:!0},{label:"create channel",subitems:s.map(i=>({label:i.name,event:()=>{let l=!1;for(let r of t)r.texts.find(h=>h.style==i)||(r.texts.push({style:i,text:""}),l=!0);l&&this.frontend.markChanged(Ge.NonTime,Se.Action)}}))},{label:"replace channel",disabled:this.frontend.subs.styles.length==0,subitems:s.map(i=>({label:i.name,subitems:[{label:"by:",disabled:!0},...s.filter(l=>l!=i).map(l=>({label:l.name,event:()=>{ks.replaceStyle(t,i,l)&&this.frontend.markChanged(Ge.NonTime,Se.Action)}}))]}))},{label:"remove channel",disabled:this.frontend.subs.styles.length==0,subitems:this.frontend.subs.styles.map(i=>({label:i.name,event:()=>V(this,Ws,$i).call(this,t,l=>l.style==i)}))},{label:"remove empty",event:()=>V(this,Ws,$i).call(this,t,i=>i.text=="")}]})}}Ws=new WeakSet,$i=function(t,n){console.log(t);let s=0,i=[];for(let l of t)l.texts.find(r=>n(r))&&(l.texts=l.texts.filter(r=>!n(r)),console.log(l.texts),l.texts.length>0?i.push(l):this.frontend.subs.entries.splice(this.frontend.subs.entries.indexOf(l),1),s++);s>0?(this.frontend.current.entry&&i.indexOf(this.frontend.current.entry)>=0&&this.frontend.current.entry,this.frontend.clearSelection(),this.frontend.selection.submitted=new Set(i),this.frontend.markChanged(Ge.NonTime,Se.Action),this.frontend.status=`changed ${s} entrie${s>1?"s":""}`):this.frontend.status="changed nothing"},Ns=new WeakSet,el=function(){this.frontend.selection.currentStart=null,this.frontend.selection.currentGroup=[];for(let t of this.frontend.subs.entries)this.frontend.selection.submitted.add(t);this.frontend.onSelectionChanged.dispatch(Se.Action)},Fs=new WeakSet,tl=function(t,n){if(t.length==0)return;let s=this.frontend.subs.entries.indexOf(t[0]);if(s<0)return;let i=new Map;for(let l=0;l<this.frontend.subs.entries.length;l++)i.set(this.frontend.subs.entries[l],l);n?t.sort((l,r)=>l.texts[0].style.name.localeCompare(r.texts[0].style.name)):t.sort((l,r)=>l.start-r.start),this.frontend.subs.entries.splice(s,t.length,...t),this.frontend.markChanged(Ge.NonTime,Se.Action)},Si=new WeakSet,Zr=function(t){let n=new Map;n.set(this.frontend.subs.defaultStyle,0);for(let s=0;s<this.frontend.subs.styles.length;s++)n.set(this.frontend.subs.styles[s],s+1);for(let s of t)s.texts.sort((i,l)=>(n.get(i.style)??0)-(n.get(l.style)??0));this.frontend.markChanged(Ge.NonTime,Se.Action)},Is=new WeakSet,nl=function(t,n){if(t.length==0||n==0)return;let s=this.frontend.subs.entries.indexOf(t[0]);s+n<0||s+n>this.frontend.subs.entries.length||(this.frontend.subs.entries.splice(s,t.length),this.frontend.subs.entries.splice(s+n,0,...t),this.frontend.markChanged(Ge.NonTime,Se.Action),setTimeout(()=>{this.frontend.keepEntryInView(n>0?t.at(-1):t[0])},0))},zs=new WeakSet,sl=function(t,n){let s=t[0],i=s.start,l=s.end;for(let r=1;r<t.length;r++)n&&s.texts.push(...t[r].texts),i=Math.min(i,t[r].start),l=Math.max(l,t[r].end);s.start=i,s.end=l,this.frontend.subs.entries.splice(this.frontend.subs.entries.indexOf(s)+1,t.length-1),this.frontend.markChanged(Ge.Times,Se.Action)},vi=new WeakSet,Qr=function(t){if(t.length==0)return;let n=new Set;for(let s=0;s<t.length-1;s++){let i=t[s];if(!n.has(i))for(let l=s+1;l<t.length;l++){let r=t[l];n.has(r)||Math.abs(i.start-r.start)<this.frontend.timeEpsilon&&Math.abs(i.end-r.end)<this.frontend.timeEpsilon&&(i.texts.push(...r.texts),this.frontend.subs.entries.splice(this.frontend.subs.entries.indexOf(r),1),n.add(r))}}if(n.size>0){this.frontend.clearSelection();for(let s of t.filter(i=>!n.has(i)))this.frontend.selection.submitted.add(s);this.frontend.markChanged(Ge.Times,Se.Action)}},ki=new WeakSet,xr=function(t){if(t.length==0)return;let n=[];for(let s=0;s<t.length;s++){let i=t[s],l=this.frontend.subs.entries.indexOf(i);n.push(i);for(let r=1;r<i.texts.length;r++){l++;let h=new Ft(i.start,i.end,i.texts[r]);this.frontend.subs.entries.splice(l,0,h),n.push(h)}i.texts=[i.texts[0]]}if(n.length!=t.length){this.frontend.clearSelection();for(let s of n)this.frontend.selection.submitted.add(s);this.frontend.markChanged(Ge.Times,Se.Action)}};var Se=(e=>(e[e.UIForm=0]="UIForm",e[e.UIList=1]="UIList",e[e.Action=2]="Action",e[e.Timeline=3]="Timeline",e))(Se||{}),Ge=(e=>(e[e.NonTime=0]="NonTime",e[e.Times=1]="Times",e[e.Styles=2]="Styles",e[e.Both=3]="Both",e))(Ge||{}),rs;class ms{constructor(){A(this,rs,new Set)}dispatch(...t){a(this,rs).forEach(n=>n(...t))}bind(t){a(this,rs).add(t)}unbind(t){a(this,rs).delete(t)}}rs=new WeakMap;const zl=[{name:"SRT subtitles",extensions:["srt"]},{name:"SSA subtitles",extensions:["ssa","ass"]},{name:"subtle archive",extensions:["json"]}];var hn,Us,il,Hs,ll;class cd{constructor(){A(this,Us);A(this,Hs);te(this,"subs");te(this,"undoStack",[]);te(this,"redoStack",[]);te(this,"timeEpsilon",.01);te(this,"ui",{});te(this,"modalDialogs",{});te(this,"dialogs",{});te(this,"states",{isEditing:!1,isEditingVirtualEntry:!1,modalOpenCounter:0,virtualEntryHighlighted:!1,editChanged:!1});te(this,"selection",{submitted:new Set,currentGroup:[],currentStart:null});te(this,"current",{entry:null,style:null});te(this,"currentFile","");te(this,"fileChanged",!1);A(this,hn,"ok");te(this,"onUndoBufferChanged",new ms);te(this,"onStatusChanged",new ms);te(this,"onSubtitlesChanged",new ms);te(this,"onSubtitleObjectReload",new ms);te(this,"onSelectionChanged",new ms);te(this,"playback",new dd(this));te(this,"uiHelper",new hd(this));this.subs=ks.makeTestSubtitles(),this.markChanged(1,2),this.fileChanged=!1}get status(){return a(this,hn)}set status(t){W(this,hn,t),this.onStatusChanged.dispatch()}markChanged(t,n){this.fileChanged=!0,this.states.editChanged=!1,this.states.isEditingVirtualEntry=!1,this.undoStack.push({archive:JSON.stringify(this.subs.toSerializable()),change:t,saved:!this.fileChanged}),this.redoStack=[],this.onUndoBufferChanged.dispatch(),this.onSubtitlesChanged.dispatch(t,n)}canUndo(){return this.undoStack.length>1}canRedo(){return this.redoStack.length>0}getSelection(){return this.subs.entries.filter(t=>this.selection.submitted.has(t)||this.selection.currentGroup.includes(t))}isSelectionDisjunct(){let t=0;for(let n=0;n<this.subs.entries.length;n++){let s=this.subs.entries[n];if(this.selection.submitted.has(s)||this.selection.currentGroup.includes(s)){if(t==2)return!0;t=1}else t==1&&(t=2)}return!1}undo(){if(!this.canUndo())return!1;this.redoStack.push(this.undoStack.pop());let t=this.undoStack.at(-1);return V(this,Us,il).call(this,t),this.onUndoBufferChanged.dispatch(),!0}redo(){if(!this.canRedo())return!1;this.undoStack.push(this.redoStack.pop());let t=this.undoStack.at(-1);return V(this,Us,il).call(this,t),this.onUndoBufferChanged.dispatch(),!0}async askImportFile(){ze(this.modalDialogs.importOpt!==void 0);const t=await Ai({multiple:!1,filters:zl});if(typeof t!="string")return;const n=await vl(t);let s=this.retrieveFromSource(n);if(!s){W(this,hn,`import failed for ${t}`);return}let i=this.modalDialogs.importOpt.$on("submit",l=>{ze(s!==null),V(this,Hs,ll).call(this,s,l.detail),i()});this.modalDialogs.importOpt.$set({show:!0})}async askOpenFile(){const t=await Ai({multiple:!1,filters:zl});if(typeof t!="string")return;const n=await vl(t);let s=this.retrieveFromSource(n);if(!s){this.status=`error when reading ${t}`;return}this.openDocument(s,t)}async askOpenVideo(){const t=await Ai({multiple:!1,filters:[{name:"video file",extensions:["avi","mp4","webm","mkv"]}]});if(typeof t!="string")return;const n=wa(t);await this.playback.load(n).catch(s=>W(this,hn,s)).catch(s=>this.status="error opening video: "+s)}async askSaveFile(t=!1){let n=this.currentFile;if(n==""||t){const i=await wl({filters:[{name:"subtle archive",extensions:["json"]}]});if(typeof i!="string")return;n=i}const s=JSON.stringify(this.subs.toSerializable());await this.saveTo(n,s)&&(this.status="saved to "+n,this.fileChanged=!1,this.currentFile=n)}async askExportFile(){let t=async(n,s)=>{const i=await wl({filters:[{name:"subtitle file",extensions:[n]}]});typeof i=="string"&&await this.saveTo(i,s(this.subs))};gl({items:[{label:"SRT",event:()=>t("srt",cn.SRT)},{label:"ASS",event:()=>t("ass",cn.ASS)},{label:"plain text",event:()=>t("txt",cn.plaintext)}]})}openDocument(t,n){this.subs=t,this.current.entry=null,this.current.style=t.defaultStyle,this.currentFile=n,this.fileChanged=!1,this.status="opened: "+n,this.onSubtitleObjectReload.dispatch(),this.markChanged(3,2)}async saveTo(t,n){try{return await Ma(t,n),!0}catch(s){this.status=`error when saving to ${t}: ${s}`}return!1}retrieveFromSource(t){let n=Di.JSON(t);return n||(t=lt.normalizeNewlines(t),n=Di.SRT(t),n)||(n=Di.ASSFragment(t)),n}focusOnCurrentEntry(){if(!this.current.entry)return;let t=this.current.entry,n=t.texts.find(s=>s.style==this.current.style);n||(n=t.texts[0]),this.current.style=n.style,n.gui&&(this.status="focused on "+n.style.name+" of "+n.text,n.gui.focus(),n.gui.scrollIntoView())}keepEntryInView(t){if(!t.gui||!this.ui.subscontainer||!this.ui.tableHeader)return;t.gui.scrollIntoView({block:"nearest"});let n=this.ui.subscontainer.scrollTop+this.ui.tableHeader.offsetHeight;t.gui.offsetTop<n&&this.ui.subscontainer.scroll(0,t.gui.offsetTop-this.ui.tableHeader.offsetHeight)}insertEntryBefore(t){let n=t?this.subs.entries.indexOf(t):0;if(n<0)return;let s,i,l=this.playback.isLoaded?this.playback.position:1/0;if(this.subs.entries.length==0)s=0,i=2;else if(n==0){let h=this.subs.entries[0];s=Math.max(Math.min(l,h.start-2),0),i=Math.min(s+2,h.start)}else{ze(t!==void 0);let h=this.subs.entries[n-1];h.end<=t.start?(s=Math.max(Math.min(l,t.start-2),h.end),i=Math.min(s+2,t.start)):(s=Math.max(Math.min(l,t.start-2),0),i=Math.min(s+2,t.start))}let r=t?new Ft(s,i,...t.texts.map(h=>({style:h.style,text:""}))):new Ft(s,i,{style:this.subs.defaultStyle,text:""});return this.subs.entries.splice(n,0,r),this.markChanged(1,2),setTimeout(()=>this.selectEntry(r),0),r}insertEntryAfter(t){let n=t?this.subs.entries.indexOf(t)+1:this.subs.entries.length;if(n<0)return;let s,i,l=this.playback.isLoaded?this.playback.position:1/0;if(n==this.subs.entries.length){let h=this.subs.entries.at(-1);s=Math.max(l,(h==null?void 0:h.end)??0),i=s+2}else{ze(t!==void 0);let h=this.subs.entries[n];h.start>=t.end?(s=Math.max(Math.min(h.start,l),t.end),i=Math.min(s+2,h.start)):(s=t.end,i=s+2)}let r=t?new Ft(s,i,...t.texts.map(h=>({style:h.style,text:""}))):new Ft(s,i,{style:this.subs.defaultStyle,text:""});return this.subs.entries.splice(n,0,r),this.markChanged(1,2),setTimeout(()=>this.selectEntry(r),0),r}startEditingNewVirtualEntry(){W(this,hn,"new entry appended");let t=this.subs.entries.at(-1),n=t?new Ft(t.end,t.end+2,...t.texts.map(s=>({style:s.style,text:""}))):new Ft(0,0,{style:this.subs.defaultStyle,text:""});this.subs.entries.push(n),this.markChanged(1,2),this.clearSelection(),this.selectEntry(n),this.current.style=n.texts[0].style,setTimeout(()=>{this.keepEntryInView(n),this.focusOnCurrentEntry()},0),this.states.isEditingVirtualEntry=!0,this.states.virtualEntryHighlighted=!1}insertChannelAt(t){ze(this.current.entry!==null);let n=this.current.entry,s={style:n.texts[t].style,text:""};n.texts=n.texts.toSpliced(t+1,0,s),this.markChanged(0,2),setTimeout(()=>{var i,l;(i=s.gui)==null||i.focus(),(l=s.gui)==null||l.scrollIntoView()},0)}deleteChannelAt(t){ze(this.current.entry!==null);let n=this.current.entry;n.texts=n.texts.toSpliced(t,1),this.markChanged(0,2)}clearSelection(t=1){this.selection.submitted.clear(),this.selection.currentGroup=[],this.selection.currentStart=null,this.current.entry=null,this.onSelectionChanged.dispatch(t)}deleteSelection(t=1){let n=this.getSelection();if(n.length==0)return;let s=this.subs.entries.at(this.subs.entries.indexOf(n.at(-1))+1),i=this.subs.entries.filter(l=>!n.includes(l));this.subs.entries=i,this.clearSelection(),s?this.selectEntry(s):this.states.virtualEntryHighlighted=!0,this.markChanged(1,2),this.onSelectionChanged.dispatch(t)}copySelection(t=cn.JSON){let n=new Set([...this.selection.currentGroup,...this.selection.submitted]);if(n.size==0)return;let s=this.subs.entries.filter(l=>n.has(l)),i=new kn(this.subs);i.entries=s,Sa(t(i)),this.status="copied"}async paste(){const t=await va();if(!t)return;let n=this.retrieveFromSource(t);if(!n){this.status="cannot read clipboard data as subtitles";return}let s;this.selection.submitted.size>0||this.selection.currentStart?(s=this.subs.entries.findIndex(i=>this.selection.submitted.has(i)||this.selection.currentGroup.includes(i)),this.clearSelection()):s=this.subs.entries.length,V(this,Hs,ll).call(this,n,{position:ul.Custom,customPosition:s,style:ol.KeepDifferent}),this.status="pasted"}offsetFocus(t,n=!1,s=!1){if(this.current.entry==null)return;let i=this.current.entry,l=this.subs.entries.indexOf(i)+t;if(l<0||l>=this.subs.entries.length){this.status="focusOffset out of range";return}this.selectEntry(this.subs.entries[l],n,s)}toggleEntry(t,n=!1,s=!1,i=1){if(s){if(this.current.entry==t&&(this.current.entry=null),this.selection.currentGroup.includes(t)){for(let l of this.selection.currentGroup)this.selection.submitted.add(l);this.selection.currentStart=null,this.selection.currentGroup=[]}if(this.selection.submitted.has(t)){this.selection.submitted.delete(t),this.states.isEditingVirtualEntry=!1,this.states.virtualEntryHighlighted=!1,W(this,hn,"multiselect removed item"),this.onSelectionChanged.dispatch(i);return}}this.selectEntry(t,n,s,i)}selectEntry(t,n=!1,s=!1,i=1){if(n)if(this.selection.currentStart==null)this.selection.currentStart=t,this.selection.currentGroup=[t];else{let l=this.subs.entries.indexOf(this.selection.currentStart),r=this.subs.entries.indexOf(t);ze(l>=0&&r>=0),this.selection.currentGroup=this.subs.entries.slice(Math.min(l,r),Math.max(l,r)+1)}else if(s){for(let l of this.selection.currentGroup)this.selection.submitted.add(l);this.selection.currentStart=t,this.selection.currentGroup=[t]}else this.selection.submitted.clear(),this.selection.currentGroup=[t],this.selection.currentStart=t;this.current.entry!=t&&(this.states.isEditingVirtualEntry=!1,this.states.virtualEntryHighlighted=!1,this.current.entry=t,this.keepEntryInView(t),this.onSelectionChanged.dispatch(i))}}hn=new WeakMap,Us=new WeakSet,il=function(t){this.clearSelection(),this.current.entry=null,this.current.style=null,this.subs=kn.deserialize(JSON.parse(t.archive)),this.fileChanged=!t.saved,this.onSubtitleObjectReload.dispatch(),this.onSubtitlesChanged.dispatch(t.change,2)},Hs=new WeakSet,ll=function(t,n){this.subs.merge(t,n);for(let s of t.entries)this.selection.submitted.add(s);this.markChanged(3,2)};function Ul(e,t,n){const s=e.slice();return s[7]=t[n],s}function Hl(e){let t,n=e[7].name+"",s,i,l;return{c(){t=c("option"),s=Ne(n),t.selected=i=e[0]==e[7],t.__value=l=e[7].name,H(t,t.__value)},m(r,h){B(r,t,h),o(t,s)},p(r,h){h&2&&n!==(n=r[7].name+"")&&Pt(s,n),h&3&&i!==(i=r[0]==r[7])&&(t.selected=i),h&2&&l!==(l=r[7].name)&&(t.__value=l,H(t,t.__value))},d(r){r&&G(t)}}}function ql(e){let t,n=e[1].defaultStyle.name+"",s,i,l,r,h,u=tn(e[1].styles),d=[];for(let f=0;f<u.length;f+=1)d[f]=Hl(Ul(e,u,f));return{c(){t=c("option"),s=Ne(n),i=b();for(let f=0;f<d.length;f+=1)d[f].c();h=ws(),t.selected=l=e[0]==e[1].defaultStyle,t.__value=r=`
        `+e[1].defaultStyle.name+`
    `,H(t,t.__value)},m(f,g){B(f,t,g),o(t,s),o(t,i);for(let p=0;p<d.length;p+=1)d[p]&&d[p].m(f,g);B(f,h,g)},p(f,g){if(g&2&&n!==(n=f[1].defaultStyle.name+"")&&Pt(s,n),g&3&&l!==(l=f[0]==f[1].defaultStyle)&&(t.selected=l),g&2&&r!==(r=`
        `+f[1].defaultStyle.name+`
    `)&&(t.__value=r,H(t,t.__value)),g&3){u=tn(f[1].styles);let p;for(p=0;p<u.length;p+=1){const w=Ul(f,u,p);d[p]?d[p].p(w,g):(d[p]=Hl(w),d[p].c(),d[p].m(h.parentNode,h))}for(;p<d.length;p+=1)d[p].d(1);d.length=u.length}},d(f){f&&(G(t),G(h)),ar(d,f)}}}function fd(e){let t,n=e[2],s,i,l=ql(e);return{c(){t=c("select"),l.c(),m(t,"class","styleselect"),m(t,"tabindex","-1")},m(r,h){B(r,t,h),l.m(t,null),s||(i=[P(t,"input",e[4]),P(t,"click",e[5])],s=!0)},p(r,[h]){h&4&&At(n,n=r[2])?(l.d(1),l=ql(r),l.c(),l.m(t,null)):l.p(r,h)},i:Ot,o:Ot,d(r){r&&G(t),l.d(r),s=!1,ct(i)}}}function md(e,t,n){let{subtitles:s}=t,{currentStyle:i}=t,l=0;const r=ds(),h=()=>r("submit"),u=f=>{let g=f.currentTarget.selectedIndex;g<=0?n(0,i=s.defaultStyle):n(0,i=s.styles[g-1]),h()},d=()=>n(2,l++,l);return e.$$set=f=>{"subtitles"in f&&n(1,s=f.subtitles),"currentStyle"in f&&n(0,i=f.currentStyle)},[i,s,l,h,u,d]}class si extends sn{constructor(t){super(),nn(this,t,md,fd,At,{subtitles:1,currentStyle:0})}get subtitles(){return this.$$.ctx[1]}set subtitles(t){this.$$set({subtitles:t}),$s()}get currentStyle(){return this.$$.ctx[0]}set currentStyle(t){this.$$set({currentStyle:t}),$s()}}function pd(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce,j,O,pe,be,He,E,ke,ee,Z,I,ie,Oe,fe,et,ne,we,Ce,Ee,le,de,Fe,Y,Xe,rt,me,ft,Ae,Ye,tt,Me,mt,at,Le,ht,oe,xe,pt,yt,Ie,q,Ue,qe,Ve,kt,bt,nt,st,T;function ge(Te){e[16](Te)}let je={subtitles:e[0].subs};return e[5]!==void 0&&(je.currentStyle=e[5]),O=new si({props:je}),e[15](O),he.push(()=>dt(O,"currentStyle",ge)),bt=xs(e[10][0]),nt=xs(e[10][1]),{c(){t=c("form"),n=c("table"),s=c("tr"),i=c("td"),i.textContent="styles",l=b(),r=c("td"),h=c("input"),u=b(),d=c("label"),d.textContent="import only different ones",f=c("br"),g=b(),p=c("input"),w=b(),C=c("label"),C.textContent="import all (even if identical to existing style)",v=c("br"),M=b(),_=c("input"),y=b(),k=c("label"),k.textContent="use local styles when names match",L=c("br"),J=b(),U=c("input"),F=b(),R=c("label"),R.textContent="overwrite local styles when names match",N=c("br"),Q=b(),x=c("input"),ue=b(),ce=c("label"),j=Ne("use "),Qe(O.$$.fragment),be=Ne(" for all"),He=c("br"),E=b(),ke=c("tr"),ee=c("td"),Z=b(),I=c("td"),ie=c("input"),Oe=b(),fe=c("label"),fe.textContent="import unused styles as well",et=c("br"),ne=b(),we=c("tr"),Ce=c("td"),Ce.textContent="position",Ee=b(),le=c("td"),de=c("input"),Fe=b(),Y=c("label"),Y.textContent="after existing lines",Xe=c("br"),rt=b(),me=c("input"),ft=b(),Ae=c("label"),Ae.textContent="before existing lines",Ye=c("br"),tt=b(),Me=c("input"),mt=b(),at=c("label"),at.textContent="sorted; before existing lines if time points are equal",Le=c("br"),ht=b(),oe=c("input"),xe=b(),pt=c("label"),pt.textContent="sorted; after existing lines if time points are equal",yt=c("br"),Ie=b(),q=c("input"),Ue=b(),qe=c("label"),qe.textContent="overwrite current file",Ve=c("br"),m(h,"type","radio"),m(h,"id","is1"),h.__value="KeepDifferent",H(h,h.__value),m(d,"for","is1"),m(p,"type","radio"),m(p,"id","is2"),p.__value="KeepAll",H(p,p.__value),m(C,"for","is2"),m(_,"type","radio"),m(_,"id","is3"),_.__value="UseLocalByName",H(_,_.__value),m(k,"for","is3"),m(U,"type","radio"),m(U,"id","is4"),U.__value="Overwrite",H(U,U.__value),m(R,"for","is4"),m(x,"type","radio"),m(x,"id","is5"),x.__value="UseOverrideForAll",H(x,x.__value),m(ce,"for","is5"),m(ie,"type","checkbox"),m(ie,"id","i6"),m(fe,"for","i6"),m(de,"type","radio"),m(de,"id","ib1"),de.__value="After",H(de,de.__value),m(Y,"for","ib1"),m(me,"type","radio"),m(me,"id","ib2"),me.__value="Before",H(me,me.__value),m(Ae,"for","ib2"),m(Me,"type","radio"),m(Me,"id","ib3"),Me.__value="SortedBefore",H(Me,Me.__value),m(at,"for","ib3"),m(oe,"type","radio"),m(oe,"id","ib4"),oe.__value="SortedAfter",H(oe,oe.__value),m(pt,"for","ib4"),m(q,"type","radio"),m(q,"id","ib5"),q.__value="Overwrite",H(q,q.__value),m(qe,"for","ib5"),m(n,"class","config"),bt.p(de,me,Me,oe,q),nt.p(h,p,_,U,x)},m(Te,_e){B(Te,t,_e),o(t,n),o(n,s),o(s,i),o(s,l),o(s,r),o(r,h),h.checked=h.__value===e[6],o(r,u),o(r,d),o(r,f),o(r,g),o(r,p),p.checked=p.__value===e[6],o(r,w),o(r,C),o(r,v),o(r,M),o(r,_),_.checked=_.__value===e[6],o(r,y),o(r,k),o(r,L),o(r,J),o(r,U),U.checked=U.__value===e[6],o(r,F),o(r,R),o(r,N),o(r,Q),o(r,x),x.checked=x.__value===e[6],o(r,ue),o(r,ce),o(ce,j),Be(O,ce,null),o(ce,be),o(r,He),o(n,E),o(n,ke),o(ke,ee),o(ke,Z),o(ke,I),o(I,ie),e[17](ie),o(I,Oe),o(I,fe),o(I,et),o(n,ne),o(n,we),o(we,Ce),o(we,Ee),o(we,le),o(le,de),de.checked=de.__value===e[7],o(le,Fe),o(le,Y),o(le,Xe),o(le,rt),o(le,me),me.checked=me.__value===e[7],o(le,ft),o(le,Ae),o(le,Ye),o(le,tt),o(le,Me),Me.checked=Me.__value===e[7],o(le,mt),o(le,at),o(le,Le),o(le,ht),o(le,oe),oe.checked=oe.__value===e[7],o(le,xe),o(le,pt),o(le,yt),o(le,Ie),o(le,q),q.checked=q.__value===e[7],o(le,Ue),o(le,qe),o(le,Ve),e[23](t),kt=!0,st||(T=[P(h,"change",e[9]),P(p,"change",e[11]),P(_,"change",e[12]),P(U,"change",e[13]),P(x,"change",e[14]),P(de,"change",e[18]),P(me,"change",e[19]),P(Me,"change",e[20]),P(oe,"change",e[21]),P(q,"change",e[22])],st=!0)},p(Te,_e){_e&64&&(h.checked=h.__value===Te[6]),_e&64&&(p.checked=p.__value===Te[6]),_e&64&&(_.checked=_.__value===Te[6]),_e&64&&(U.checked=U.__value===Te[6]),_e&64&&(x.checked=x.__value===Te[6]);const wt={};_e&1&&(wt.subtitles=Te[0].subs),!pe&&_e&32&&(pe=!0,wt.currentStyle=Te[5],ut(()=>pe=!1)),O.$set(wt),_e&128&&(de.checked=de.__value===Te[7]),_e&128&&(me.checked=me.__value===Te[7]),_e&128&&(Me.checked=Me.__value===Te[7]),_e&128&&(oe.checked=oe.__value===Te[7]),_e&128&&(q.checked=q.__value===Te[7])},i(Te){kt||(ve(O.$$.fragment,Te),kt=!0)},o(Te){Pe(O.$$.fragment,Te),kt=!1},d(Te){Te&&G(t),e[15](null),Ke(O),e[17](null),e[23](null),bt.r(),nt.r(),st=!1,ct(T)}}}function gd(e){let t,n,s,i;function l(u){e[24](u)}function r(u){e[25](u)}let h={$$slots:{default:[pd]},$$scope:{ctx:e}};return e[0]!==void 0&&(h.frontend=e[0]),e[1]!==void 0&&(h.show=e[1]),t=new Ti({props:h}),he.push(()=>dt(t,"frontend",l)),he.push(()=>dt(t,"show",r)),t.$on("submit",e[26]),{c(){Qe(t.$$.fragment)},m(u,d){Be(t,u,d),i=!0},p(u,[d]){const f={};d&268435709&&(f.$$scope={dirty:d,ctx:u}),!n&&d&1&&(n=!0,f.frontend=u[0],ut(()=>n=!1)),!s&&d&2&&(s=!0,f.show=u[1],ut(()=>s=!1)),t.$set(f)},i(u){i||(ve(t.$$.fragment,u),i=!0)},o(u){Pe(t.$$.fragment,u),i=!1},d(u){Ke(t,u)}}}function _d(e,t,n){let{frontend:s}=t,{show:i=!1}=t,l,r,h,u=s.subs.defaultStyle,d="KeepDifferent",f="After";const g=ds(),p=O=>g("submit",O),w=[[],[]];function C(){d=this.__value,n(6,d)}function v(){d=this.__value,n(6,d)}function M(){d=this.__value,n(6,d)}function _(){d=this.__value,n(6,d)}function y(){d=this.__value,n(6,d)}function k(O){he[O?"unshift":"push"](()=>{r=O,n(3,r)})}function L(O){u=O,n(5,u)}function J(O){he[O?"unshift":"push"](()=>{h=O,n(4,h)})}function U(){f=this.__value,n(7,f)}function F(){f=this.__value,n(7,f)}function R(){f=this.__value,n(7,f)}function N(){f=this.__value,n(7,f)}function Q(){f=this.__value,n(7,f)}function x(O){he[O?"unshift":"push"](()=>{l=O,n(2,l)})}function ue(O){s=O,n(0,s)}function ce(O){i=O,n(1,i)}const j=()=>{p({style:ol[d],overrideStyle:u,position:ul[f],importAllStyles:h.checked})};return e.$$set=O=>{"frontend"in O&&n(0,s=O.frontend),"show"in O&&n(1,i=O.show)},[s,i,l,r,h,u,d,f,p,C,w,v,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce,j]}class yd extends sn{constructor(t){super(),nn(this,t,_d,gd,At,{frontend:0,show:1})}}function bd(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce,j,O,pe,be,He,E,ke,ee,Z,I,ie,Oe,fe,et,ne,we,Ce,Ee,le,de,Fe,Y,Xe,rt,me,ft,Ae,Ye,tt,Me,mt,at,Le,ht,oe,xe,pt,yt,Ie,q,Ue,qe,Ve,kt,bt,nt,st,T,ge,je,Te,_e,wt,jt,It,Ct,Lt,Gt,Bt,Jt,Kt,re,Re,St,Mn,ln,Rt,zn,Mt,vt,D,se,Dt,Un,Xt,hs,Hn,zt,cs,qn,fn,Pi,_l;return{c(){t=c("tr"),n=c("td"),s=c("button"),i=Ne("+"),r=b(),h=c("br"),u=b(),d=c("button"),f=Ne(""),p=b(),w=c("button"),C=Ne(""),M=b(),_=c("button"),_.textContent="...",y=b(),k=c("td"),k.innerHTML='<label for="name">name:</label>',L=b(),J=c("td"),U=c("input"),R=b(),N=c("tr"),Q=c("td"),Q.innerHTML='<label for="font">font:</label>',x=b(),ue=c("td"),ce=c("input"),j=b(),O=c("tr"),pe=c("td"),pe.innerHTML='<label for="size">font size:</label>',be=b(),He=c("td"),E=c("input"),ke=b(),ee=c("tr"),Z=c("td"),I=b(),ie=c("td"),Oe=c("input"),fe=c("label"),fe.textContent="bold",et=b(),ne=c("input"),we=c("label"),we.textContent="italic",Ce=b(),Ee=c("input"),le=c("label"),le.textContent="underline",de=b(),Fe=c("input"),Y=c("label"),Y.textContent="strikethru",Xe=b(),rt=c("tr"),me=c("td"),me.innerHTML='<label for="color">text color:</label>',ft=b(),Ae=c("td"),Ye=c("input"),tt=b(),Me=c("tr"),mt=c("td"),mt.innerHTML='<label for="ocolor">line color:</label>',at=b(),Le=c("td"),ht=c("input"),oe=b(),xe=c("tr"),pt=c("td"),pt.innerHTML='<label for="outline">line size:</label>',yt=b(),Ie=c("td"),q=c("input"),Ue=b(),qe=c("tr"),Ve=c("td"),Ve.innerHTML='<label for="shadow">shadow:</label>',kt=b(),bt=c("td"),nt=c("input"),st=b(),T=c("tr"),ge=c("td"),ge.innerHTML='<label for="align">alignment:</label>',je=b(),Te=c("td"),_e=c("select"),wt=c("option"),wt.textContent="bottom left",jt=c("option"),jt.textContent="bottom center",It=c("option"),It.textContent="bottom right",Ct=c("option"),Ct.textContent="center left",Lt=c("option"),Lt.textContent="center",Gt=c("option"),Gt.textContent="center right",Bt=c("option"),Bt.textContent="top left",Jt=c("option"),Jt.textContent="top center",Kt=c("option"),Kt.textContent="top right",re=b(),Re=c("tr"),St=c("td"),St.textContent="margins:",Mn=b(),ln=c("td"),Rt=c("table"),zn=c("tr"),zn.innerHTML="<td>top</td><td>bottom</td><td>left</td><td>right</td>",Mt=b(),vt=c("tr"),D=c("td"),se=c("input"),Dt=b(),Un=c("td"),Xt=c("input"),hs=b(),Hn=c("td"),zt=c("input"),cs=b(),qn=c("td"),fn=c("input"),s.disabled=l=e[0]==e[1].defaultStyle,m(s,"class","svelte-1vd74vs"),d.disabled=g=e[0]==e[1].defaultStyle||e[0]==e[1].styles[0],m(d,"class","svelte-1vd74vs"),w.disabled=v=e[0]==e[1].defaultStyle||e[0]==e[1].styles.at(-1),m(w,"class","svelte-1vd74vs"),m(_,"class","svelte-1vd74vs"),m(n,"class","toolbar svelte-1vd74vs"),m(n,"rowspan","10"),m(U,"id","name"),m(U,"class",F=Cn(e[6](e[0].name)?"duplicate":"")+" svelte-1vd74vs"),m(ce,"id","font"),m(ce,"class","svelte-1vd74vs"),m(E,"id","size"),m(E,"type","number"),m(E,"class","svelte-1vd74vs"),m(Oe,"type","checkbox"),m(Oe,"id","bold"),m(Oe,"class","svelte-1vd74vs"),m(fe,"for","bold"),m(ne,"type","checkbox"),m(ne,"id","italic"),m(ne,"class","svelte-1vd74vs"),m(we,"for","italic"),m(Ee,"type","checkbox"),m(Ee,"id","underline"),m(Ee,"class","svelte-1vd74vs"),m(le,"for","underline"),m(Fe,"type","checkbox"),m(Fe,"id","strikethru"),m(Fe,"class","svelte-1vd74vs"),m(Y,"for","strikethru"),m(Ye,"id","color"),m(Ye,"class","svelte-1vd74vs"),m(ht,"id","ocolor"),m(ht,"class","svelte-1vd74vs"),m(q,"id","outline"),m(q,"type","number"),m(q,"class","svelte-1vd74vs"),m(nt,"id","shadow"),m(nt,"type","number"),m(nt,"class","svelte-1vd74vs"),wt.__value="BottomLeft",H(wt,wt.__value),jt.__value="BottomCenter",H(jt,jt.__value),It.__value="BottomRight",H(It,It.__value),Ct.__value="CenterLeft",H(Ct,Ct.__value),Lt.__value="Center",H(Lt,Lt.__value),Gt.__value="CenterRight",H(Gt,Gt.__value),Bt.__value="TopLeft",H(Bt,Bt.__value),Jt.__value="TopCenter",H(Jt,Jt.__value),Kt.__value="TopRight",H(Kt,Kt.__value),m(_e,"id","align"),m(se,"type","number"),m(se,"class","svelte-1vd74vs"),m(Xt,"type","number"),m(Xt,"class","svelte-1vd74vs"),m(zt,"type","number"),m(zt,"class","svelte-1vd74vs"),m(fn,"type","number"),m(fn,"class","svelte-1vd74vs"),m(Rt,"class","margin svelte-1vd74vs")},m(K,ye){B(K,t,ye),o(t,n),o(n,s),o(s,i),o(n,r),o(n,h),o(n,u),o(n,d),o(d,f),o(n,p),o(n,w),o(w,C),o(n,M),o(n,_),e[11](_),o(t,y),o(t,k),o(t,L),o(t,J),o(J,U),H(U,e[0].name),B(K,R,ye),B(K,N,ye),o(N,Q),o(N,x),o(N,ue),o(ue,ce),H(ce,e[0].font),B(K,j,ye),B(K,O,ye),o(O,pe),o(O,be),o(O,He),o(He,E),H(E,e[0].size),B(K,ke,ye),B(K,ee,ye),o(ee,Z),o(ee,I),o(ee,ie),o(ie,Oe),Oe.checked=e[0].styles.bold,o(ie,fe),o(ie,et),o(ie,ne),ne.checked=e[0].styles.italic,o(ie,we),o(ie,Ce),o(ie,Ee),Ee.checked=e[0].styles.underline,o(ie,le),o(ie,de),o(ie,Fe),Fe.checked=e[0].styles.strikethrough,o(ie,Y),B(K,Xe,ye),B(K,rt,ye),o(rt,me),o(rt,ft),o(rt,Ae),o(Ae,Ye),H(Ye,e[0].color),B(K,tt,ye),B(K,Me,ye),o(Me,mt),o(Me,at),o(Me,Le),o(Le,ht),H(ht,e[0].outlineColor),B(K,oe,ye),B(K,xe,ye),o(xe,pt),o(xe,yt),o(xe,Ie),o(Ie,q),H(q,e[0].outline),B(K,Ue,ye),B(K,qe,ye),o(qe,Ve),o(qe,kt),o(qe,bt),o(bt,nt),H(nt,e[0].shadow),B(K,st,ye),B(K,T,ye),o(T,ge),o(T,je),o(T,Te),o(Te,_e),o(_e,wt),o(_e,jt),o(_e,It),o(_e,Ct),o(_e,Lt),o(_e,Gt),o(_e,Bt),o(_e,Jt),o(_e,Kt),e[25](_e),B(K,re,ye),B(K,Re,ye),o(Re,St),o(Re,Mn),o(Re,ln),o(ln,Rt),o(Rt,zn),o(Rt,Mt),o(Rt,vt),o(vt,D),o(D,se),H(se,e[0].margin.top),o(vt,Dt),o(vt,Un),o(Un,Xt),H(Xt,e[0].margin.bottom),o(vt,hs),o(vt,Hn),o(Hn,zt),H(zt,e[0].margin.left),o(vt,cs),o(vt,qn),o(qn,fn),H(fn,e[0].margin.right),Pi||(_l=[P(s,"click",e[8]),P(d,"click",e[9]),P(w,"click",e[10]),P(_,"click",e[12]),P(U,"input",e[13]),P(U,"change",e[14]),P(ce,"input",e[15]),P(E,"input",e[16]),P(Oe,"change",e[17]),P(ne,"change",e[18]),P(Ee,"change",e[19]),P(Fe,"change",e[20]),P(Ye,"input",e[21]),P(ht,"input",e[22]),P(q,"input",e[23]),P(nt,"input",e[24]),P(_e,"input",e[26]),P(se,"input",e[27]),P(Xt,"input",e[28]),P(zt,"input",e[29]),P(fn,"input",e[30])],Pi=!0)},p(K,ye){ye[0]&3&&l!==(l=K[0]==K[1].defaultStyle)&&(s.disabled=l),ye[0]&3&&g!==(g=K[0]==K[1].defaultStyle||K[0]==K[1].styles[0])&&(d.disabled=g),ye[0]&3&&v!==(v=K[0]==K[1].defaultStyle||K[0]==K[1].styles.at(-1))&&(w.disabled=v),ye[0]&1&&F!==(F=Cn(K[6](K[0].name)?"duplicate":"")+" svelte-1vd74vs")&&m(U,"class",F),ye[0]&1&&U.value!==K[0].name&&H(U,K[0].name),ye[0]&1&&ce.value!==K[0].font&&H(ce,K[0].font),ye[0]&1&&it(E.value)!==K[0].size&&H(E,K[0].size),ye[0]&1&&(Oe.checked=K[0].styles.bold),ye[0]&1&&(ne.checked=K[0].styles.italic),ye[0]&1&&(Ee.checked=K[0].styles.underline),ye[0]&1&&(Fe.checked=K[0].styles.strikethrough),ye[0]&1&&Ye.value!==K[0].color&&H(Ye,K[0].color),ye[0]&1&&ht.value!==K[0].outlineColor&&H(ht,K[0].outlineColor),ye[0]&1&&it(q.value)!==K[0].outline&&H(q,K[0].outline),ye[0]&1&&it(nt.value)!==K[0].shadow&&H(nt,K[0].shadow),ye[0]&1&&it(se.value)!==K[0].margin.top&&H(se,K[0].margin.top),ye[0]&1&&it(Xt.value)!==K[0].margin.bottom&&H(Xt,K[0].margin.bottom),ye[0]&1&&it(zt.value)!==K[0].margin.left&&H(zt,K[0].margin.left),ye[0]&1&&it(fn.value)!==K[0].margin.right&&H(fn,K[0].margin.right)},i:Ot,o:Ot,d(K){K&&(G(t),G(R),G(N),G(j),G(O),G(ke),G(ee),G(Xe),G(rt),G(tt),G(Me),G(oe),G(xe),G(Ue),G(qe),G(st),G(T),G(re),G(Re)),e[11](null),e[25](null),Pi=!1,ct(_l)}}}function wd(e,t,n){const s=ds(),i=()=>s("submit");let{style:l}=t,{subtitles:r}=t,{frontend:h}=t,u,d;function f(E){for(let ke of[...r.styles,r.defaultStyle])if(ke!==l&&ke.name==E)return!0;return!1}function g(){let E=l==r.defaultStyle,ke=r.entries.filter(Z=>Z.texts.find(I=>I.style==l)!==void 0),ee=E?[]:[r.defaultStyle];ee.push(...r.styles.filter(Z=>Z!==l)),gl({items:[{label:"delete",disabled:ke.length>0||E,event:()=>{let Z=r.styles.indexOf(l);Z<0||(r.styles.splice(Z,1),h.markChanged(Ge.Styles,Se.Action),i())}},{label:"replace by",disabled:ee.length==0,subitems:ee.map(Z=>({label:Z.name,payload:Z,event:I=>{I&&ks.replaceStyle(r.entries,l,I.payload)&&h.markChanged(Ge.NonTime,Se.Action)}}))},{label:"duplicate",event:()=>{let Z=l.clone();Z.name=ks.getUniqueStyleName(r,l.name),r.styles.push(Z),n(1,r),h.markChanged(Ge.Styles,Se.Action),i()}}]})}const p=()=>{let E=r.styles.indexOf(l);ze(E>=0);let ke=new vn("new");n(1,r.styles=r.styles.toSpliced(E,0,ke),r),i()},w=()=>{let E=r.styles.indexOf(l);ze(E>=0),n(1,r.styles=[...r.styles.slice(0,E-1),l,r.styles[E-1],...r.styles.slice(E+1)],r),i()},C=()=>{let E=r.styles.indexOf(l);ze(E>=0),n(1,r.styles=[...r.styles.slice(0,E),r.styles[E+1],l,...r.styles.slice(E+2)],r),i()};function v(E){he[E?"unshift":"push"](()=>{d=E,n(4,d)})}const M=()=>g();function _(){l.name=this.value,n(0,l)}const y=()=>h.markChanged(Ge.Styles,Se.Action);function k(){l.font=this.value,n(0,l)}function L(){l.size=it(this.value),n(0,l)}function J(){l.styles.bold=this.checked,n(0,l)}function U(){l.styles.italic=this.checked,n(0,l)}function F(){l.styles.underline=this.checked,n(0,l)}function R(){l.styles.strikethrough=this.checked,n(0,l)}function N(){l.color=this.value,n(0,l)}function Q(){l.outlineColor=this.value,n(0,l)}function x(){l.outline=it(this.value),n(0,l)}function ue(){l.shadow=it(this.value),n(0,l)}function ce(E){he[E?"unshift":"push"](()=>{u=E,n(3,u),n(0,l)})}const j=()=>n(0,l.alignment=u.selectedIndex+1,l);function O(){l.margin.top=it(this.value),n(0,l)}function pe(){l.margin.bottom=it(this.value),n(0,l)}function be(){l.margin.left=it(this.value),n(0,l)}function He(){l.margin.right=it(this.value),n(0,l)}return e.$$set=E=>{"style"in E&&n(0,l=E.style),"subtitles"in E&&n(1,r=E.subtitles),"frontend"in E&&n(2,h=E.frontend)},e.$$.update=()=>{e.$$.dirty[0]&9&&u&&n(3,u.selectedIndex=l.alignment-1,u)},[l,r,h,u,d,i,f,g,p,w,C,v,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce,j,O,pe,be,He]}class $r extends sn{constructor(t){super(),nn(this,t,wd,bd,At,{style:0,subtitles:1,frontend:2},null,[-1,-1])}}function Vl(e,t,n){const s=e.slice();return s[9]=t[n],s}function jl(e,t){let n,s,i;return s=new $r({props:{frontend:t[0],style:t[9],subtitles:t[0].subs}}),s.$on("submit",t[5]),{key:e,first:null,c(){n=ws(),Qe(s.$$.fragment),this.first=n},m(l,r){B(l,n,r),Be(s,l,r),i=!0},p(l,r){t=l;const h={};r&1&&(h.frontend=t[0]),r&1&&(h.style=t[9]),r&1&&(h.subtitles=t[0].subs),s.$set(h)},i(l){i||(ve(s.$$.fragment,l),i=!0)},o(l){Pe(s.$$.fragment,l),i=!1},d(l){l&&G(n),Ke(s,l)}}}function Sd(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y,k=[],L=new Map,J,U,F,R,N,Q,x;_=new $r({props:{frontend:e[0],style:e[0].subs.defaultStyle,subtitles:e[0].subs}});let ue=tn(e[0].subs.styles);const ce=j=>j[9].uniqueID;for(let j=0;j<ue.length;j+=1){let O=Vl(e,ue,j),pe=ce(O);L.set(pe,k[j]=jl(pe,O))}return{c(){t=c("table"),n=c("tr"),n.innerHTML='<td>title</td> <td><input class="txt svelte-1n9pcjd"/></td>',s=b(),i=c("tr"),i.innerHTML='<td>language</td> <td><input class="txt svelte-1n9pcjd"/></td>',l=b(),r=c("tr"),h=c("td"),h.textContent="resolution",u=b(),d=c("td"),f=c("input"),g=Ne(`
        
        `),p=c("input"),w=b(),C=c("tr"),C.innerHTML="<td>styles</td> <td><hr/></td>",v=b(),M=c("table"),Qe(_.$$.fragment),y=b();for(let j=0;j<k.length;j+=1)k[j].c();J=b(),U=c("tr"),F=c("td"),R=c("button"),R.textContent="+",m(f,"type","number"),m(f,"class","res svelte-1n9pcjd"),m(p,"type","number"),m(p,"class","res svelte-1n9pcjd"),m(t,"class","config"),qt(R,"width","25px"),qt(R,"height","20px"),qt(F,"padding-right","10px"),m(M,"class","txt svelte-1n9pcjd")},m(j,O){B(j,t,O),o(t,n),o(t,s),o(t,i),o(t,l),o(t,r),o(r,h),o(r,u),o(r,d),o(d,f),H(f,e[0].subs.width),o(d,g),o(d,p),H(p,e[0].subs.height),o(t,w),o(t,C),B(j,v,O),B(j,M,O),Be(_,M,null),o(M,y);for(let pe=0;pe<k.length;pe+=1)k[pe]&&k[pe].m(M,null);o(M,J),o(M,U),o(U,F),o(F,R),N=!0,Q||(x=[P(f,"input",e[2]),P(f,"change",e[3]),P(p,"input",e[4]),P(R,"click",e[6])],Q=!0)},p(j,O){O&1&&it(f.value)!==j[0].subs.width&&H(f,j[0].subs.width),O&1&&it(p.value)!==j[0].subs.height&&H(p,j[0].subs.height);const pe={};O&1&&(pe.frontend=j[0]),O&1&&(pe.style=j[0].subs.defaultStyle),O&1&&(pe.subtitles=j[0].subs),_.$set(pe),O&1&&(ue=tn(j[0].subs.styles),Ci(),k=rl(k,O,ce,1,j,ue,L,M,ca,jl,J,Vl),Mi())},i(j){if(!N){ve(_.$$.fragment,j);for(let O=0;O<ue.length;O+=1)ve(k[O]);N=!0}},o(j){Pe(_.$$.fragment,j);for(let O=0;O<k.length;O+=1)Pe(k[O]);N=!1},d(j){j&&(G(t),G(v),G(M)),Ke(_);for(let O=0;O<k.length;O+=1)k[O].d();Q=!1,ct(x)}}}function vd(e){let t;return{c(){t=c("h2"),t.textContent="Properties",m(t,"slot","header")},m(n,s){B(n,t,s)},p:Ot,d(n){n&&G(t)}}}function kd(e){let t,n,s,i;function l(u){e[7](u)}function r(u){e[8](u)}let h={$$slots:{header:[vd],default:[Sd]},$$scope:{ctx:e}};return e[0]!==void 0&&(h.frontend=e[0]),e[1]!==void 0&&(h.show=e[1]),t=new Ti({props:h}),he.push(()=>dt(t,"frontend",l)),he.push(()=>dt(t,"show",r)),{c(){Qe(t.$$.fragment)},m(u,d){Be(t,u,d),i=!0},p(u,[d]){const f={};d&4097&&(f.$$scope={dirty:d,ctx:u}),!n&&d&1&&(n=!0,f.frontend=u[0],ut(()=>n=!1)),!s&&d&2&&(s=!0,f.show=u[1],ut(()=>s=!1)),t.$set(f)},i(u){i||(ve(t.$$.fragment,u),i=!0)},o(u){Pe(t.$$.fragment,u),i=!1},d(u){Ke(t,u)}}}function Cd(e,t,n){let{frontend:s}=t,{show:i=!1}=t;function l(){s.subs.width=it(this.value),n(0,s),n(1,i)}const r=()=>{var p,w;return(w=(p=s.playback.video)==null?void 0:p.subRenderer)==null?void 0:w.changeResolution()};function h(){s.subs.height=it(this.value),n(0,s),n(1,i)}const u=()=>(n(0,s),n(1,i)),d=()=>{let p=new vn("new");n(0,s.subs.styles=[...s.subs.styles,p],s)};function f(p){s=p,n(0,s),n(1,i)}function g(p){i=p,n(1,i)}return e.$$set=p=>{"frontend"in p&&n(0,s=p.frontend),"show"in p&&n(1,i=p.show)},e.$$.update=()=>{e.$$.dirty&3&&(n(0,s),n(1,i))},[s,i,l,r,h,u,d,f,g]}class Md extends sn{constructor(t){super(),nn(this,t,Cd,kd,At,{frontend:0,show:1})}}function Td(e){let t,n,s,i,l,r;const h=e[11].default,u=Fi(h,e,e[10],null);return{c(){t=b(),n=c("div"),u&&u.c(),m(n,"class",s=Cn(e[2]?"resizerV":"resizerH")+" svelte-ixu9tp"),qt(n,"cursor",e[2]?"ew-resize":"ns-resize")},m(d,f){B(d,t,f),B(d,n,f),u&&u.m(n,null),i=!0,l||(r=[P(document,"mousemove",e[12]),P(document,"mouseup",e[13]),P(n,"mousedown",e[14])],l=!0)},p(d,[f]){u&&u.p&&(!i||f&1024)&&zi(u,h,d,d[10],i?Ii(h,d[10],f,null):Ui(d[10]),null),(!i||f&4&&s!==(s=Cn(d[2]?"resizerV":"resizerH")+" svelte-ixu9tp"))&&m(n,"class",s),(!i||f&4)&&qt(n,"cursor",d[2]?"ew-resize":"ns-resize")},i(d){i||(ve(u,d),i=!0)},o(d){Pe(u,d),i=!1},d(d){d&&(G(t),G(n)),u&&u.d(d),l=!1,ct(r)}}}function Ed(e,t,n){let{$$slots:s={},$$scope:i}=t,{control:l}=t,{control2:r=null}=t,{vertical:h=!1}=t,{reverse:u=!1}=t,{minValue:d=10}=t,f=0,g=0,p=0,w=0,C=!1;const v=y=>{if(C){let k=u?-1:1;if(h){let L=Math.max(p+(y.clientX-f)*k,d);r&&n(1,r.style.width=w+L-p+"px",r),n(0,l.style.width=L+"px",l)}else{let L=Math.max(p+(y.clientY-g)*k,d);r&&n(1,r.style.height=w+L-p+"px",r),n(0,l.style.height=L+"px",l)}}},M=()=>{n(9,C=!1)},_=y=>{n(5,f=y.clientX),n(6,g=y.clientY),n(7,p=h?l.offsetWidth:l.offsetHeight),r&&n(8,w=h?r.offsetWidth:r.offsetHeight),n(9,C=!0)};return e.$$set=y=>{"control"in y&&n(0,l=y.control),"control2"in y&&n(1,r=y.control2),"vertical"in y&&n(2,h=y.vertical),"reverse"in y&&n(3,u=y.reverse),"minValue"in y&&n(4,d=y.minValue),"$$scope"in y&&n(10,i=y.$$scope)},[l,r,h,u,d,f,g,p,w,C,i,s,v,M,_]}class Ni extends sn{constructor(t){super(),nn(this,t,Ed,Td,At,{control:0,control2:1,vertical:2,reverse:3,minValue:4})}}function Pd(e){let t,n,s,i;return{c(){t=c("input"),m(t,"class",n=Cn("timestamp "+(e[1]?"stretch":""))+" svelte-6f2ljh")},m(l,r){B(l,t,r),H(t,e[2]),s||(i=[P(t,"input",e[6]),P(t,"beforeinput",e[7]),P(t,"keydown",e[8]),P(t,"blur",e[9])],s=!0)},p(l,[r]){r&2&&n!==(n=Cn("timestamp "+(l[1]?"stretch":""))+" svelte-6f2ljh")&&m(t,"class",n),r&4&&t.value!==l[2]&&H(t,l[2])},i:Ot,o:Ot,d(l){l&&G(t),s=!1,ct(i)}}}function Od(e,t,n){let{timestamp:s=0}=t,{stretchX:i=!1}=t,l="00:00:00.000",r=!1;function h(v){v!=l&&(n(3,r=!0),n(2,l=v))}const u=ds(),d=()=>u("change",s),f=()=>u("input",s);function g(){l=this.value,n(2,l)}const p=v=>{let M=v.currentTarget.value,_=v.currentTarget.selectionStart??0,y=v.data;y&&(v.preventDefault(),_<M.length&&y.match(/^\d$/)&&((M[_]==":"||M[_]==".")&&_++,v.currentTarget.value=M.slice(0,_)+y+M.slice(_+1),v.currentTarget.selectionStart=_+1,v.currentTarget.selectionEnd=_+1,n(0,s=lt.parseTimestamp(v.currentTarget.value)??0),n(3,r=!0),f()))},w=v=>{let M=v.currentTarget.value,_=v.currentTarget.selectionStart??0;v.key=="Backspace"&&_>0&&((M[_-1]==":"||M[_-1]==".")&&_--,v.currentTarget.value=M.slice(0,_-1)+"0"+M.slice(_),v.currentTarget.selectionStart=_-1,v.currentTarget.selectionEnd=_-1,v.preventDefault(),n(0,s=lt.parseTimestamp(v.currentTarget.value)??0),n(3,r=!0),f())},C=v=>{r&&(n(0,s=lt.parseTimestamp(v.currentTarget.value)??0),d())};return e.$$set=v=>{"timestamp"in v&&n(0,s=v.timestamp),"stretchX"in v&&n(1,i=v.stretchX)},e.$$.update=()=>{if(e.$$.dirty&1){let v=lt.formatTimestamp(s);h(v)}},[s,i,l,r,d,f,g,p,w,C]}class Sn extends sn{constructor(t){super(),nn(this,t,Od,Pd,At,{timestamp:0,stretchX:1})}}function Rd(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce,j,O,pe,be,He,E,ke,ee,Z,I,ie,Oe,fe,et,ne,we,Ce,Ee,le,de,Fe,Y,Xe,rt,me,ft,Ae,Ye,tt,Me,mt,at,Le,ht,oe,xe=lt.formatTimestamp(e[9])+"",pt,yt,Ie,q,Ue,qe,Ve,kt=lt.formatTimestamp(e[10])+"",bt,nt,st,T,ge,je,Te,_e,wt;function jt(re){e[23](re)}let It={};e[2]!==void 0&&(It.timestamp=e[2]),M=new Sn({props:It}),he.push(()=>dt(M,"timestamp",jt)),M.$on("input",e[24]);function Ct(re){e[34](re)}let Lt={};e[3]!==void 0&&(Lt.timestamp=e[3]),Ae=new Sn({props:Lt}),he.push(()=>dt(Ae,"timestamp",Ct)),Ae.$on("input",e[35]);function Gt(re){e[36](re)}let Bt={};e[13]!==void 0&&(Bt.timestamp=e[13]),Ie=new Sn({props:Bt}),he.push(()=>dt(Ie,"timestamp",Gt)),Ie.$on("input",e[37]);function Jt(re){e[38](re)}let Kt={};return e[14]!==void 0&&(Kt.timestamp=e[14]),st=new Sn({props:Kt}),he.push(()=>dt(st,"timestamp",Jt)),st.$on("input",e[39]),st.$on("change",e[40]),je=xs(e[21][0]),Te=xs(e[21][1]),{c(){t=c("form"),n=c("table"),s=c("tr"),i=c("td"),i.textContent="shift times",l=b(),r=c("td"),h=c("input"),u=b(),d=c("label"),d.textContent="forward",f=b(),g=c("input"),p=b(),w=c("label"),w.textContent="backward",C=c("br"),v=Ne(`
        by: `),Qe(M.$$.fragment),y=c("br"),k=b(),L=c("input"),J=b(),U=c("label"),U.textContent="modify everything after this",F=c("br"),R=b(),N=c("tr"),N.innerHTML="<td></td> <td><hr/></td>",Q=b(),x=c("tr"),ue=c("td"),ue.textContent="FPS before:after",ce=b(),j=c("td"),O=c("input"),pe=Ne(`
        :
        `),be=c("input"),He=b(),E=c("tr"),ke=c("td"),ke.textContent="scaling anchor",ee=b(),Z=c("td"),I=c("input"),ie=b(),Oe=c("label"),Oe.textContent="zero time",fe=c("br"),et=b(),ne=c("input"),we=b(),Ce=c("label"),Ce.textContent="start of selection",Ee=c("br"),le=b(),de=c("input"),Fe=b(),Y=c("label"),Y.textContent="end of selection",Xe=c("br"),rt=b(),me=c("input"),ft=b(),Qe(Ae.$$.fragment),tt=b(),Me=c("tr"),Me.innerHTML="<td></td> <td><hr/></td>",mt=b(),at=c("tr"),Le=c("td"),Le.textContent="range",ht=b(),oe=c("td"),pt=Ne(xe),yt=Ne(`
        
        `),Qe(Ie.$$.fragment),Ue=b(),qe=c("br"),Ve=b(),bt=Ne(kt),nt=Ne(`
        
        `),Qe(st.$$.fragment),m(h,"type","radio"),m(h,"id","st1"),h.__value="forward",H(h,h.__value),m(d,"for","st1"),m(g,"type","radio"),m(g,"id","st2"),g.__value="backward",H(g,g.__value),m(w,"for","st2"),m(L,"type","checkbox"),m(L,"id","st"),m(U,"for","st"),m(O,"type","number"),m(O,"class","number svelte-110xmzp"),m(be,"type","number"),m(be,"class","number svelte-110xmzp"),m(I,"type","radio"),m(I,"id","anc0"),I.__value="zero",H(I,I.__value),m(Oe,"for","anc0"),m(ne,"type","radio"),m(ne,"id","anc1"),ne.__value="start",H(ne,ne.__value),m(Ce,"for","anc1"),m(de,"type","radio"),m(de,"id","anc2"),de.__value="end",H(de,de.__value),m(Y,"for","anc2"),m(me,"type","radio"),m(me,"id","anc3"),me.__value="custom",H(me,me.__value),m(n,"class","config"),je.p(I,ne,de,me),Te.p(h,g)},m(re,Re){B(re,t,Re),o(t,n),o(n,s),o(s,i),o(s,l),o(s,r),o(r,h),h.checked=h.__value===e[4],o(r,u),o(r,d),o(r,f),o(r,g),g.checked=g.__value===e[4],o(r,p),o(r,w),o(r,C),o(r,v),Be(M,r,null),o(r,y),o(r,k),o(r,L),L.checked=e[12],o(r,J),o(r,U),o(r,F),o(n,R),o(n,N),o(n,Q),o(n,x),o(x,ue),o(x,ce),o(x,j),o(j,O),H(O,e[6]),o(j,pe),o(j,be),H(be,e[7]),o(n,He),o(n,E),o(E,ke),o(E,ee),o(E,Z),o(Z,I),I.checked=I.__value===e[5],o(Z,ie),o(Z,Oe),o(Z,fe),o(Z,et),o(Z,ne),ne.checked=ne.__value===e[5],o(Z,we),o(Z,Ce),o(Z,Ee),o(Z,le),o(Z,de),de.checked=de.__value===e[5],o(Z,Fe),o(Z,Y),o(Z,Xe),o(Z,rt),o(Z,me),me.checked=me.__value===e[5],o(Z,ft),Be(Ae,Z,null),o(n,tt),o(n,Me),o(n,mt),o(n,at),o(at,Le),o(at,ht),o(at,oe),o(oe,pt),o(oe,yt),Be(Ie,oe,null),o(oe,Ue),o(oe,qe),o(oe,Ve),o(oe,bt),o(oe,nt),Be(st,oe,null),e[41](t),ge=!0,_e||(wt=[P(h,"change",e[20]),P(g,"change",e[22]),P(L,"change",e[25]),P(O,"input",e[26]),P(O,"input",e[27]),P(be,"input",e[28]),P(be,"input",e[29]),P(I,"change",e[30]),P(ne,"change",e[31]),P(de,"change",e[32]),P(me,"change",e[33])],_e=!0)},p(re,Re){Re[0]&16&&(h.checked=h.__value===re[4]),Re[0]&16&&(g.checked=g.__value===re[4]);const St={};!_&&Re[0]&4&&(_=!0,St.timestamp=re[2],ut(()=>_=!1)),M.$set(St),Re[0]&4096&&(L.checked=re[12]),Re[0]&64&&it(O.value)!==re[6]&&H(O,re[6]),Re[0]&128&&it(be.value)!==re[7]&&H(be,re[7]),Re[0]&32&&(I.checked=I.__value===re[5]),Re[0]&32&&(ne.checked=ne.__value===re[5]),Re[0]&32&&(de.checked=de.__value===re[5]),Re[0]&32&&(me.checked=me.__value===re[5]);const Mn={};!Ye&&Re[0]&8&&(Ye=!0,Mn.timestamp=re[3],ut(()=>Ye=!1)),Ae.$set(Mn),(!ge||Re[0]&512)&&xe!==(xe=lt.formatTimestamp(re[9])+"")&&Pt(pt,xe);const ln={};!q&&Re[0]&8192&&(q=!0,ln.timestamp=re[13],ut(()=>q=!1)),Ie.$set(ln),(!ge||Re[0]&1024)&&kt!==(kt=lt.formatTimestamp(re[10])+"")&&Pt(bt,kt);const Rt={};!T&&Re[0]&16384&&(T=!0,Rt.timestamp=re[14],ut(()=>T=!1)),st.$set(Rt)},i(re){ge||(ve(M.$$.fragment,re),ve(Ae.$$.fragment,re),ve(Ie.$$.fragment,re),ve(st.$$.fragment,re),ge=!0)},o(re){Pe(M.$$.fragment,re),Pe(Ae.$$.fragment,re),Pe(Ie.$$.fragment,re),Pe(st.$$.fragment,re),ge=!1},d(re){re&&G(t),Ke(M),Ke(Ae),Ke(Ie),Ke(st),e[41](null),je.r(),Te.r(),_e=!1,ct(wt)}}}function Ad(e){let t,n,s,i;function l(u){e[42](u)}function r(u){e[43](u)}let h={$$slots:{default:[Rd]},$$scope:{ctx:e}};return e[1]!==void 0&&(h.frontend=e[1]),e[0]!==void 0&&(h.show=e[0]),t=new Ti({props:h}),he.push(()=>dt(t,"frontend",l)),he.push(()=>dt(t,"show",r)),t.$on("submit",e[44]),{c(){Qe(t.$$.fragment)},m(u,d){Be(t,u,d),i=!0},p(u,d){const f={};d[0]&32508|d[1]&131072&&(f.$$scope={dirty:d,ctx:u}),!n&&d[0]&2&&(n=!0,f.frontend=u[1],ut(()=>n=!1)),!s&&d[0]&1&&(s=!0,f.show=u[0],ut(()=>s=!1)),t.$set(f)},i(u){i||(ve(t.$$.fragment,u),i=!0)},o(u){Pe(t.$$.fragment,u),i=!1},d(u){Ke(t,u)}}}function Ld(e,t,n){let{frontend:s}=t,{show:i=!1}=t,l,r=0,h=0,u=!1,d="forward",f="zero",g=1,p=1,w,C;const v=ds(),M=Y=>v("submit",Y);let _,y,k,L,J,U;function F(){U=s.getSelection(),n(9,L=Math.min(...U.map(Y=>Y.start))),n(10,J=Math.max(...U.map(Y=>Y.end))),R()}function R(){setTimeout(()=>{n(13,w=Math.max(0,(L-k)*y+k+_)),n(14,C=Math.max(0,(J-k)*y+k+_))},0)}function N(){let Y=(C-w)/(J-L);(!isFinite(Y)||Y<0)&&(Y=1),n(6,g=1),n(7,p=Y),n(8,y=Y),n(15,_=w-k-(L-k)*Y),n(4,d=_<0?"backward":"forward"),n(2,r=Math.abs(_))}const Q=[[],[]];function x(){d=this.__value,n(4,d)}function ue(){d=this.__value,n(4,d)}function ce(Y){r=Y,n(2,r)}const j=Y=>N();function O(){u=this.checked,n(12,u)}function pe(){g=it(this.value),n(6,g)}const be=()=>R();function He(){p=it(this.value),n(7,p)}const E=()=>R();function ke(){f=this.__value,n(5,f)}function ee(){f=this.__value,n(5,f)}function Z(){f=this.__value,n(5,f)}function I(){f=this.__value,n(5,f)}function ie(Y){h=Y,n(3,h)}const Oe=()=>R();function fe(Y){w=Y,n(13,w)}const et=Y=>N();function ne(Y){C=Y,n(14,C)}const we=Y=>N(),Ce=()=>n(7,p);function Ee(Y){he[Y?"unshift":"push"](()=>{l=Y,n(11,l)})}function le(Y){s=Y,n(1,s)}function de(Y){i=Y,n(0,i)}const Fe=()=>{M({selection:s.getSelection(),offset:k+_-k*y,modifySince:u,scale:y})};return e.$$set=Y=>{"frontend"in Y&&n(1,s=Y.frontend),"show"in Y&&n(0,i=Y.show)},e.$$.update=()=>{e.$$.dirty[0]&1&&F(),e.$$.dirty[0]&16&&R(),e.$$.dirty[0]&32&&R(),e.$$.dirty[0]&20&&n(15,_=r*(d=="forward"?1:-1)),e.$$.dirty[0]&448&&(n(8,y=p/g),(!isFinite(y)||isNaN(y)||y<0)&&n(8,y=1)),e.$$.dirty[0]&1576&&(n(16,k=0),f=="start"&&n(16,k=L),f=="end"&&n(16,k=J),f=="custom"&&n(16,k=h))},[i,s,r,h,d,f,g,p,y,L,J,l,u,w,C,_,k,M,R,N,x,Q,ue,ce,j,O,pe,be,He,E,ke,ee,Z,I,ie,Oe,fe,et,ne,we,Ce,Ee,le,de,Fe]}class Dd extends sn{constructor(t){super(),nn(this,t,Ld,Ad,At,{frontend:1,show:0},null,[-1,-1])}}function Wd(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce,j,O,pe,be,He,E,ke,ee,Z,I,ie,Oe,fe,et,ne,we,Ce,Ee,le,de,Fe,Y,Xe,rt,me,ft,Ae,Ye,tt,Me,mt,at,Le;function ht(q){e[19](q)}function oe(q){e[20](q)}let xe={};e[0].subs!==void 0&&(xe.subtitles=e[0].subs),e[9]!==void 0&&(xe.currentStyle=e[9]),ee=new si({props:xe}),he.push(()=>dt(ee,"subtitles",ht)),he.push(()=>dt(ee,"currentStyle",oe));function pt(q){e[22](q)}function yt(q){e[23](q)}let Ie={};return e[0].subs!==void 0&&(Ie.subtitles=e[0].subs),e[10]!==void 0&&(Ie.currentStyle=e[10]),Ce=new si({props:Ie}),he.push(()=>dt(Ce,"subtitles",pt)),he.push(()=>dt(Ce,"currentStyle",yt)),{c(){t=c("table"),n=c("tr"),s=c("td"),s.innerHTML='<label for="expr">expression:</label>',i=b(),l=c("td"),r=c("input"),h=b(),u=c("tr"),d=c("td"),d.innerHTML='<label for="repl">replace by:</label>',f=b(),g=c("td"),p=c("input"),w=b(),C=c("tr"),v=c("td"),M=b(),_=c("td"),y=c("input"),k=b(),L=c("label"),L.textContent="use regular expressions",J=c("br"),U=b(),F=c("input"),R=b(),N=c("label"),N.textContent="case sensitive",Q=c("br"),x=b(),ue=c("input"),ce=b(),j=c("label"),j.textContent="selected entries only",O=c("br"),pe=b(),be=c("input"),He=b(),E=c("label"),E.textContent="search in style",ke=b(),Qe(ee.$$.fragment),ie=c("br"),Oe=b(),fe=c("input"),et=b(),ne=c("label"),ne.textContent="replace by style",we=b(),Qe(Ce.$$.fragment),de=c("br"),Fe=b(),Y=c("tr"),Xe=c("td"),rt=c("button"),rt.textContent="find next",me=b(),ft=c("button"),ft.textContent="select all",Ae=b(),Ye=c("button"),Ye.textContent="replace next",tt=b(),Me=c("button"),Me.textContent="replace all",m(s,"class","right svelte-1rt6tcb"),m(r,"class","expr svelte-1rt6tcb"),m(r,"id","expr"),m(d,"class","right svelte-1rt6tcb"),m(p,"class","expr svelte-1rt6tcb"),m(p,"id","repl"),m(y,"type","checkbox"),m(y,"id","reg"),m(L,"for","reg"),m(F,"type","checkbox"),m(F,"id","case"),m(N,"for","case"),m(ue,"type","checkbox"),m(ue,"id","sel"),m(j,"for","sel"),m(be,"type","checkbox"),m(be,"id","style1"),m(E,"for","style1"),m(fe,"type","checkbox"),m(fe,"id","style2"),m(ne,"for","style2"),m(Xe,"colspan","2"),m(t,"class","config")},m(q,Ue){B(q,t,Ue),o(t,n),o(n,s),o(n,i),o(n,l),o(l,r),H(r,e[2]),o(t,h),o(t,u),o(u,d),o(u,f),o(u,g),o(g,p),H(p,e[3]),o(t,w),o(t,C),o(C,v),o(C,M),o(C,_),o(_,y),y.checked=e[4],o(_,k),o(_,L),o(_,J),o(_,U),o(_,F),F.checked=e[5],o(_,R),o(_,N),o(_,Q),o(_,x),o(_,ue),ue.checked=e[6],o(_,ce),o(_,j),o(_,O),o(_,pe),o(_,be),be.checked=e[7],o(_,He),o(_,E),o(_,ke),Be(ee,_,null),o(_,ie),o(_,Oe),o(_,fe),fe.checked=e[8],o(_,et),o(_,ne),o(_,we),Be(Ce,_,null),o(_,de),o(t,Fe),o(t,Y),o(Y,Xe),o(Xe,rt),o(Xe,me),o(Xe,ft),o(Xe,Ae),o(Xe,Ye),o(Xe,tt),o(Xe,Me),mt=!0,at||(Le=[P(r,"input",e[13]),P(p,"input",e[14]),P(y,"change",e[15]),P(F,"change",e[16]),P(ue,"change",e[17]),P(be,"change",e[18]),P(fe,"change",e[21]),P(rt,"click",e[24]),P(ft,"click",e[25]),P(Ye,"click",e[26]),P(Me,"click",e[27])],at=!0)},p(q,Ue){Ue[0]&4&&r.value!==q[2]&&H(r,q[2]),Ue[0]&8&&p.value!==q[3]&&H(p,q[3]),Ue[0]&16&&(y.checked=q[4]),Ue[0]&32&&(F.checked=q[5]),Ue[0]&64&&(ue.checked=q[6]),Ue[0]&128&&(be.checked=q[7]);const qe={};!Z&&Ue[0]&1&&(Z=!0,qe.subtitles=q[0].subs,ut(()=>Z=!1)),!I&&Ue[0]&512&&(I=!0,qe.currentStyle=q[9],ut(()=>I=!1)),ee.$set(qe),Ue[0]&256&&(fe.checked=q[8]);const Ve={};!Ee&&Ue[0]&1&&(Ee=!0,Ve.subtitles=q[0].subs,ut(()=>Ee=!1)),!le&&Ue[0]&1024&&(le=!0,Ve.currentStyle=q[10],ut(()=>le=!1)),Ce.$set(Ve)},i(q){mt||(ve(ee.$$.fragment,q),ve(Ce.$$.fragment,q),mt=!0)},o(q){Pe(ee.$$.fragment,q),Pe(Ce.$$.fragment,q),mt=!1},d(q){q&&G(t),Ke(ee),Ke(Ce),at=!1,ct(Le)}}}function Nd(e){let t;return{c(){t=c("h2"),t.textContent="Search",m(t,"slot","header")},m(n,s){B(n,t,s)},p:Ot,d(n){n&&G(t)}}}function Fd(e){let t,n,s,i;function l(u){e[28](u)}function r(u){e[29](u)}let h={modal:!1,centerWhenOpen:!1,$$slots:{header:[Nd],default:[Wd]},$$scope:{ctx:e}};return e[0]!==void 0&&(h.frontend=e[0]),e[1]!==void 0&&(h.show=e[1]),t=new Ti({props:h}),he.push(()=>dt(t,"frontend",l)),he.push(()=>dt(t,"show",r)),{c(){Qe(t.$$.fragment)},m(u,d){Be(t,u,d),i=!0},p(u,d){const f={};d[0]&2045|d[1]&2&&(f.$$scope={dirty:d,ctx:u}),!n&&d[0]&1&&(n=!0,f.frontend=u[0],ut(()=>n=!1)),!s&&d[0]&2&&(s=!0,f.show=u[1],ut(()=>s=!1)),t.$set(f)},i(u){i||(ve(t.$$.fragment,u),i=!0)},o(u){Pe(t.$$.fragment,u),i=!1},d(u){Ke(t,u)}}}function Id(e,t,n){let{frontend:s}=t,{show:i=!1}=t,l="",r="",h=!1,u=!0,d=!1,f=!1,g=!1,p=s.subs.defaultStyle,w=s.subs.defaultStyle,C=null,v=0;var M=(E=>(E[E.Find=0]="Find",E[E.Select=1]="Select",E[E.Replace=2]="Replace",E))(M||{});function _(E,ke){let ee=s.subs.entries;if(ee.length==0)return;let Z=s.getSelection(),I=new Set(Z),ie=C??ee[0];d&&(ie=Z.at(0)??ie);let Oe=new RegExp(h?l:Vt.escapeRegexp(l),`g${u?"":"i"}`);(E==1||!d)&&s.clearSelection(Se.Action);let fe=0,et=E==2?r:"";e:for(let ne=ee.indexOf(ie);ne<ee.length;ne++){let we=ee[ne];if(!(d&&!I.has(we)))for(let Ce=we==C?v+1:0;Ce<we.texts.length;Ce++){let Ee=we.texts[Ce];if(f&&Ee.style!==p)continue;let le=Ee.text.replace(Oe,et);if(le!=Ee.text&&(console.log(Ce,v,we,C),fe++,E==1?s.selection.submitted.add(we):E==2&&(Ee.text=le,g&&(Ee.style=w)),ke)){C=we,v=Ce,s.selectEntry(we,!1,!0,Se.Action),n(0,s.current.style=Ee.style,s);break e}}}fe>0?(E==1?(n(0,s.status=`selected ${fe} line${fe>1?"s":""}`,s),s.onSelectionChanged.dispatch(Se.Action)):E==2?n(0,s.status=`replaced ${fe} lines${fe>1?"s":""}`,s):n(0,s.status=`found ${fe} line${fe>1?"s":""}; ${C==null?void 0:C.start}, ${v}`,s),s.markChanged(Ge.NonTime,Se.Action)):(n(0,s.status="found nothing",s),C=null,v=0,ke&&(n(0,s.current.entry=null,s),s.onSelectionChanged.dispatch(Se.Action)))}function y(){l=this.value,n(2,l)}function k(){r=this.value,n(3,r)}function L(){h=this.checked,n(4,h)}function J(){u=this.checked,n(5,u)}function U(){d=this.checked,n(6,d)}function F(){f=this.checked,n(7,f)}function R(E){e.$$.not_equal(s.subs,E)&&(s.subs=E,n(0,s))}function N(E){p=E,n(9,p)}function Q(){g=this.checked,n(8,g)}function x(E){e.$$.not_equal(s.subs,E)&&(s.subs=E,n(0,s))}function ue(E){w=E,n(10,w)}const ce=()=>_(M.Find,!0),j=()=>_(M.Select,!1),O=()=>_(M.Replace,!0),pe=()=>_(M.Replace,!1);function be(E){s=E,n(0,s)}function He(E){i=E,n(1,i)}return e.$$set=E=>{"frontend"in E&&n(0,s=E.frontend),"show"in E&&n(1,i=E.show)},[s,i,l,r,h,u,d,f,g,p,w,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce,j,O,pe,be,He]}class zd extends sn{constructor(t){super(),nn(this,t,Id,Fd,At,{frontend:0,show:1},null,[-1,-1])}}var as,os,Qs;class Gl{constructor(t,n){A(this,os);te(this,"cxt");A(this,as,new Set);this.canvas=t;let s=t.getContext("2d");ze(s!==null),this.cxt=s,V(this,os,Qs).call(this),new ResizeObserver(()=>V(this,os,Qs).call(this)).observe(n)}bind(t){a(this,as).add(t),V(this,os,Qs).call(this)}unbind(t){a(this,as).delete(t)}}as=new WeakMap,os=new WeakSet,Qs=function(){let t=window.devicePixelRatio,n=this.canvas.clientWidth,s=this.canvas.clientHeight;this.canvas.width=Math.floor(n*t),this.canvas.height=Math.floor(s*t),a(this,as).forEach(i=>i.setDisplaySize(n,s,n*t,s*t))};const{document:Ud}=ia;function Bl(e,t,n){const s=e.slice();return s[74]=t[n],s[76]=n,s}function Kl(e,t,n){const s=e.slice();return s[77]=t[n],s[79]=n,s}function Xl(e,t,n){const s=e.slice();return s[77]=t[n],s[80]=t,s[76]=n,s}function Yl(e){let t,n,s,i,l,r,h,u,d,f,g;return{c(){t=c("li"),n=c("button"),s=Ne("undo"),l=b(),r=c("li"),h=c("button"),u=Ne("redo"),n.disabled=i=e[2].undoStack.length<=1,h.disabled=d=e[2].redoStack.length==0},m(p,w){B(p,t,w),o(t,n),o(n,s),B(p,l,w),B(p,r,w),o(r,h),o(h,u),f||(g=[P(n,"click",e[32]),P(h,"click",e[33])],f=!0)},p(p,w){w[0]&4&&i!==(i=p[2].undoStack.length<=1)&&(n.disabled=i),w[0]&4&&d!==(d=p[2].redoStack.length==0)&&(h.disabled=d)},d(p){p&&(G(t),G(l),G(r)),f=!1,ct(g)}}}function Hd(e){let t,n=e[2].states.virtualEntryHighlighted?"double-click or press enter to append new entry":"select a line to start editing",s;return{c(){t=c("i"),s=Ne(n)},m(i,l){B(i,t,l),o(t,s)},p(i,l){l[0]&4&&n!==(n=i[2].states.virtualEntryHighlighted?"double-click or press enter to append new entry":"select a line to start editing")&&Pt(s,n)},i:Ot,o:Ot,d(i){i&&G(t)}}}function qd(e){let t,n,s=tn(e[2].current.entry.texts),i=[];for(let r=0;r<s.length;r+=1)i[r]=Jl(Xl(e,s,r));const l=r=>Pe(i[r],1,1,()=>{i[r]=null});return{c(){t=c("table");for(let r=0;r<i.length;r+=1)i[r].c();m(t,"class","fields")},m(r,h){B(r,t,h);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(t,null);n=!0},p(r,h){if(h[0]&4){s=tn(r[2].current.entry.texts);let u;for(u=0;u<s.length;u+=1){const d=Xl(r,s,u);i[u]?(i[u].p(d,h),ve(i[u],1)):(i[u]=Jl(d),i[u].c(),ve(i[u],1),i[u].m(t,null))}for(Ci(),u=s.length;u<i.length;u+=1)l(u);Mi()}},i(r){if(!n){for(let h=0;h<s.length;h+=1)ve(i[h]);n=!0}},o(r){i=i.filter(Boolean);for(let h=0;h<i.length;h+=1)Pe(i[h]);n=!1},d(r){r&&G(t),ar(i,r)}}}function Jl(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y;function k(N){e[49](N,e[77])}let L={subtitles:e[2].subs};e[77].style!==void 0&&(L.currentStyle=e[77].style),s=new si({props:L}),he.push(()=>dt(s,"currentStyle",k)),s.$on("submit",e[50]);function J(){return e[51](e[76])}function U(){return e[52](e[76])}function F(){e[53].call(w,e[80],e[76])}function R(){return e[54](e[77])}return{c(){t=c("tr"),n=c("td"),Qe(s.$$.fragment),l=b(),r=c("button"),r.textContent="+",h=b(),u=c("button"),d=Ne("-"),g=b(),p=c("td"),w=c("textarea"),v=b(),m(r,"tabindex","-1"),m(u,"tabindex","-1"),u.disabled=f=e[2].current.entry.texts.length==1,m(w,"class","contentarea"),m(w,"tabindex","0"),qt(p,"width","100%")},m(N,Q){B(N,t,Q),o(t,n),Be(s,n,null),o(n,l),o(n,r),o(n,h),o(n,u),o(u,d),o(t,g),o(t,p),o(p,w),H(w,e[77].text),o(t,v),M=!0,_||(y=[P(r,"click",J),P(u,"click",U),P(w,"input",F),rr(C=e[19].call(null,w,e[77])),P(w,"focus",R),P(w,"blur",e[55]),P(w,"input",e[56]),P(w,"change",Gd)],_=!0)},p(N,Q){e=N;const x={};Q[0]&4&&(x.subtitles=e[2].subs),!i&&Q[0]&4&&(i=!0,x.currentStyle=e[77].style,ut(()=>i=!1)),s.$set(x),(!M||Q[0]&4&&f!==(f=e[2].current.entry.texts.length==1))&&(u.disabled=f),Q[0]&4&&H(w,e[77].text),C&&qs(C.update)&&Q[0]&4&&C.update.call(null,e[77])},i(N){M||(ve(s.$$.fragment,N),M=!0)},o(N){Pe(s.$$.fragment,N),M=!1},d(N){N&&G(t),Ke(s),_=!1,ct(y)}}}function Zl(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y,k,L,J,U,F,R,N,Q,x,ue,ce;function j(I){e[40](I)}let O={stretchX:!0};e[15]!==void 0&&(O.timestamp=e[15]),w=new Sn({props:O}),he.push(()=>dt(w,"timestamp",j)),w.$on("input",e[41]),w.$on("change",e[42]);function pe(I){e[43](I)}let be={stretchX:!0};e[16]!==void 0&&(be.timestamp=e[16]),_=new Sn({props:be}),he.push(()=>dt(_,"timestamp",pe)),_.$on("input",e[44]),_.$on("change",e[45]);function He(I){e[46](I)}let E={stretchX:!0};e[17]!==void 0&&(E.timestamp=e[17]),J=new Sn({props:E}),he.push(()=>dt(J,"timestamp",He)),J.$on("input",e[47]),J.$on("change",e[48]);const ke=[qd,Hd],ee=[];function Z(I,ie){return I[2].current.entry!==null?0:1}return N=Z(e),Q=ee[N]=ke[N](e),{c(){t=c("td"),n=c("div"),s=c("select"),i=c("option"),i.textContent="anchor start",l=c("option"),l.textContent="anchor end",r=b(),h=c("span"),u=c("input"),d=b(),f=c("label"),f.textContent="keep duration",g=b(),p=c("div"),Qe(w.$$.fragment),v=b(),M=c("div"),Qe(_.$$.fragment),k=b(),L=c("div"),Qe(J.$$.fragment),F=b(),R=c("td"),Q.c(),i.__value="anchor start",H(i,i.__value),l.__value="anchor end",H(l,l.__value),m(s,"class","anchor-select"),m(u,"type","checkbox"),m(u,"id","keepd"),m(f,"for","keepd"),m(p,"class","svelte-1t7lduw"),m(M,"class","svelte-1t7lduw"),m(L,"class","svelte-1t7lduw"),m(n,"class","svelte-1t7lduw"),m(t,"class","times svelte-1t7lduw"),m(R,"class","scroll svelte-1t7lduw")},m(I,ie){B(I,t,ie),o(t,n),o(n,s),o(s,i),o(s,l),o(n,r),o(n,h),o(h,u),u.checked=e[14],o(h,d),o(h,f),o(n,g),o(n,p),Be(w,p,null),o(n,v),o(n,M),Be(_,M,null),o(n,k),o(n,L),Be(J,L,null),B(I,F,ie),B(I,R,ie),ee[N].m(R,null),x=!0,ue||(ce=[P(s,"input",e[38]),P(u,"change",e[39])],ue=!0)},p(I,ie){ie[0]&16384&&(u.checked=I[14]);const Oe={};!C&&ie[0]&32768&&(C=!0,Oe.timestamp=I[15],ut(()=>C=!1)),w.$set(Oe);const fe={};!y&&ie[0]&65536&&(y=!0,fe.timestamp=I[16],ut(()=>y=!1)),_.$set(fe);const et={};!U&&ie[0]&131072&&(U=!0,et.timestamp=I[17],ut(()=>U=!1)),J.$set(et);let ne=N;N=Z(I),N===ne?ee[N].p(I,ie):(Ci(),Pe(ee[ne],1,1,()=>{ee[ne]=null}),Mi(),Q=ee[N],Q?Q.p(I,ie):(Q=ee[N]=ke[N](I),Q.c()),ve(Q,1),Q.m(R,null))},i(I){x||(ve(w.$$.fragment,I),ve(_.$$.fragment,I),ve(J.$$.fragment,I),ve(Q),x=!0)},o(I){Pe(w.$$.fragment,I),Pe(_.$$.fragment,I),Pe(J.$$.fragment,I),Pe(Q),x=!1},d(I){I&&(G(t),G(F),G(R)),Ke(w),Ke(_),Ke(J),ee[N].d(),ue=!1,ct(ce)}}}function Ql(e){let t,n=e[76]+"",s,i,l,r,h,u=lt.formatTimestamp(e[74].start)+"",d,f,g,p,w=lt.formatTimestamp(e[74].end)+"",C,v,M,_;return{c(){t=c("td"),s=Ne(n),r=b(),h=c("td"),d=Ne(u),g=b(),p=c("td"),C=Ne(w),m(t,"rowspan",i=e[74].texts.length),m(h,"rowspan",f=e[74].texts.length),m(p,"rowspan",v=e[74].texts.length)},m(y,k){B(y,t,k),o(t,s),B(y,r,k),B(y,h,k),o(h,d),B(y,g,k),B(y,p,k),o(p,C),M||(_=rr(l=jd.call(null,t,e[74])),M=!0)},p(y,k){e=y,k[0]&4&&n!==(n=e[76]+"")&&Pt(s,n),k[0]&4&&i!==(i=e[74].texts.length)&&m(t,"rowspan",i),l&&qs(l.update)&&k[0]&4&&l.update.call(null,e[74]),k[0]&4&&u!==(u=lt.formatTimestamp(e[74].start)+"")&&Pt(d,u),k[0]&4&&f!==(f=e[74].texts.length)&&m(h,"rowspan",f),k[0]&4&&w!==(w=lt.formatTimestamp(e[74].end)+"")&&Pt(C,w),k[0]&4&&v!==(v=e[74].texts.length)&&m(p,"rowspan",v)},d(y){y&&(G(t),G(r),G(h),G(g),G(p)),M=!1,_()}}}function xl(e,t){let n,s,i,l=t[77].style.name+"",r,h,u,d=k()+"",f,g,p,w=t[77].text+"",C,v,M,_,y=t[77]===t[74].texts[0]&&Ql(t);function k(){return t[64](t[77],t[74])}function L(...F){return t[65](t[74],...F)}function J(){return t[67](t[74])}function U(...F){return t[68](t[74],...F)}return{key:e,first:null,c(){n=c("tr"),y&&y.c(),s=b(),i=c("td"),r=Ne(l),h=b(),u=c("td"),f=Ne(d),g=b(),p=c("td"),C=Ne(w),v=b(),m(p,"class","subtext"),Vn(n,"focushlt",t[2].current.entry==t[74]),Vn(n,"sametime",t[2].current.entry!=t[74]&&sr(t[2].current.entry,t[74])),Vn(n,"selected",t[4].has(t[74])),this.first=n},m(F,R){B(F,n,R),y&&y.m(n,null),o(n,s),o(n,i),o(i,r),o(n,h),o(n,u),o(u,f),o(n,g),o(n,p),o(p,C),o(n,v),M||(_=[P(n,"mousedown",L),P(n,"contextmenu",t[66]),P(n,"dblclick",J),P(n,"mousemove",U)],M=!0)},p(F,R){t=F,t[77]===t[74].texts[0]?y?y.p(t,R):(y=Ql(t),y.c(),y.m(n,s)):y&&(y.d(1),y=null),R[0]&4&&l!==(l=t[77].style.name+"")&&Pt(r,l),R[0]&4&&d!==(d=k()+"")&&Pt(f,d),R[0]&4&&w!==(w=t[77].text+"")&&Pt(C,w),R[0]&4&&Vn(n,"focushlt",t[2].current.entry==t[74]),R[0]&4&&Vn(n,"sametime",t[2].current.entry!=t[74]&&sr(t[2].current.entry,t[74])),R[0]&20&&Vn(n,"selected",t[4].has(t[74]))},d(F){F&&G(n),y&&y.d(),M=!1,ct(_)}}}function $l(e,t){let n,s=[],i=new Map,l,r=tn(t[74].texts);const h=u=>`${u[76]},${u[79]}`;for(let u=0;u<r.length;u+=1){let d=Kl(t,r,u),f=h(d);i.set(f,s[u]=xl(f,d))}return{key:e,first:null,c(){n=ws();for(let u=0;u<s.length;u+=1)s[u].c();l=ws(),this.first=n},m(u,d){B(u,n,d);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(u,d);B(u,l,d)},p(u,d){t=u,d[0]&20&&(r=tn(t[74].texts),s=rl(s,d,h,1,t,r,i,l.parentNode,or,xl,l,Kl))},d(u){u&&(G(n),G(l));for(let d=0;d<s.length;d+=1)s[d].d(u)}}}function er(e){let t,n,s,i,l,r,h;return{c(){t=c("tr"),n=c("td"),n.textContent="",s=b(),i=c("td"),m(i,"colspan","5"),m(t,"class",l=e[2].states.virtualEntryHighlighted?"focushlt":"")},m(u,d){B(u,t,d),o(t,n),o(t,s),o(t,i),r||(h=[P(t,"dblclick",e[69]),P(t,"mousedown",e[70])],r=!0)},p(u,d){d[0]&4&&l!==(l=u[2].states.virtualEntryHighlighted?"focushlt":"")&&m(t,"class",l)},d(u){u&&G(t),r=!1,ct(h)}}}function tr(e){let t,n=e[2].status+"",s;return{c(){t=c("p"),s=Ne(n),m(t,"class","status")},m(i,l){B(i,t,l),o(t,s)},p(i,l){l[0]&4&&n!==(n=i[2].status+"")&&Pt(s,n)},d(i){i&&G(t)}}}function Vd(e){let t,n,s,i,l,r,h,u,d,f,g,p,w,C,v,M,_,y,k,L,J,U,F,R,N,Q=e[11],x,ue,ce,j,O,pe,be,He,E,ke,ee,Z=(e[2].currentFile?Vt.getFilename(e[2].currentFile):"<untitled>")+"",I,ie,Oe=e[2].fileChanged?"*":"",fe,et,ne,we,Ce,Ee,le,de,Fe,Y,Xe=e[10],rt,me,ft,Ae,Ye,tt,Me,mt,at,Le,ht,oe,xe,pt,yt,Ie,q,Ue,qe,Ve=[],kt=new Map,bt,nt,st,T,ge,je,Te,_e,wt,jt,It=e[12],Ct,Lt,Gt,Bt={frontend:e[2]};n=new Dd({props:Bt}),e[24](n);let Jt={frontend:e[2]};i=new Md({props:Jt}),e[25](i);let Kt={frontend:e[2]};r=new yd({props:Kt}),e[26](r);let re={frontend:e[2]};u=new zd({props:re}),e[27](u);let Re=Yl(e);Fe=new Ni({props:{vertical:!0,minValue:100,control:e[5]}});let St=Zl(e);Ae=new Ni({props:{control:e[2].ui.editTable,control2:e[5],minValue:100}});function Mn(D){e[61](D)}let ln={};e[9]!==void 0&&(ln.timestamp=e[9]),oe=new Sn({props:ln}),he.push(()=>dt(oe,"timestamp",Mn)),oe.$on("change",e[62]);let Rt=tn(e[2].subs.entries);const zn=D=>D[74].uniqueID;for(let D=0;D<Rt.length;D+=1){let se=Bl(e,Rt,D),Dt=zn(se);kt.set(Dt,Ve[D]=$l(Dt,se))}let Mt=!e[2].states.isEditingVirtualEntry&&er(e);je=new Ni({props:{control:e[1],reverse:!0}});let vt=tr(e);return{c(){t=b(),Qe(n.$$.fragment),s=b(),Qe(i.$$.fragment),l=b(),Qe(r.$$.fragment),h=b(),Qe(u.$$.fragment),d=b(),f=c("main"),g=c("ul"),p=c("li"),w=c("button"),w.textContent="open",C=b(),v=c("li"),M=c("button"),M.textContent="save as",_=b(),y=c("li"),k=c("button"),k.textContent="import",L=b(),J=c("li"),U=c("button"),U.textContent="export",F=b(),R=c("li"),N=b(),Re.c(),x=b(),ue=c("li"),ce=b(),j=c("li"),O=c("button"),O.textContent="open video",pe=b(),be=c("li"),He=c("button"),He.textContent="manage styles",E=b(),ke=c("li"),ee=c("div"),I=Ne(Z),ie=b(),fe=Ne(Oe),et=b(),ne=c("table"),we=c("tr"),Ce=c("td"),Ee=c("canvas"),le=b(),de=c("td"),Qe(Fe.$$.fragment),Y=b(),St.c(),rt=b(),me=c("tfoot"),ft=c("td"),Qe(Ae.$$.fragment),Ye=b(),tt=c("div"),Me=c("button"),mt=Ne(e[6]),at=b(),Le=c("input"),ht=b(),Qe(oe.$$.fragment),pt=b(),yt=c("div"),Ie=c("table"),q=c("thead"),q.innerHTML='<tr><th scope="col">#</th> <th scope="col">start</th> <th scope="col">end</th> <th scope="col">style</th> <th scope="col">n/s</th> <th scope="col">text</th></tr>',Ue=b(),qe=c("tbody");for(let D=0;D<Ve.length;D+=1)Ve[D].c();bt=b(),Mt&&Mt.c(),nt=ws(),st=b(),T=c("table"),ge=c("tr"),Qe(je.$$.fragment),Te=b(),_e=c("tr"),wt=c("canvas"),jt=b(),vt.c(),m(R,"class","separator"),m(ue,"class","separator"),m(ee,"class","label"),m(g,"class","menu"),m(Ee,"width","0"),m(Ee,"height","0"),m(Ee,"class","svelte-1t7lduw"),m(Ce,"class","player-container svelte-1t7lduw"),qt(de,"width","2px"),m(ft,"colspan","4"),m(ne,"class","edit"),m(Me,"class","svelte-1t7lduw"),m(Le,"type","range"),m(Le,"class","play-pointer"),qt(Le,"width","100%"),m(Le,"step","any"),m(Le,"max","1"),m(Le,"min","0"),Le.disabled=e[7],m(tt,"class","controls-container svelte-1t7lduw"),m(Ie,"class","subs"),m(yt,"class","subscontainer"),m(wt,"class","timeline svelte-1t7lduw"),m(f,"class","container")},m(D,se){B(D,t,se),Be(n,D,se),B(D,s,se),Be(i,D,se),B(D,l,se),Be(r,D,se),B(D,h,se),Be(u,D,se),B(D,d,se),B(D,f,se),o(f,g),o(g,p),o(p,w),o(g,C),o(g,v),o(v,M),o(g,_),o(g,y),o(y,k),o(g,L),o(g,J),o(J,U),o(g,F),o(g,R),o(g,N),Re.m(g,null),o(g,x),o(g,ue),o(g,ce),o(g,j),o(j,O),o(g,pe),o(g,be),o(be,He),o(g,E),o(g,ke),o(ke,ee),o(ee,I),o(ee,ie),o(ee,fe),o(f,et),o(f,ne),o(ne,we),o(we,Ce),o(Ce,Ee),e[36](Ee),e[37](Ce),o(we,le),o(we,de),Be(Fe,de,null),o(we,Y),St.m(we,null),o(ne,rt),o(ne,me),o(me,ft),Be(Ae,ft,null),e[57](ne),o(f,Ye),o(f,tt),o(tt,Me),o(Me,mt),o(tt,at),o(tt,Le),H(Le,e[8]),o(tt,ht),Be(oe,tt,null),o(f,pt),o(f,yt),o(yt,Ie),o(Ie,q),e[63](q),o(Ie,Ue),o(Ie,qe);for(let Dt=0;Dt<Ve.length;Dt+=1)Ve[Dt]&&Ve[Dt].m(qe,null);o(qe,bt),Mt&&Mt.m(qe,null),o(qe,nt),e[71](yt),o(f,st),o(f,T),o(T,ge),Be(je,ge,null),o(T,Te),o(T,_e),o(_e,wt),e[72](wt),o(f,jt),vt.m(f,null),Ct=!0,Lt||(Gt=[P(window,"beforeunload",e[22]),P(Ud,"keydown",e[23]),P(w,"click",e[28]),P(M,"click",e[29]),P(k,"click",e[30]),P(U,"click",e[31]),P(O,"click",e[34]),P(He,"click",e[35]),P(Me,"click",e[58]),P(Le,"change",e[59]),P(Le,"input",e[59]),P(Le,"input",e[60])],Lt=!0)},p(D,se){const Dt={};se[0]&4&&(Dt.frontend=D[2]),n.$set(Dt);const Un={};se[0]&4&&(Un.frontend=D[2]),i.$set(Un);const Xt={};se[0]&4&&(Xt.frontend=D[2]),r.$set(Xt);const hs={};se[0]&4&&(hs.frontend=D[2]),u.$set(hs),se[0]&2048&&At(Q,Q=D[11])?(Re.d(1),Re=Yl(D),Re.c(),Re.m(g,x)):Re.p(D,se),(!Ct||se[0]&4)&&Z!==(Z=(D[2].currentFile?Vt.getFilename(D[2].currentFile):"<untitled>")+"")&&Pt(I,Z),(!Ct||se[0]&4)&&Oe!==(Oe=D[2].fileChanged?"*":"")&&Pt(fe,Oe);const Hn={};se[0]&32&&(Hn.control=D[5]),Fe.$set(Hn),se[0]&1024&&At(Xe,Xe=D[10])?(Ci(),Pe(St,1,1,Ot),Mi(),St=Zl(D),St.c(),ve(St,1),St.m(we,null)):St.p(D,se);const zt={};se[0]&4&&(zt.control=D[2].ui.editTable),se[0]&32&&(zt.control2=D[5]),Ae.$set(zt),(!Ct||se[0]&64)&&Pt(mt,D[6]),(!Ct||se[0]&128)&&(Le.disabled=D[7]),se[0]&256&&H(Le,D[8]);const cs={};!xe&&se[0]&512&&(xe=!0,cs.timestamp=D[9],ut(()=>xe=!1)),oe.$set(cs),se[0]&20&&(Rt=tn(D[2].subs.entries),Ve=rl(Ve,se,zn,1,D,Rt,kt,bt.parentNode,or,$l,bt,Bl)),D[2].states.isEditingVirtualEntry?Mt&&(Mt.d(1),Mt=null):Mt?Mt.p(D,se):(Mt=er(D),Mt.c(),Mt.m(nt.parentNode,nt));const qn={};se[0]&2&&(qn.control=D[1]),je.$set(qn),se[0]&4096&&At(It,It=D[12])?(vt.d(1),vt=tr(D),vt.c(),vt.m(f,null)):vt.p(D,se)},i(D){Ct||(ve(n.$$.fragment,D),ve(i.$$.fragment,D),ve(r.$$.fragment,D),ve(u.$$.fragment,D),ve(Fe.$$.fragment,D),ve(St),ve(Ae.$$.fragment,D),ve(oe.$$.fragment,D),ve(je.$$.fragment,D),Ct=!0)},o(D){Pe(n.$$.fragment,D),Pe(i.$$.fragment,D),Pe(r.$$.fragment,D),Pe(u.$$.fragment,D),Pe(Fe.$$.fragment,D),Pe(St),Pe(Ae.$$.fragment,D),Pe(oe.$$.fragment,D),Pe(je.$$.fragment,D),Ct=!1},d(D){D&&(G(t),G(s),G(l),G(h),G(d),G(f)),e[24](null),Ke(n,D),e[25](null),Ke(i,D),e[26](null),Ke(r,D),e[27](null),Ke(u,D),Re.d(D),e[36](null),e[37](null),Ke(Fe),St.d(D),Ke(Ae),e[57](null),Ke(oe),e[63](null);for(let se=0;se<Ve.length;se+=1)Ve[se].d();Mt&&Mt.d(),e[71](null),Ke(je),e[72](null),vt.d(D),Lt=!1,ct(Gt)}}}function nr(e){e.style.height="calc(2.5lh)",e.style.height=`${e.scrollHeight+3}px`}function jd(e,t){return t.gui=e,{update:n=>n.gui=e,destory:()=>t.gui=void 0}}function sr(e,t){return e&&t&&e.start<t.end&&e.end>t.start}const Gd=()=>{};function Bd(e,t,n){let s=new cd,i,l=new Set,r,h,u,d="",f=!0,g=0,p=0,w=0,C=0,v=0,M=0,_=!1,y=0,k=0,L=0;s.onUndoBufferChanged.bind(()=>{n(11,C++,C)}),s.onStatusChanged.bind(()=>{n(12,v++,v)}),s.onSubtitlesChanged.bind((T,ge)=>{n(2,s),ge!=Se.UIForm&&n(10,w++,w),console.log("changed",Ge[T],Se[ge])}),s.onSelectionChanged.bind(()=>{n(4,l=new Set(s.getSelection())),n(2,s),J()}),s.playback.onRefreshPlaybackControl=()=>{let T=s.playback;n(7,f=!T.isLoaded),n(6,d=T.isPlaying?"":""),n(9,p=T.position??0),n(8,g=T.isLoaded?T.position/T.duration:0)};function J(){if(!s.current.entry)return;let T=s.current.entry;n(15,y=T.start),n(16,k=T.end),n(17,L=k-y);let ge=s.states.isEditing;setTimeout(()=>{let je=document.getElementsByClassName("contentarea");for(let Te=0;Te<je.length;Te++){let _e=je.item(Te);nr(_e)}ge&&s.focusOnCurrentEntry()},0)}function U(){if(!s.current.entry)return;let T=s.current.entry;T.start=y,T.end=k,n(17,L=k-y)}function F(T,ge){return ge.gui=T,{update:je=>{je.gui=T,s.states.editChanged&&s.markChanged(Ge.NonTime,Se.UIForm)},destory:()=>ge.gui=void 0}}let R=()=>{if(r===void 0||h===void 0)return;n(20,R=()=>{});let T=new Gl(h,r);T.bind(s.playback.createVideo(T.cxt,s.subs))},N=()=>{if(u===void 0)return;n(21,N=()=>{});let T=new Gl(u,u);T.bind(s.playback.createTimeline(T.cxt,s))};const Q=T=>{s.fileChanged&&T.preventDefault()},x=T=>s.uiHelper.processGlobalKeydown(T);function ue(T){he[T?"unshift":"push"](()=>{s.modalDialogs.timeTrans=T,n(2,s)})}function ce(T){he[T?"unshift":"push"](()=>{i=T,n(3,i)})}function j(T){he[T?"unshift":"push"](()=>{s.modalDialogs.importOpt=T,n(2,s)})}function O(T){he[T?"unshift":"push"](()=>{s.dialogs.search=T,n(2,s)})}const pe=()=>s.askOpenFile(),be=()=>s.askSaveFile(!0),He=()=>s.askImportFile(),E=()=>s.askExportFile(),ke=()=>s.undo(),ee=()=>s.redo(),Z=()=>s.askOpenVideo(),I=()=>i.$set({show:!0});function ie(T){he[T?"unshift":"push"](()=>{h=T,n(0,h)})}function Oe(T){he[T?"unshift":"push"](()=>{r=T,n(5,r)})}const fe=T=>n(13,M=T.currentTarget.selectedIndex);function et(){_=this.checked,n(14,_)}function ne(T){y=T,n(15,y)}const we=()=>{M==0&&_&&n(16,k=y+L),U(),n(2,s.states.editChanged=!0,s)},Ce=()=>s.markChanged(Ge.Times,Se.UIForm);function Ee(T){k=T,n(16,k)}const le=()=>{M==1&&_&&n(15,y=k-L),U(),n(2,s.states.editChanged=!0,s)},de=()=>{k<y&&n(16,k=y),U(),s.markChanged(Ge.Times,Se.UIForm)};function Fe(T){L=T,n(17,L)}const Y=()=>{M==0?n(16,k=y+L):M==1&&n(15,y=k-L),U(),n(2,s.states.editChanged=!0,s)},Xe=()=>s.markChanged(Ge.Times,Se.UIForm);function rt(T,ge){e.$$.not_equal(ge.style,T)&&(ge.style=T,n(2,s))}const me=()=>{s.markChanged(Ge.NonTime,Se.UIForm)},ft=T=>s.insertChannelAt(T),Ae=T=>s.deleteChannelAt(T);function Ye(T,ge){T[ge].text=this.value,n(2,s)}const tt=T=>{n(2,s.states.isEditing=!0,s),n(2,s.current.style=T.style,s),n(2,s.status="set focusedStyle to "+T.style.name,s)},Me=()=>n(2,s.states.isEditing=!1,s),mt=T=>{nr(T.currentTarget),n(2,s.states.editChanged=!0,s)};function at(T){he[T?"unshift":"push"](()=>{s.ui.editTable=T,n(2,s)})}const Le=()=>s.playback.toggle().catch(()=>n(2,s.status="can't play now!",s));function ht(){g=it(this.value),n(8,g)}const oe=()=>{if(!s.playback.isLoaded){n(8,g=0);return}s.playback.setPosition(g*s.playback.duration)};function xe(T){p=T,n(9,p)}const pt=()=>s.playback.setPosition(p);function yt(T){he[T?"unshift":"push"](()=>{s.ui.tableHeader=T,n(2,s)})}const Ie=(T,ge)=>{let je=lt.getTextLength(T.text)/(ge.end-ge.start);return isFinite(je)&&!isNaN(je)?je.toFixed(1):"--"},q=(T,ge)=>{ge.button==0&&s.toggleEntry(T,ge.shiftKey,ge.getModifierState(Vt.ctrlKey()))},Ue=T=>{s.uiHelper.contextMenu(),T.preventDefault()},qe=T=>{s.focusOnCurrentEntry(),s.playback.setPosition(T.start)},Ve=(T,ge)=>{ge.buttons==1&&s.selectEntry(T,!0,ge.getModifierState(Vt.ctrlKey()))},kt=()=>{s.startEditingNewVirtualEntry()},bt=()=>{n(2,s.states.virtualEntryHighlighted=!0,s),s.clearSelection()};function nt(T){he[T?"unshift":"push"](()=>{s.ui.subscontainer=T,n(2,s)})}function st(T){he[T?"unshift":"push"](()=>{u=T,n(1,u)})}return e.$$.update=()=>{e.$$.dirty[0]&1048577&&R(),e.$$.dirty[0]&2097154&&N()},[h,u,s,i,l,r,d,f,g,p,w,C,v,M,_,y,k,L,U,F,R,N,Q,x,ue,ce,j,O,pe,be,He,E,ke,ee,Z,I,ie,Oe,fe,et,ne,we,Ce,Ee,le,de,Fe,Y,Xe,rt,me,ft,Ae,Ye,tt,Me,mt,at,Le,ht,oe,xe,pt,yt,Ie,q,Ue,qe,Ve,kt,bt,nt,st]}class Kd extends sn{constructor(t){super(),nn(this,t,Bd,Vd,At,{},null,[-1,-1,-1])}}new Kd({target:document.getElementById("app")});
